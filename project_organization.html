

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Project structure and management &#8212; Better Code, Better Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'project_organization';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="frontmatter.html">
  
  
  
  
  
  
    <p class="title logo__title">Better Code, Better Science</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="frontmatter.html">
                    Better Code, Better Science
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="essential_tools_and_techniques.html">Essential tools and techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="software_engineering.html">Principles of software engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Software testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="AI_coding_assistants.html">Coding with AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/poldrack/BetterCodeBetterScience" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/poldrack/BetterCodeBetterScience/issues/new?title=Issue%20on%20page%20%2Fproject_organization.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/project_organization.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Project structure and management</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#project-organization">Project organization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tools-for-project-creation">Tools for project creation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-modules">Python modules</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-packages">Python packages</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-python-package">What is a Python package?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-new-python-package">Creating a new Python package</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#submitting-a-package-to-pypi">Submitting a package to PYPI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#editable-packages-for-local-development">Editable packages for local development</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computational-notebooks">Computational notebooks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#workflows-for-jupyter-notebook-development">Workflows for Jupyter notebook development</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-jupyter-notebooks-with-ides">Using Jupyter notebooks with IDEs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-functions-from-jupyter-notebooks-into-modules">Extracting functions from Jupyter notebooks into modules</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#version-control-with-jupyter-notebooks">Version control with Jupyter notebooks</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-notebooks-to-pure-python">Converting notebooks to pure Python</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-jupytext-as-a-pre-commit-hook">Using jupytext as a pre-commit hook</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#containers">Containers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logging">Logging</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="project-structure-and-management">
<h1>Project structure and management<a class="headerlink" href="#project-structure-and-management" title="Permalink to this heading">#</a></h1>
<p>One of the keys to efficient software development is good project organization.  Above all else, using a consistent organizational scheme makes development easier because it allows one to rely upon defaults rather than making decisions, and to rely upon assumptions rather than asking questions. In this chapter we will talk about various aspects of project organization and management, starting from the management of files within a project and then moving to the management of packages and environments.  We will also discuss the use of computational notebooks and ways to make them more amenable to a reproducible analysis workflow.</p>
<section id="project-organization">
<h2>Project organization<a class="headerlink" href="#project-organization" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>most important thing is consistency of organization</p></li>
</ul>
<section id="tools-for-project-creation">
<h3>Tools for project creation<a class="headerlink" href="#tools-for-project-creation" title="Permalink to this heading">#</a></h3>
</section>
</section>
<section id="python-modules">
<h2>Python modules<a class="headerlink" href="#python-modules" title="Permalink to this heading">#</a></h2>
<p>While Python has native access to a small number of functions, much of the functionality of Python comes from <em>modules</em>, which provide access to objects defined in separate files that can be imported into a Python session.  All Python users will be familiar with importing functions from standard libraries (such as <code class="docutils literal notranslate"><span class="pre">os</span></code> or <code class="docutils literal notranslate"><span class="pre">math</span></code>) or external packages (such as <code class="docutils literal notranslate"><span class="pre">numpy</span></code> or <code class="docutils literal notranslate"><span class="pre">pytorch</span></code>). It’s also possible to create one’s own modules simply by putting functions into a file.</p>
<p>Let’s say that we have a set of functions that do specific operations on text, saved to a file called <code class="docutils literal notranslate"><span class="pre">textfuncs.py</span></code> in our working directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">text</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">capitalize</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">lowercase</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</pre></div>
</div>
<p>If we wish to use those functions within another script (’<a class="reference external" href="http://mytext.py">mytext.py</a>’), we can simply import the module and then run them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">textfuncs</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">mytext</span> <span class="o">=</span> <span class="s2">&quot;Hello World&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mytext</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">textfuncs</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span><span class="n">mytext</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">textfuncs</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(</span><span class="n">mytext</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">textfuncs</span><span class="o">.</span><span class="n">lowercase</span><span class="p">(</span><span class="n">mytext</span><span class="p">))</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Giving the results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>❯ python mytext.py
Hello World
dlroW olleH
Hello world
hello world
</pre></div>
</div>
<div class="admonition-antipattern admonition">
<p class="admonition-title">Antipattern</p>
<p>It’s not uncommon to see Python programmers use <em>wildcard imports</em>, such as <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">mytext</span> <span class="pre">import</span> <span class="pre">*</span></code>.  This practice is an antipattern and should be avoided, because it can make it very difficult to debug problems with imported functions, particularly if there is a wildcard import from more than one module.  It can also result in collisions if two modules have a function with the same name, and can prevent linters from properly analyzing the code.  It’s better practice to explicitly import all objects from a module, or to use fully specified paths within the module.</p>
</div>
</section>
<section id="python-packages">
<h2>Python packages<a class="headerlink" href="#python-packages" title="Permalink to this heading">#</a></h2>
<p>One of the most attractive features of Python is the immense ecosystem of <em>packages</em> that have grown up around it.  For nearly any field of scientific research one can find packages that provide access to specialized functions for that field.  <em>EXAMPLES?</em></p>
<section id="what-is-a-python-package">
<h3>What is a Python package?<a class="headerlink" href="#what-is-a-python-package" title="Permalink to this heading">#</a></h3>
</section>
<section id="creating-a-new-python-package">
<h3>Creating a new Python package<a class="headerlink" href="#creating-a-new-python-package" title="Permalink to this heading">#</a></h3>
</section>
<section id="submitting-a-package-to-pypi">
<h3>Submitting a package to PYPI<a class="headerlink" href="#submitting-a-package-to-pypi" title="Permalink to this heading">#</a></h3>
</section>
<section id="editable-packages-for-local-development">
<h3>Editable packages for local development<a class="headerlink" href="#editable-packages-for-local-development" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>workflow for developing a package using editable package + autoreload</p></li>
</ul>
</section>
</section>
<section id="computational-notebooks">
<h2>Computational notebooks<a class="headerlink" href="#computational-notebooks" title="Permalink to this heading">#</a></h2>
<p>The advent of the Jupyter notebook has fundamentally changed the way that many scientists do their computational work.  By allowing the mixing together of code, text, and graphics, Project Jupyter has taken Donald Knuth’s vision of “literate programming”<span id="id1">[<a class="reference internal" href="bibliography.html#id3" title="Donald Ervin Knuth. Literate programming. Volume no. 27. Center for the Study of Language and Information, 1992. ISBN 0937073806 (paper). URL: http://www.loc.gov/catdir/description/cam024/91039510.html.">Knuth, 1992</a>]</span> and made it powerfully available to users of <a class="reference external" href="https://github.com/jupyter/jupyter/wiki/Jupyter-kernels">many supported languages</a>, including Python, R, Julia, and many more.  Many scientists now do the majority of their computing within these notebooks.</p>
<p>The exploding prevalence of Jupyter notebooks is unsurprising, given their many useful features. They match the way that many scientists interactively work to explore and process their data, and provide a way to visualize results next to the code and text that generates them. They also provide an easy way to share results with other researchers. At the same time, they come with some particular software development challenges, which we discuss further below.</p>
<section id="workflows-for-jupyter-notebook-development">
<h3>Workflows for Jupyter notebook development<a class="headerlink" href="#workflows-for-jupyter-notebook-development" title="Permalink to this heading">#</a></h3>
</section>
<section id="using-jupyter-notebooks-with-ides">
<h3>Using Jupyter notebooks with IDEs<a class="headerlink" href="#using-jupyter-notebooks-with-ides" title="Permalink to this heading">#</a></h3>
<p>Many users of Jupyter notebooks edit them via the default Jupyter Lab interface within the a web browser. However, other editors (including VSCode and PyCharm) provide support for the editing and execution of Jupyter notebooks.  The main reason that we generally use a standalone editor is that these editors allow seamless integration of AI coding assistants.  While there are tools that attempt to integrate these assistants within the native Jupyter interface, they are at present nowhere near the level of the commercial IDEs like VSCode.  In addition, these IDEs provide easy access to many other essential coding features, such as code formatting and automated linting.</p>
<section id="extracting-functions-from-jupyter-notebooks-into-modules">
<h4>Extracting functions from Jupyter notebooks into modules<a class="headerlink" href="#extracting-functions-from-jupyter-notebooks-into-modules" title="Permalink to this heading">#</a></h4>
<p>It’s common for users of Jupyter notebooks to define functions within their notebook in order to modularize their code. This is of course a good practice, but suggest that these functions be moved to a module outside of jupyter and imported, rather than being defined within the Jupyter notebook. The reason has to do with the fact that the variables defined in all of the cells within a Jupyter notebook have a global scope.  As we discussed in Chapter Three, global variables are generally frowned upon because they can make it very difficult to debug problems.  In the case of Jupyter notebooks, we have on more than one occasioned been flummoxed by a difficult debugging problem, only to realize that it was due to our use of a global variable within a function.  If a function is defined within the notebook then variables within the global scope are accessible within the function, whereas if a function is imported from another module those global variables are not accessible within the function.  As an example, if we execute the following code within a Jupyter notebook cell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">myfunc</span><span class="p">()</span>
</pre></div>
</div>
<p>the output is 1; this is because the <code class="docutils literal notranslate"><span class="pre">x</span></code> variable is global, and thus is accessible within the function without being passed.  If we instead create a separate python file called ‘<a class="reference external" href="http://myfunc2.py">myfunc2.py</a>’ containing the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myfunc2</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>and then import this within our Jupyter notebook:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">myfunc2</span> <span class="kn">import</span> <span class="n">myfunc2</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">myfunc2</span><span class="p">()</span>
</pre></div>
</div>
<p>We will get an error reflecting the fact that x doesn’t exist within the scope of the imported function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
      <span class="mi">1</span> <span class="kn">from</span> <span class="nn">myfunc2</span> <span class="kn">import</span> <span class="n">myfunc2</span>
      <span class="mi">2</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="o">----&gt;</span> <span class="mi">3</span> <span class="n">myfunc2</span><span class="p">()</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">Dropbox</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">coding_for_science</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">codingforscience</span><span class="o">/</span><span class="n">jupyter</span><span class="o">/</span><span class="n">myfunc2</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="ow">in</span> <span class="n">myfunc2</span><span class="p">()</span>
      <span class="mi">1</span> <span class="k">def</span> <span class="nf">myfunc2</span><span class="p">():</span>
<span class="o">----&gt;</span> <span class="mi">2</span>     <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;x&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>
</pre></div>
</div>
<p>Extracting functions from notebooks into a Python module not only helps prevent problems due to the inadvertent use of global variables; it also makes those functions easier to test.  And as we learned in Chapter XXX, testing is the best way to keep our code base working and to make it easy to change when we need to.  Extracting functions also helps keep the notebook clean and readable, abstracting away the details of the functions and showing primarily the results.</p>
</section>
<section id="version-control-with-jupyter-notebooks">
<h4>Version control with Jupyter notebooks<a class="headerlink" href="#version-control-with-jupyter-notebooks" title="Permalink to this heading">#</a></h4>
<p>While notebooks have understandably gained wide traction, they also have some important limitations.  Foremost, the structure of the <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> file makes them problematic for use in version control systems like git. The file itself is stored as a JSON (JavaScript Object Notation) object, which in Python translates into a dictionary.  As an example, we created a very simple notebook and saved it to our computer.  We can open it as a json file, where we see the following contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;cells&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;cell_type&#39;</span><span class="p">:</span> <span class="s1">&#39;markdown&#39;</span><span class="p">,</span>
   <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{},</span>
   <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;# Example notebook&#39;</span><span class="p">]},</span>
  <span class="p">{</span><span class="s1">&#39;cell_type&#39;</span><span class="p">:</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
   <span class="s1">&#39;execution_count&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
   <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{},</span>
   <span class="s1">&#39;outputs&#39;</span><span class="p">:</span> <span class="p">[],</span>
   <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;import numpy as np</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;x = np.random.randn(1)&#39;</span><span class="p">]}],</span>
 <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;language_info&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;python&#39;</span><span class="p">}},</span>
 <span class="s1">&#39;nbformat&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
 <span class="s1">&#39;nbformat_minor&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</pre></div>
</div>
<p>You can see that the file includes a section for cells, that in this case can contain either Markdown or Python code. In addition, it contains various metadata elements about the file. One thing you should notice is that each code cell contains an <code class="docutils literal notranslate"><span class="pre">execution_count</span></code> variable, which stores the number of times the cell has been executed.  If we rerun the code in that cell without making any changes and then save the notebook, we will see that the execution count has incremented by one.  We can see this by running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code> on this new file after having checked in the previous version:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span>   <span class="s2">&quot;execution_count&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<span class="o">+</span>   <span class="s2">&quot;execution_count&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
</pre></div>
</div>
<p>This is one of the reasons why we say that notebook files don’t work well with version control: simply executing the file without any actual changes will still result in a difference according to git, and these differences can litter the git history, making it very difficult to discern true code differences.</p>
<p>Another challenge with using Jupyter notebooks alongside version control occurs when the notebook includes images, such as output from plotting commands.  Images in Jupyter notebooks are stored in a serialized text-based format; you can see this by perusing the text of a notebook that includes images, where you will see large sections of seemingly random text, which represent the content of the image converted into text.  If the images change then the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code> will be littered with huge sections of this gibberish text.  One could filter these out when viewing the diffs (e.g. using <code class="docutils literal notranslate"><span class="pre">grep</span></code>) but another challenge is that very large images can cause the version control system to become slow and bloated if there are many notebooks with images that change over time.</p>
</section>
</section>
<section id="converting-notebooks-to-pure-python">
<h3>Converting notebooks to pure Python<a class="headerlink" href="#converting-notebooks-to-pure-python" title="Permalink to this heading">#</a></h3>
<p>One alternative that we like is to convert our notebooks to pure Python files using the <code class="docutils literal notranslate"><span class="pre">jupytext</span></code> tool.  Jupytext supports several formats that can encode the metadata from a notebook into comments within a python file, allowing direct conversion in both directions between a Jupyter notebook and a pure Python file. We like the <code class="docutils literal notranslate"><span class="pre">py:percent</span></code> format, which places a specific marker (<code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">%%</span></code>) above each cell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># %% [markdown]</span>
<span class="c1"># ### Example notebook</span>
<span class="c1">#</span>
<span class="c1"># This is just a simple example</span>

<span class="c1"># %%</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<p>These cells can then be version-controlled just as one would with any Python file. To convert a Jupyter notebook to Python, use the jupytext command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>❯ jupytext --to py:percent ExampleNotebook1.ipynb
[jupytext] Reading ExampleNotebook1.ipynb in format ipynb
[jupytext] Writing ExampleNotebook1.py in format py:percent

</pre></div>
</div>
<p>which will create a new Python version of the file.  Then set the metadata of the Python file to include ipynb as one of its formats, as this will allow syncing of the files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>❯ jupytext --set-formats &quot;py:percent,ipynb&quot; ExampleNotebook1.py
[jupytext] Reading ExampleNotebook1.py in format py
[jupytext] Updating notebook metadata with &#39;{&quot;jupytext&quot;: {&quot;formats&quot;: &quot;py:percent,ipynb&quot;}}&#39;
[jupytext] Loading ExampleNotebook1.ipynb
[jupytext] Updating ExampleNotebook1.ipynb
[jupytext] Updating ExampleNotebook1.py
</pre></div>
</div>
<p>Then, one can synchronize the Jupyter notebook and Python versions using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jupytext</span> <span class="o">--</span><span class="n">sync</span> <span class="n">notebook</span><span class="o">.</span><span class="n">ipynb</span>
</pre></div>
</div>
<section id="using-jupytext-as-a-pre-commit-hook">
<h4>Using jupytext as a pre-commit hook<a class="headerlink" href="#using-jupytext-as-a-pre-commit-hook" title="Permalink to this heading">#</a></h4>
<p>If one wants to edit code using Jupyter notebooks while still maintaining the advantages of the pure Python format for version control (assuming one is using Git), one option is to apply Jupytext as part of a <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">hook</span></code>, which is a git feature that allows commands to be executed automatically prior to the execution of a commit.  This takes advantage of the syncing function described above.  Automatic syncing can be enabled within a git repository by creating a file called <code class="docutils literal notranslate"><span class="pre">.pre-commit-config.yaml</span></code> within the main repository directory, with the <a class="reference external" href="https://github.com/mwouts/jupytext/blob/v1.9.1/docs/using-pre-commit.md">following contents</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">repos</span><span class="p">:</span>
  <span class="o">-</span>
    <span class="n">repo</span><span class="p">:</span> <span class="n">local</span>
    <span class="n">hooks</span><span class="p">:</span>
      <span class="o">-</span>
        <span class="nb">id</span><span class="p">:</span> <span class="n">jupytext</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">jupytext</span>
        <span class="n">entry</span><span class="p">:</span> <span class="n">jupytext</span> <span class="o">--</span><span class="kn">from</span> <span class="nn">ipynb</span> <span class="o">--</span><span class="n">to</span> <span class="n">py</span><span class="p">:</span><span class="n">percent</span> <span class="o">--</span><span class="n">pre</span><span class="o">-</span><span class="n">commit</span>
        <span class="n">pass_filenames</span><span class="p">:</span> <span class="n">false</span>
        <span class="n">language</span><span class="p">:</span> <span class="n">python</span>
      <span class="o">-</span>
        <span class="nb">id</span><span class="p">:</span> <span class="n">unstage</span><span class="o">-</span><span class="n">ipynb</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">unstage</span><span class="o">-</span><span class="n">ipynb</span>
        <span class="n">entry</span><span class="p">:</span> <span class="n">git</span> <span class="n">reset</span> <span class="n">HEAD</span> <span class="o">**/*.</span><span class="n">ipynb</span>
        <span class="n">pass_filenames</span><span class="p">:</span> <span class="n">false</span>
        <span class="n">language</span><span class="p">:</span> <span class="n">system</span>
</pre></div>
</div>
<p>The first section will automatically run jupytext and generate a pure Python version of the notebook before the commit is completed.  The second section will unstage the <code class="docutils literal notranslate"><span class="pre">ipynb</span></code> files before committing, so that they will not be committed to the git repository (only the Python files will). This will keep the Python and Jupyter notebook files synced while only committing the Python files to the git repository.</p>
</section>
</section>
</section>
<section id="containers">
<h2>Containers<a class="headerlink" href="#containers" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Donoho quote</p></li>
</ul>
</section>
<section id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Permalink to this heading">#</a></h2>
<p><em>NOTE:</em> Not sure where this should actually go but we should talk about it somewhere.  Leaving as a placeholder here for now.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#project-organization">Project organization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tools-for-project-creation">Tools for project creation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-modules">Python modules</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-packages">Python packages</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-python-package">What is a Python package?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-new-python-package">Creating a new Python package</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#submitting-a-package-to-pypi">Submitting a package to PYPI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#editable-packages-for-local-development">Editable packages for local development</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computational-notebooks">Computational notebooks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#workflows-for-jupyter-notebook-development">Workflows for Jupyter notebook development</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-jupyter-notebooks-with-ides">Using Jupyter notebooks with IDEs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-functions-from-jupyter-notebooks-into-modules">Extracting functions from Jupyter notebooks into modules</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#version-control-with-jupyter-notebooks">Version control with Jupyter notebooks</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-notebooks-to-pure-python">Converting notebooks to pure Python</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-jupytext-as-a-pre-commit-hook">Using jupytext as a pre-commit hook</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#containers">Containers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logging">Logging</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Russell Poldrack et al.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>