{"version":3,"kind":"Article","sha256":"7606e64bade7e4c9db27467c82f4e96b51ad3482f206b8745bd697820497fa85","slug":"software-engineering","location":"/software_engineering.md","dependencies":[],"frontmatter":{"title":"Principles of software engineering","content_includes_title":false,"authors":[{"nameParsed":{"literal":"Russell Poldrack et al.","given":"Russell Poldrack","non_dropping_particle":"et","family":"al."},"name":"Russell Poldrack et al.","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/poldrack/BetterCodeBetterScience","source_url":"https://github.com/poldrack/BetterCodeBetterScience/blob/main/book/software_engineering.md","edit_url":"https://github.com/poldrack/BetterCodeBetterScience/edit/main/book/software_engineering.md","thumbnail":"/build/code_formatting-5f7533d0e3a713101d0fbc3e66a69964.png","exports":[{"format":"md","filename":"software_engineering.md","url":"/build/software_engineering-d6b50b520aa73d41c7edefcadfbe6458.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Just as mechanical engineering is the science of building physical things like airports or engines, software engineering is the science of building software.\nIts goal is to identify the principles and practices that allow building of software that is robust, efficient, and maintainable.\nJust as a person can build a table at home without any formal knowledge of mechanical engineering, one can build software without knowing any of the principles of software engineering.\nHowever, this software is likely to suffer from exactly the same kinds of instability and poor functionality as the average homemade table.\nKnowing a few basic ideas from software engineering can help scientists build software more effectively and generate outputs that will be more robust and maintainable over time.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"zoPRsK3W5M"}],"key":"EcLR9g2L8N"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"We have already talked about some of the basic tools of software engineering, such as version control.\nIn this chapter we will focus on some of the “big ideas” from software engineering, highlighting how their adoption can improve the life of nearly anyone who develops software.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"mSE4yT8DuY"}],"key":"i3YNgfYirq"},{"type":"heading","depth":2,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Why software engineering matters in the age of AI-assisted coding","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"CgkxsmJFCK"}],"identifier":"why-software-engineering-matters-in-the-age-of-ai-assisted-coding","label":"Why software engineering matters in the age of AI-assisted coding","html_id":"why-software-engineering-matters-in-the-age-of-ai-assisted-coding","implicit":true,"key":"KqMH3JjsBv"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"One might ask why we are spending an entire chapter talking about software engineering; when it’s likely that AI tools going to write much of the code in our projects going forward.\nFirst, think back to the point we made in Chapter 1: Programming is not equivalent to writing code.\nEven if the AI system can write computer code (e.g. in Python), a human needs to describe the problem(s) that the software is meant to solve, and to iterate with the code to debug any failures to solve the problem.\nThis requires that a human write the specification that tells the computer how to solve the problem: we may have traded Python for English as the programming language of choice, but nonetheless the human needs to precisely specify the goals of the software.\nThus, an understanding of the software development process will remain essential even as AI assistants write an increasing amount of code.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"SAQwWVpcsk"}],"key":"eNUHSyxjhX"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Software development processes may be less important for small one-off projects written by a single developer, but they become essential once a project becomes large and involves multiple developers.\nCoordination costs can quickly eat into the added benefit of more developers on a project, particularly if there is not a strong development process in place.\nAnd writing good, clean code is essential to help bring new developers into a project; otherwise, the startup costs for a developer to get their head around a poorly engineered codebase can just be too large.\nSimilarly, poorly written code can result in a high “bus factor” (i.e., what happens if your lead developer gets hit by a bus?), which can be major risk for groups that rely heavily upon a particular software project for their work.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Hrhk2D5RlP"}],"key":"RfzuU7TmZj"},{"type":"heading","depth":2,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Agile development processes","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"VZIhsyVoEC"}],"identifier":"agile-development-processes","label":"Agile development processes","html_id":"agile-development-processes","implicit":true,"key":"Cy8rDLrXWQ"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"When I was in graduate school, I spent countless hours developing a tool for analyzing data that was general enough to process not just the data that I needed to analyze for his project, but also nearly any other kind of data that one might envision from similar experiments.\nHow many of those other kinds of data did I ever actually analyze? You guessed it: Zilch.\nThere is an admirable tendency amongst some scientists to want to solve a problem in a maximally general way, but this problem is not limited to scientists.\nIn fact, it has a name within software circles: “gold plating”.\nUnfortunately, humans are generally bad at predicting what is actually needed to solve a problem, and the extra work spent adding gold plating might be fun for the developer but rarely pays off in the longer term.\nSoftware engineers love acronyms, and a commonly used acronym that targets this kind of overengineering is YAGNI: “You Aren’t Gonna Need It”.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"QLduxebr9w"}],"key":"dFEDdPcMbQ"},{"type":"paragraph","position":{"start":{"line":36,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"Within commercial software engineering, it was once common to develop a detailed requirements document before one ever started writing code, and then move on to code writing using those fixed requirements.\nThis is known as the “waterfall” method for project management; it can work well in some domains (like physical construction, where the plans can’t change halfway through building, and the materials need to be on hand before construction starts), but in software development it often led to long delays that occurred once the initial plan ran into challenges at the coding phase.\nInstead, most software development projects now use methods generally referred to as ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"r9tAEvAv93"},{"type":"emphasis","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"Agile","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"S2VbvJqBVB"}],"key":"jmHGOIYZNs"},{"type":"text","value":", in which there are much faster cycles between planning and development.\nOne of the most important ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"DHl9B3tm3W"},{"type":"link","url":"https://agilemanifesto.org/principles.html","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"principles","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"y6SLZIaWbV"}],"urlSource":"https://agilemanifesto.org/principles.html","key":"uIYl1F7iIA"},{"type":"text","value":" of the Agile movement is that “Working software is the primary measure of progress.”.\nIt’s worth noting that a lot of dogma has grown up around Agile and related software development methodologies (such as ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"SCR3MGLtTg"},{"type":"emphasis","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"Scrum","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"ktv3hH7bCl"}],"key":"Si3ODopYDu"},{"type":"text","value":" and ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"Qc2bRBuN2j"},{"type":"emphasis","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"Kanban","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"NaBfAP65eI"}],"key":"Zq91TSxLsF"},{"type":"text","value":"), most of which is overkill for scientists producing code for research.\nBut there are nonetheless some very useful concepts and processes that we can take from these methodologies to help us build scientific software better and faster.","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"yHyk48FT7Z"}],"key":"zorzuNYnLY"},{"type":"paragraph","position":{"start":{"line":43,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"text","value":"In our laboratory, we focus heavily on the idea of the “minimum viable product” (MVP) that grows out of the Agile philosophy.\nWe shoot for code that solves the scientific or technical problem at hand: no more, and no less.\nWe try to write that code as cleanly as possible (as described in the next section), but we realize that the code will never be perfect, and that’s ok.\nIf it’s code that will be reused in the future, then we will likely spend some additional time refactoring it to improve its clarity and robustness and providing additional documentation.\nThis philosophy is the rationale for the “test-driven development” approach that we outline later in this chapter.","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"q2hBxuiKUo"}],"key":"gsbwDO9y8A"},{"type":"heading","depth":2,"position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"Designing software through user stories","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"xzv9wtU5X9"}],"identifier":"designing-software-through-user-stories","label":"Designing software through user stories","html_id":"designing-software-through-user-stories","implicit":true,"key":"Hf95TneCvC"},{"type":"paragraph","position":{"start":{"line":51,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"It’s important to think through the ways that a piece of software will be used, and one useful way to address this is through ","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"u8FMQnxw0X"},{"type":"emphasis","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"user stories","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"mgBgG0p219"}],"key":"l9NeEB0pXC"},{"type":"text","value":".\nUnderstanding specific use cases for the software from the standpoint of users can be very useful in helping to ensure that the software is actually solving real problems, rather than solving problems that might theoretically exist but that no user will ever engage with.\nWe often see this with the development of visualization tools, where the developer thinks that a visualization feature would be “cool” but it doesn’t actually solve a real scientific problem for a user of the software.","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"xSBncfXMGQ"}],"key":"MikkMxQBif"},{"type":"paragraph","position":{"start":{"line":55,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"A user story is often framed in the following way: “As a [type of user], I want [a particular functionality] so that [what problem the functionality will solve]”.\nAs an example, say that a researcher wanted to develop a tool to convert between different genomic data formats.\nA couple of potential user stories for this software could be:","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"JXXwzyKrVP"}],"key":"o8CxlR0ugE"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":59,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"“As a user of the ABC123 sequencer, I want to convert my raw data to the current version of the SuperMegaFormat, so that I can submit my data to the OmniData Repository.”","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"XgoT0YB9aC"}],"key":"koAZnqatJv"}],"key":"Dwi3hD6E2Z"},{"type":"listItem","spread":true,"position":{"start":{"line":60,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"“As a user of software that that requires my data to be in a specific version of the SuperMegaFormat, I want to validate that my data have been properly converted to comply with that version of the format so that I can ensure that my data can be analyzed.”","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"UxYjOFNRp0"}],"key":"CbrjVz5DU2"}],"key":"H30KHlhsdn"}],"key":"nlwj0TIsmv"},{"type":"paragraph","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"These two stories already point to several functions that need to be implemented:","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"mdI7nvahbH"}],"key":"u4KdfWaa6n"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":64,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The code needs to be able to access specific versions of the SuperMegaFormat, including the current version and older versions.","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"RyR4pDTUgd"}],"key":"nT1Ke5Wesj"}],"key":"OJVddZXjwZ"},{"type":"listItem","spread":true,"position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The code needs to be able to read data from the ABC123 sequencer.","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"kUuGqnqJgB"}],"key":"JDsA517Bie"}],"key":"KXHZJlPQsn"},{"type":"listItem","spread":true,"position":{"start":{"line":66,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The code needs to be able to validate that a dataset meets any particular version of the SuperMegaFormat.","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"XMPtpNVqat"}],"key":"iJvTFKUNQg"}],"key":"lEqwaQyyUQ"}],"key":"kE55f6tZi0"},{"type":"paragraph","position":{"start":{"line":68,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"User stories are also useful for thinking through the potential impact of new features that are envisioned by the coder.\nPerhaps the most common example of violations of YAGNI comes about in the development of visualization tools.\nIn this example, the developer might decide to create an visualizer to show how the original dataset is being converted into the new format, with interactive features that would allow the user to view features of individual files.\nThe question that you should always ask yourself is: What user stories would this feature address? If it’s difficult to come up with stories that make clear how the feature would help solve particular problems for users, then the feature is probably not needed. “If you build it, they will come” might work in baseball, but it rarely works in scientific software.\nThis is the reason that one of us (RP) regularly tells his trainees to post a note in their workspace with one simple mantra: “MVP”.","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"nws3b6WCDK"}],"key":"wZktarPpZ2"},{"type":"heading","depth":2,"position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"Refactoring code","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"BRQ2nDD4Gu"}],"identifier":"refactoring-code","label":"Refactoring code","html_id":"refactoring-code","implicit":true,"key":"rhSHru6yE5"},{"type":"paragraph","position":{"start":{"line":77,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"Throughout our discussion we will regularly mention the concept of ","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"mSvKAXeDkV"},{"type":"emphasis","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"refactoring","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"H3K2SRMIGP"}],"key":"kJ24T9QlfP"},{"type":"text","value":" (as we just did in the previous section), so we should introduce it here.\nWhen we refactor a piece of code, we modify it in a way that doesn’t change its external behavior.\nThe idea long existed in software development but was made prominent by Martin Fowler in his book ","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"Z5RiYJKUYv"},{"type":"emphasis","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"Refactoring: Improving the Design of Existing Code","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"LGKFdM1JKs"}],"key":"yHZXG3VZxE"},{"type":"text","value":".\nAs the title suggests, the goal of refactoring is to improve existing code rather than adding features or fixing bugs - but why would we spend time modifying code once it’s working, unless our goal is to add something new or fix something that is broken?","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"ut86dZi9qQ"}],"key":"RYD0nsPKHB"},{"type":"paragraph","position":{"start":{"line":82,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"text","value":"In fact, the idea of refactoring is closely aligned with the Agile development philosophy mentioned above.\nRather than designing a software product in detail before coding, we can instead design as we go, understanding that this is just a first pass.\nAs Fowler says:","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"NA4FZhV1Bd"}],"key":"uF8or0NNdb"},{"type":"blockquote","position":{"start":{"line":86,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":86,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"“With refactoring, we can take a bad, even chaotic, design and rework it into well-structured code.\nEach step is simple — even simplistic.\nI move a field from one class to another, pull some code out of a method to make it into its own method, or push some code up or down a hierarchy.\nYet the cumulative effect of these small changes can radically improve the design.” - Fowler (p. xiv)","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"rhyxTxVgvs"}],"key":"owxbnt1L8Z"}],"key":"mAFY1E4C5A"},{"type":"paragraph","position":{"start":{"line":91,"column":1},"end":{"line":96,"column":1}},"children":[{"type":"text","value":"There are several reasons why we might want to refactor existing code.\nMost importantly, we may want to make the code ","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"mgzMwAq8XV"},{"type":"emphasis","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"text","value":"easier to maintain","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"K6sEx5hm1p"}],"key":"gXtTwIFQVT"},{"type":"text","value":".\nThis in turn often implies making it easier to read and understand, as we discuss further below in the context of ","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"dB6phD5nng"},{"type":"emphasis","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"text","value":"clean coding","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"ZqDj9Ep6aP"}],"key":"hug0TW8d31"},{"type":"text","value":".\nFor example, we might want to break a large function out into several smaller functions so that the logical structure of the code is clearer from the code itself.\nMaking code easier to understand and maintain also helps make it easier to add features to in the future.\nThere are many other ways in which one can improve code, which are the focus of Fowler’s book; we will outline more of them below when we turn later to the problem of “code smells”.","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"CNdjONWC20"}],"key":"xRpmRCfz8i"},{"type":"paragraph","position":{"start":{"line":98,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"It is increasingly possible to use AI tools to refactor code.\nAs long as one has a solid testing program in place, this can help save time and also help learn how to refactor code more effectively.\nThis suggests that testing needs to be a central part of our coding process, which is why we will devote an entire chapter to it later in the book.","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"BNjwIkXEOC"}],"key":"rtSC1BNqNC"},{"type":"heading","depth":2,"position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"text","value":"Test-driven development","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"FLRkDDG0wU"}],"identifier":"test-driven-development","label":"Test-driven development","html_id":"test-driven-development","implicit":true,"key":"zip61tMflR"},{"type":"paragraph","position":{"start":{"line":105,"column":1},"end":{"line":106,"column":1}},"children":[{"type":"text","value":"Let’s say that you have a software project you want to undertake, and you have in mind what the Minimum Viable Product would be: A script that takes in a dataset and transforms the data into a standardized format that can be uploaded to a particular data repository.\nHow would you get started? And how would you know when you are done?","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"QkWNpfUJOi"}],"key":"ZdfmpTXQT7"},{"type":"paragraph","position":{"start":{"line":108,"column":1},"end":{"line":109,"column":1}},"children":[{"type":"text","value":"After decomposing the problem into its components, many coders would simply start writing code to implement each of the components.\nFor example, one might start by creating a script with comments that describe each of the needed components:","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"b7MkGtNAtv"}],"key":"lVd1Gtngu6"},{"type":"code","lang":"","value":"# Step 1: index the data files\n\n# Step 2: load the files\n\n# Step 3: reformat the metadata to match the repository standard\n\n# Step 4: combine the data and metadata\n\n# Step 5: save the data to the required format","position":{"start":{"line":111,"column":1},"end":{"line":121,"column":1}},"key":"gmHBydhtjp"},{"type":"paragraph","position":{"start":{"line":123,"column":1},"end":{"line":127,"column":1}},"children":[{"type":"text","value":"A sensible way to get started would be march through the steps and write a function to accomplish each one, and then test the entire package once all of the functions are created.\nHowever, this approach has a couple of drawbacks.\nFirst, since you can’t run the application until all of the code is written, you can’t know whether each component is working properly until the entire package is built.\nSecond, it’s easy to end up writing code that will end up not needing, since you haven’t specified exactly what the inputs and outputs are for each component.\nFinally, once you start integrating all of the components, you won’t have a way to know if you have introduced a bug.","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"uxVBcL4lQF"}],"key":"S5onNH1YsM"},{"type":"paragraph","position":{"start":{"line":129,"column":1},"end":{"line":132,"column":1}},"children":[{"type":"text","value":"One answer to these problems is to start the process by creating a set of ","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"key":"r0MLSqdhbk"},{"type":"emphasis","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"children":[{"type":"text","value":"tests","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"key":"vYs1oJLllc"}],"key":"qEiN14Ccdw"},{"type":"text","value":", which tell us whether the code has solved our intended problems.\nThe process of writing tests before writing code to solve the problem is known as ","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"key":"tQm9VBQ4ga"},{"type":"emphasis","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"children":[{"type":"text","value":"test-driven development","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"key":"hXV7vp75E2"}],"key":"Rr2e3YZQVR"},{"type":"text","value":" (TDD), and we think that it is a very useful framework to use when writing scientific code, especially if one plans to use LLMs for code generation.\nTest-driven development is somewhat controversial within the software engineering field, in part because many people take it too far and become obsessive with testing, such that the tests come to be the tail that wags the dog; in particular we would caution against using the amount of test coverage as a metric for success.\nBut we think that when it is used in a thoughtful way, TDD can be a powerful way to increase the effectiveness and accuracy of one’s code.","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"key":"pWFQEsnmGG"}],"key":"RSRXnoN4ZV"},{"type":"paragraph","position":{"start":{"line":134,"column":1},"end":{"line":135,"column":1}},"children":[{"type":"text","value":"We will dive deeply into testing in a later chapter; here we will simply outline a simple test-driven development workflow for the data transformation problem described above.\nThe TDD workflow can be summarized in a cycle involving three steps:","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"yx6CM59Pq2"}],"key":"z0KUWFaB5w"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":137,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"children":[{"type":"paragraph","children":[{"type":"emphasis","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"children":[{"type":"text","value":"Red","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"xBBhDdBtbv"}],"key":"JKEkrcHi8A"},{"type":"text","value":": Create a test that initially fails for the intended function.","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"tfqcdx5GCw"}],"key":"CqEzSpjkQ2"}],"key":"slxJ4QStwB"},{"type":"listItem","spread":true,"position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"children":[{"type":"paragraph","children":[{"type":"emphasis","position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"children":[{"type":"text","value":"Green","position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"key":"C9bdyewvC8"}],"key":"jN0o8hF6WD"},{"type":"text","value":": Create a function that passes the test.","position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"key":"zJyKceFeM3"}],"key":"W9Iv7K9iaD"}],"key":"TkvYIAjsMa"},{"type":"listItem","spread":true,"position":{"start":{"line":139,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"paragraph","children":[{"type":"emphasis","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"children":[{"type":"text","value":"Refactor","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"key":"t2RrkSVWwy"}],"key":"lGmxvNYC7P"},{"type":"text","value":": Modify the code to make it more maintainable, readable, and robust","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"key":"oF5rRDhaWH"}],"key":"Bo5gO7AWNu"}],"key":"w3fNbrJyDj"}],"key":"gaQVRzP2IE"},{"type":"paragraph","position":{"start":{"line":141,"column":1},"end":{"line":142,"column":1}},"children":[{"type":"text","value":"These processes are then repeated until the software solves the intended problem.\nThis process helps prevent the developer from writing code to solve problems that don’t exist yet, since the only aim is to create code that passes the specific test in question.","position":{"start":{"line":141,"column":1},"end":{"line":141,"column":1}},"key":"lu4llTvRka"}],"key":"QusQrBy0oC"},{"type":"heading","depth":2,"position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"children":[{"type":"text","value":"Clean coding","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"key":"g3rTSjPGJb"}],"identifier":"clean-coding","label":"Clean coding","html_id":"clean-coding","implicit":true,"key":"AbM2mxrXsd"},{"type":"blockquote","position":{"start":{"line":147,"column":1},"end":{"line":148,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":147,"column":1},"end":{"line":148,"column":1}},"children":[{"type":"text","value":"“Any fool can write code that a computer can understand.\nGood programmers write code that humans can understand.” Fowler (p. 10)","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"key":"AL0NCYi9z3"}],"key":"tAKbobY2Jb"}],"key":"OgMGlWKyzG"},{"type":"paragraph","position":{"start":{"line":150,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"text","value":"Another idea that has emerged from the Agile community is ","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"qFjNUYnHkc"},{"type":"emphasis","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"text","value":"clean coding","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"FoCLjq9VUd"}],"key":"KjoYeSnIYU"},{"type":"text","value":", which is the idea that code should be simple, readable, and easily maintainable.\nThis idea was codified in the book titled ","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"ZunlYNzVcA"},{"type":"emphasis","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"text","value":"Clean Code: A Handbook of Agile Software Craftsmanship","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"Xa0c2iRkYd"}],"key":"DVHddHCavO"},{"type":"text","value":", published in 2008 by Robert C.\nMartin (known in the community as “Uncle Bob”).\nOne of the best ways to describe clean code is that it is ","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"zovoMGDCCT"},{"type":"emphasis","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"text","value":"simple","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"YA1GGnAWBC"}],"key":"iKnJGyGKB5"},{"type":"text","value":".\nKent Beck, another Agile founder who developed the idea of “Extreme Programming”, laid out a set of rules for simple code:","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"ZUH44MXDTo"}],"key":"yB2mnJt0jw"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":156,"column":1},"end":{"line":160,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The code has tests and all of the tests run.","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"D9Jj9hERVS"}],"key":"s6Kjs1nonZ"}],"key":"QH8RfA8zgY"},{"type":"listItem","spread":true,"position":{"start":{"line":157,"column":1},"end":{"line":157,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The code contains no duplication.","position":{"start":{"line":157,"column":1},"end":{"line":157,"column":1}},"key":"JruwpRy1zb"}],"key":"wjKRkXatXW"}],"key":"ikaIOkwG19"},{"type":"listItem","spread":true,"position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The code makes the design of the system clear","position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"key":"jXlajK5rjf"}],"key":"toohJ1SsVG"}],"key":"M6tnc5DYa1"},{"type":"listItem","spread":true,"position":{"start":{"line":159,"column":1},"end":{"line":160,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The code minimizes the number of entities (such as functions or classes).","position":{"start":{"line":159,"column":1},"end":{"line":159,"column":1}},"key":"j16KgP3Qwr"}],"key":"JdrMTHjngU"}],"key":"qRitlRCAHN"}],"key":"sg9IYHjHPz"},{"type":"paragraph","position":{"start":{"line":161,"column":1},"end":{"line":162,"column":1}},"children":[{"type":"text","value":"Another way to think about clean code is that it makes it as easy as possible for another programmer to come in later and change it.\nAnd it’s essential to remember that this “other programmer” is mostly like to refer to future you! When we look back at code that we wrote more than a few months ago, we are likely to remember very little of it, meaning that we need to rediscover the design and structure of the code.","position":{"start":{"line":161,"column":1},"end":{"line":161,"column":1}},"key":"yfFc4bDieY"}],"key":"bIoEptssoO"},{"type":"paragraph","position":{"start":{"line":164,"column":1},"end":{"line":167,"column":1}},"children":[{"type":"text","value":"There are many different interpretations of the concept of clean code.\nHere we will lay out the principles that we think are most important for the creation of code in the context of scientific research (as opposed to commercial software development).\nFortunately, the code generated by AI coding assistants is often quite clean, as we found in our analyses of code generated by GPT-4 ","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"key":"nzL4p6G5sb"},{"type":"citeGroup","kind":"parenthetical","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"children":[{"type":"cite","identifier":"poldrack:2023aa","label":"Poldrack:2023aa","kind":"parenthetical","position":{"start":{"line":164,"column":387},"end":{"line":164,"column":403}},"children":[{"type":"text","value":"Poldrack ","key":"GCS3oOtujx"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"hdcFQ7K7F7"}],"key":"VIvVCZnjbA"},{"type":"text","value":", 2023","key":"fi7wi0TNZn"}],"enumerator":"1","key":"bOyfSKoRAh"}],"key":"xeDVjP8uxh"},{"type":"text","value":".\nBut as we work alongside these assistants, it’s important to develop a mindset of continuous improvement, always seeking to make the code cleaner and simpler whenever we can.","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"key":"MRw5z4zHvX"}],"key":"LeFubUi7DB"},{"type":"heading","depth":3,"position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"children":[{"type":"text","value":"Readability","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"JrZeFjaJFh"}],"identifier":"readability","label":"Readability","html_id":"readability","implicit":true,"key":"Mz9L3nGegP"},{"type":"paragraph","position":{"start":{"line":171,"column":1},"end":{"line":172,"column":1}},"children":[{"type":"text","value":"An excellent test for whether code is clean is whether it is ","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"D0qJcA5koT"},{"type":"emphasis","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"children":[{"type":"text","value":"readable","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"YR8ECao6A5"}],"key":"t7pXQEBtKY"},{"type":"text","value":".\nIn fact, one of the 19 guiding principles of the Python language, enshrined in ","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"YUCv8p8rBP"},{"type":"link","url":"https://peps.python.org/pep-0020/","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"children":[{"type":"text","value":"The Zen of Python","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"x1a2MmbxBX"}],"urlSource":"https://peps.python.org/pep-0020/","key":"LPZKdfUUeI"},{"type":"text","value":", is “Readability counts”, reflecting the judgment by Python founder Guido van Rossum that ","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"ihtn9Q9fLF"},{"type":"link","url":"https://peps.python.org/pep-0008/","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"children":[{"type":"text","value":"“code is read much more often than it is written”","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"msjPCMU2ef"}],"urlSource":"https://peps.python.org/pep-0008/","key":"fJDZc1QAXf"},{"type":"text","value":".","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"baaLXQgHIR"}],"key":"hD1wvyZ5XE"},{"type":"heading","depth":4,"position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"children":[{"type":"text","value":"Naming things well","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"Yba2qNUADI"}],"identifier":"naming-things-well","label":"Naming things well","html_id":"naming-things-well","implicit":true,"key":"xcALhbPQF1"},{"type":"paragraph","position":{"start":{"line":176,"column":1},"end":{"line":179,"column":1}},"children":[{"type":"text","value":"The book ","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"x7lzepuXiV"},{"type":"link","url":"https://leanpub.com/naming-things","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"text","value":"“Naming Things”","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"XGiy9LVH5L"}],"urlSource":"https://leanpub.com/naming-things","key":"I6AoTZfKuG"},{"type":"text","value":" by Tom Benner is subtitled “The Hardest Problem in Software Engineering”, which might sound hyperbolic but really can turn out to be true once you start trying to come up with good names as you program.\nBenner provides a summary on his blog of what he calls ","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"lWOm6MOtFa"},{"type":"link","url":"https://www.namingthings.co/naming-things-principles","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"text","value":"“The 7 principles of naming”","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"wvmoyVrKHO"}],"urlSource":"https://www.namingthings.co/naming-things-principles","key":"wI4B9ATuGg"},{"type":"text","value":", a subset of which we detail here.\nHowever, we highly recommend the book for much more detail on how to follow each of the principles.\nIt’s particularly important to point out that these different principles may sometimes clash with one another, requiring the judgment of the developer to determine the best name to use.","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"UG8c7W8ZyW"}],"key":"KCEJzPzJpk"},{"type":"heading","depth":5,"position":{"start":{"line":181,"column":1},"end":{"line":181,"column":1}},"children":[{"type":"text","value":"Consistency","position":{"start":{"line":181,"column":1},"end":{"line":181,"column":1}},"key":"XylL7ClkGl"}],"identifier":"consistency","label":"Consistency","html_id":"consistency","implicit":true,"key":"HipUMNngtq"},{"type":"blockquote","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"children":[{"type":"text","value":"“Each concept should be represented by a single, unique name.”","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"yhDNsBFhA2"}],"key":"GHbTv6VENI"}],"key":"HhpNsC0SOz"},{"type":"paragraph","position":{"start":{"line":185,"column":1},"end":{"line":186,"column":1}},"children":[{"type":"text","value":"The use of different names for the same concept can lead the reader to assume that there are two different concepts at play, often known as a “","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"sbt2JHzEhn"},{"type":"link","url":"https://en.wikipedia.org/wiki/Jingle-jangle_fallacies","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"text","value":"jangle fallacy","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"j5dPgs17rq"}],"urlSource":"https://en.wikipedia.org/wiki/Jingle-jangle_fallacies","data":{"page":"Jingle-jangle_fallacies","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"jelYE3KYAM"},{"type":"text","value":"”.\nThis might occur when a similar concept appears across multiple functions, but is named differently; for example, a variable referring to a specific model is called ","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"wAvfCAcfWI"},{"type":"inlineCode","value":"modelname","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"AC9a3fJ8uC"},{"type":"text","value":" in one function and ","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"gFJ9vytznc"},{"type":"inlineCode","value":"llm_label","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"DVL0wPTXwd"},{"type":"text","value":" in another.","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"HYizHgVwar"}],"key":"Diw7pGUyZI"},{"type":"paragraph","position":{"start":{"line":188,"column":1},"end":{"line":189,"column":1}},"children":[{"type":"text","value":"Conversely, using the same name to represent two different concepts can lead the reader to think that they are referring to the same thing, which is called a “jingle fallacy.” For example, if one were to use the variable name ","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"key":"hWaEMjtuHp"},{"type":"inlineCode","value":"model","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"key":"Qik78eNRWi"},{"type":"text","value":" to refer to a model class within one function but to a string containing the model name in another function.\nThis fallacy is particularly likely to occur when one uses names that are too simple (see below).","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"key":"isH270Q6rI"}],"key":"yuofQq9NFX"},{"type":"heading","depth":5,"position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"children":[{"type":"text","value":"Understandability","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"OVdlZS8j1i"}],"identifier":"understandability","label":"Understandability","html_id":"understandability","implicit":true,"key":"WvVg66c4Im"},{"type":"blockquote","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"children":[{"type":"text","value":"“A name should describe the concept it represents.”","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"key":"W9mZeUSOhf"}],"key":"F4vfscwvyI"}],"key":"caQiKbV1Sc"},{"type":"paragraph","position":{"start":{"line":195,"column":1},"end":{"line":199,"column":1}},"children":[{"type":"text","value":"The reader should be able to accurately infer from the name what is being represented.\nThis implies the common proscription against single-letter variable names, except in cases where the context makes very clear what its function is (e.g. as a counter in a compact loop).\nMore generally, when creating a variable name it’s worth thinking about what kind of confusion might occur, and also who the intended audiences are.\nFor example, it can be particularly useful to select terms that are common within the relevant scientific domain when available.\nOther important guidelines for understandability are using the right pluralization (e.g. a variable with a pluralized name should contain more than one thing, and vice versa for variables with a single name) and the right part of speech (for example, functions should generally use verbs while variables and classes should generally use nouns).","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"J0AX38A2VN"}],"key":"ENNjjwlJUK"},{"type":"heading","depth":5,"position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"children":[{"type":"text","value":"Specificity","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"DFMKa80JnY"}],"identifier":"specificity","label":"Specificity","html_id":"specificity","implicit":true,"key":"q45lhjUcph"},{"type":"blockquote","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"children":[{"type":"text","value":"“A name shouldn’t be overly vague or overly specific.”","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"UIyomEFvbf"}],"key":"iqUroe5iuH"}],"key":"MflOXi0v7J"},{"type":"paragraph","position":{"start":{"line":205,"column":1},"end":{"line":208,"column":1}},"children":[{"type":"text","value":"One should avoid very generic names such as “object” or “request”.\nIn addition, the name of a function should highlight its intended use, rather than details about the implementation.\nFor example, say that we develop a function that uses a fast Fourier transform to perform bandpass filtering a timeseries.\nA name like ","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"uIZskcfBIC"},{"type":"inlineCode","value":"filter_timeseries_bandpass","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"DhfVDe2WqI"},{"type":"text","value":" focuses on the intended use, whereas a name like ","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"l0ADBkDnpX"},{"type":"inlineCode","value":"fft_timeseries","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"L1oV8M0MgR"},{"type":"text","value":" would highlight the implementation details without specifying what the function is meant to do.","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"q0Z09UVcCM"}],"key":"uV3uVVSOt0"},{"type":"heading","depth":5,"position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"children":[{"type":"text","value":"Brevity","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"lQK6Ob6OAV"}],"identifier":"brevity","label":"Brevity","html_id":"brevity","implicit":true,"key":"qZLCT6eseI"},{"type":"blockquote","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"children":[{"type":"text","value":"“A name should be neither overly short nor overly long.”","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"LOI2ccTki1"}],"key":"rwy5vImaGk"}],"key":"lEJ9io1KTk"},{"type":"paragraph","position":{"start":{"line":214,"column":1},"end":{"line":218,"column":1}},"children":[{"type":"text","value":"Most coders tend to err on the side of variables names that are too short, with single-letter names being epitome of this.\nOne useful concept from Martin’s ","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"j2xB5hgnbd"},{"type":"emphasis","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"children":[{"type":"text","value":"Clean Code","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"Rv2G92OHqk"}],"key":"nKI7VOQGSH"},{"type":"text","value":" is that the length of a variable name should be related to the scope of the variable.\nWhen a single-letter variable name is used in the context of a very compact loop, its meaning will be immediately obvious.\nHowever, as a variable is used across a broader scope, using a more detailed name will allow the reader to understand the variable without having to look back at where it was previously used to understand its meaning.\nWe would generally suggest to err on the side of using names that are too long versus too short, since the cost to typing longer names is reduced by the autocompletion features present in modern IDEs.","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"y6n3Al4qWv"}],"key":"b1EEum8dmQ"},{"type":"heading","depth":5,"position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"children":[{"type":"text","value":"Pronounceability","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"bKMCX6BLJg"}],"identifier":"pronounceability","label":"Pronounceability","html_id":"pronounceability","implicit":true,"key":"IyCTblbSBO"},{"type":"blockquote","position":{"start":{"line":222,"column":1},"end":{"line":222,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":222,"column":1},"end":{"line":222,"column":1}},"children":[{"type":"text","value":"“A name should be easy to use in common speech.”","position":{"start":{"line":222,"column":1},"end":{"line":222,"column":1}},"key":"XD90H11ZJG"}],"key":"QMOjs2R5YT"}],"key":"D7wrVnvmNA"},{"type":"paragraph","position":{"start":{"line":224,"column":1},"end":{"line":226,"column":1}},"children":[{"type":"text","value":"Pronounceability is primarily important for cognitive reasons: We are much more likely to remember things that are meaningful to us compared to things that don’t have obvious meaning.\nIn addition, an unpronounceable name makes communicating about the object with others (e.g. in a code review) very difficult.\nSo while ","position":{"start":{"line":224,"column":1},"end":{"line":224,"column":1}},"key":"UDAM7Xd7UC"},{"type":"inlineCode","value":"bfufftots","position":{"start":{"line":224,"column":1},"end":{"line":224,"column":1}},"key":"AtLk7sWd3b"},{"type":"text","value":" might seem like a clever acronym for “bandpass filter using FFT on time series”, ","position":{"start":{"line":224,"column":1},"end":{"line":224,"column":1}},"key":"MnPJY5W7EX"},{"type":"inlineCode","value":"filter_timeseries_bandpass","position":{"start":{"line":224,"column":1},"end":{"line":224,"column":1}},"key":"CbU8QroNDF"},{"type":"text","value":" is probably more effective and will certainly be clearer to readers.","position":{"start":{"line":224,"column":1},"end":{"line":224,"column":1}},"key":"rd7bjiCxC4"}],"key":"fIM8ITGwUq"},{"type":"heading","depth":5,"position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"text","value":"Austerity","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"fJvvGeU7bt"}],"identifier":"austerity","label":"Austerity","html_id":"austerity","implicit":true,"key":"OPTq8yrQoq"},{"type":"blockquote","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"children":[{"type":"text","value":"“A name should not be clever or rely on temporary concepts.”","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"gegljmu3lv"}],"key":"GvyK58VhOO"}],"key":"mkapOfrRgR"},{"type":"paragraph","position":{"start":{"line":232,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"Programmers often like to use humorous or clever object names.\nFor example, a function that marks a directory for later deletion might be called ","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"gzGtDCwY5K"},{"type":"inlineCode","value":"terminator()","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"BRMZFmvZ1s"},{"type":"text","value":" (riffing on Schwarzenegger’s “I’ll be back”.) As clever as this might seem, it’s not useful for anyone who doesn’t have the same cultural context.\nObject names should be boring and matter-of-fact to ensure that they are as widely understandable as possible.","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"JDMvAggyMv"}],"key":"wd1ZfUwBBN"},{"type":"heading","depth":4,"position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"children":[{"type":"text","value":"Using empty space properly","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"k6Q36Fkagq"}],"identifier":"using-empty-space-properly","label":"Using empty space properly","html_id":"using-empty-space-properly","implicit":true,"key":"Fq7asbPNRP"},{"type":"paragraph","position":{"start":{"line":238,"column":1},"end":{"line":240,"column":1}},"children":[{"type":"text","value":"Another important aspect of readability is the judicious use of empty space.\nWhile users of other languages sometimes revolt at the fact that empty space plays a syntactic role in Python, we actually view this is a very useful feature of the language, because it enhances the readability of code.\nFor example, the following code is perfectly legitimate in R, but inferring its structure from a quick glance is difficult:","position":{"start":{"line":238,"column":1},"end":{"line":238,"column":1}},"key":"AqdtTB1fqL"}],"key":"u4bvXE5tmB"},{"type":"code","lang":"r","value":"trans_levels <- list(); for (gene in genes) {snps <- get_snps(gene, \n  .001)\n  trans_levels[[gene]] <- \nget_transcript_level(gene, snps)}; phenotype <- get_phen(gene, trans_levels[[gene]])","position":{"start":{"line":242,"column":1},"end":{"line":247,"column":1}},"key":"jBBbLvdt5k"},{"type":"paragraph","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"text","value":"On the other hand, the syntactic role of horizontal empty space in Python enforces much clearer visual structure:","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"qwG39Dni8W"}],"key":"dNCA1Fomni"},{"type":"code","lang":"python","value":"trans_levels = {}\nfor gene in genes:\n    snps = get_snps(gene, .001)\n    trans_levels[gene] = get_transcript_level(gene, snps)\nphenotype <- get_phen(gene, trans_levels[gene])","position":{"start":{"line":251,"column":1},"end":{"line":257,"column":1}},"key":"C88FKl8ApX"},{"type":"paragraph","position":{"start":{"line":259,"column":1},"end":{"line":260,"column":1}},"children":[{"type":"text","value":"It is also important to use vertical empty space to separate conceptually distinct sections of code.\nIn this case, this helps make more visually apparent the fact that there is likely an error in the code, with the ","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"rK0nx1yEga"},{"type":"inlineCode","value":"gene","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"xQsC0pGqSA"},{"type":"text","value":" variable that indexes the loop being used outside of the loop.","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"bqlvsF7q3v"}],"key":"ErUWbrSLHr"},{"type":"paragraph","position":{"start":{"line":262,"column":1},"end":{"line":263,"column":1}},"children":[{"type":"text","value":"Vertical empty space also plays a role in readability, by helping to distinguish conceptually or logically related section of code.\nAt the same time, it’s important to not overuse vertical white space; our ability to understand code that we can see at once is much better than understanding code that spreads across multiple screen pages (which requires holding information in working memory), so it’s important to use vertical empty space judiciously.","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"JTOxD3ekLW"}],"key":"z4C8fjAH4A"},{"type":"heading","depth":4,"position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"children":[{"type":"text","value":"Commenting code","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"hXcTkVmojV"}],"identifier":"commenting-code","label":"Commenting code","html_id":"commenting-code","implicit":true,"key":"jkCMMnihbN"},{"type":"paragraph","position":{"start":{"line":267,"column":1},"end":{"line":269,"column":1}},"children":[{"type":"text","value":"There are few topics where the common understanding differs so much from expert consensus as in the use of comments within code.\nFor many programmers, the term “documentation” is largely synonymous with code comments, and it is common to hear novice programmers complaining about the need to add comments to their code before releasing it.\nOn the other hand, one of the most consistent messages from the software engineering literature is that comments are far too often used as a “magic balm” over bad code:","position":{"start":{"line":267,"column":1},"end":{"line":267,"column":1}},"key":"cmfcmJ9lrK"}],"key":"Z4haPcxGGd"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":271,"column":1},"end":{"line":274,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"“Don’t comment bad code — rewrite it” (Kernighan & Plaugher)","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"key":"hKP5UFqFWU"}],"key":"cQ5kzpn3A2"}],"key":"Nt2hqvOzUl"},{"type":"listItem","spread":true,"position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"“Clear and expressive code with few comments is far superior to cluttered and complex code with lots of comments” (Robert Martin, Clean Code)","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"pqhNFXpfaN"}],"key":"fjlAOviYgx"}],"key":"LKbJheTUvq"},{"type":"listItem","spread":true,"position":{"start":{"line":273,"column":1},"end":{"line":274,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"“comments aren’t a bad smell; indeed they are a sweet smell. The reason we mention comments here is that comments are often used as a deodorant. It’s surprising how often you look at thickly commented code and notice that the comments are there because the code is bad.” (Fowler, Refactoring)","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"key":"CwVWsjxVob"}],"key":"ftQWEWupDa"}],"key":"tysJAWMJQ2"}],"key":"V0b6riLcww"},{"type":"paragraph","position":{"start":{"line":275,"column":1},"end":{"line":276,"column":1}},"children":[{"type":"text","value":"The overall goal of code comments should be to help the reader know as much as the writer knows about the code.\nWe will start by outlining the kinds of things that do ","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"key":"iNDyjovQy5"},{"type":"emphasis","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"children":[{"type":"text","value":"not","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"key":"GCviVnrijm"}],"key":"cx4Qu1pxvX"},{"type":"text","value":" warrant comments, and then turn to the legitimate uses of comments.","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"key":"nEgBKJJkeQ"}],"key":"HRUw71REUD"},{"type":"heading","depth":5,"position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"text","value":"What not to comment","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"M4nlVOrxCt"}],"identifier":"what-not-to-comment","label":"What not to comment","html_id":"what-not-to-comment","implicit":true,"key":"ti7pUPHxXL"},{"type":"heading","depth":6,"position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"children":[{"type":"text","value":"Ugly or indecipherable code","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"LNYlTXu8BL"}],"identifier":"ugly-or-indecipherable-code","label":"Ugly or indecipherable code","html_id":"ugly-or-indecipherable-code","implicit":true,"key":"IhvpcS9CWM"},{"type":"paragraph","position":{"start":{"line":282,"column":1},"end":{"line":282,"column":1}},"children":[{"type":"text","value":"Rather that adding comments, one should instead refactor so that the code is understandable.","position":{"start":{"line":282,"column":1},"end":{"line":282,"column":1}},"key":"i7i7yl8v77"}],"key":"y0D9TAVqou"},{"type":"code","lang":"python","value":"# function to create a random normal variate\n# takes mean and SD as arguments\ndef crv(a=0, b=1):\n    u = [random.random() for i in range(2)]\n    z = math.sqrt(-2 * math.log(u[0])) * \\\n        math.cos(2 * math.pi * u[1])\n    return a + b * z","position":{"start":{"line":284,"column":1},"end":{"line":292,"column":1}},"key":"zNPkE1C8UV"},{"type":"paragraph","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"children":[{"type":"text","value":"• instead, use understandable names:","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"Xi2vNYxeZ7"}],"key":"qIKGDBCZFa"},{"type":"code","lang":"python","value":"def random_normal_variate(mean=0, stddev=1):\n    unif = [random.random() for i in range(2)]\n    box_mueller_z0 = math.sqrt(-2 * math.log(unif[0])) * \\\n        math.cos(2 * math.pi * unif[1])\n    return mean + stddev * box_mueller_z0","position":{"start":{"line":296,"column":1},"end":{"line":302,"column":1}},"key":"cKPH24qD3J"},{"type":"paragraph","position":{"start":{"line":304,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"text","value":"In this case, we don’t need a comment to explain the function because its name and the names of its arguments make clear what its function is and how to use it.\nBy using the variable name ","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"UgODwN9u2L"},{"type":"inlineCode","value":"box_mueller_z0","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"x4E4SHydCB"},{"type":"text","value":" we also make clear what algorithm this computation reflects (the Box-Mueller transform).","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"udsShrSLRm"}],"key":"whfz4wlKZo"},{"type":"heading","depth":6,"position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"children":[{"type":"text","value":"The obvious","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"OhWj9OxPWT"}],"identifier":"the-obvious","label":"The obvious","html_id":"the-obvious","implicit":true,"key":"Yw1lXycGhZ"},{"type":"paragraph","position":{"start":{"line":309,"column":1},"end":{"line":310,"column":1}},"children":[{"type":"text","value":"Anything that is clear from the structure of the code or the names of the variables doesn’t need to be commented.\nHere are some examples of unnecessary comments:","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"hyOAPahmK9"}],"key":"qKdiMfFjoK"},{"type":"code","lang":"python","value":"# looping over states\nfor state_index, state in enumerate(states):\n    ...\n\n# function to create a random normal variate\ndef create_random_normal_variate(mean, sd):\n    ...","position":{"start":{"line":312,"column":1},"end":{"line":320,"column":1}},"key":"Gj3SI3OzOn"},{"type":"paragraph","position":{"start":{"line":322,"column":1},"end":{"line":323,"column":1}},"children":[{"type":"text","value":"In general one should assume that the reader of code has a good understanding of the language, such that they could understand that first example involves a loop over states.\nAn exception to this rule is when one is writing code for educational purposes; in that case, one might want to include comments that are more didactic even though they would cause clutter for an experienced programmer.","position":{"start":{"line":322,"column":1},"end":{"line":322,"column":1}},"key":"fqZ0MPQAyc"}],"key":"GKL1rKXA48"},{"type":"heading","depth":6,"position":{"start":{"line":326,"column":1},"end":{"line":326,"column":1}},"children":[{"type":"text","value":"Historical information","position":{"start":{"line":326,"column":1},"end":{"line":326,"column":1}},"key":"WxWjRYx7Ee"}],"identifier":"historical-information","label":"Historical information","html_id":"historical-information","implicit":true,"key":"UaEQJ7TXfQ"},{"type":"paragraph","position":{"start":{"line":328,"column":1},"end":{"line":328,"column":1}},"children":[{"type":"text","value":"Rather than including historical notes about the code:","position":{"start":{"line":328,"column":1},"end":{"line":328,"column":1}},"key":"C7zm7QvpV3"}],"key":"xyniXXrU1k"},{"type":"code","lang":"python","value":"# RP changed on 2/22/2025 to include sd argument\ndef random_normal_variate(mean=0, stddev=1):\n    ...","position":{"start":{"line":330,"column":1},"end":{"line":334,"column":1}},"key":"zof9YUkGYl"},{"type":"paragraph","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"children":[{"type":"text","value":"One should instead use a version control to track changes.","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"key":"u4xndQCM8G"}],"key":"iojjxDU0XU"},{"type":"code","lang":"bash","value":"git commit -m\"feature: added std dev argument to random_normal_variate\"","position":{"start":{"line":338,"column":1},"end":{"line":340,"column":1}},"key":"HQQ8TkaRcn"},{"type":"paragraph","position":{"start":{"line":342,"column":1},"end":{"line":342,"column":1}},"children":[{"type":"text","value":"It’s then possible to see who is responsible for each line in a particular source file using the ","position":{"start":{"line":342,"column":1},"end":{"line":342,"column":1}},"key":"BCRYY8z0Mz"},{"type":"inlineCode","value":"git blame","position":{"start":{"line":342,"column":1},"end":{"line":342,"column":1}},"key":"YZrDXa5kLr"},{"type":"text","value":" function:","position":{"start":{"line":342,"column":1},"end":{"line":342,"column":1}},"key":"Mf0EenxO6v"}],"key":"UpnpSsjZmS"},{"type":"code","lang":"bash","value":"> git blame random_numbers.py\n^e14a07d (Russell Poldrack 2025-02-22 07:54:37 -0800 1) import random\n^e14a07d (Russell Poldrack 2025-02-22 07:54:37 -0800 2) import math\n^e14a07d (Russell Poldrack 2025-02-22 07:54:37 -0800 3)\n73cee79c (Russell Poldrack 2025-02-22 07:55:19 -0800 4) def random_normal_variate(mean=0, stddev=1):\n^e14a07d (Russell Poldrack 2025-02-22 07:54:37 -0800 5)     unif = [random.random() for i in range(2)]\n^e14a07d (Russell Poldrack 2025-02-22 07:54:37 -0800 6)     box_mueller_z0 = math.sqrt(-2 * math.log(unif[0])) * \\\n^e14a07d (Russell Poldrack 2025-02-22 07:54:37 -0800 7)         math.cos(2 * math.pi * unif[1])\n73cee79c (Russell Poldrack 2025-02-22 07:55:19 -0800 8)     return mean +  stddev * box_mueller_z0","position":{"start":{"line":344,"column":1},"end":{"line":354,"column":1}},"key":"OKZ6pJOvks"},{"type":"heading","depth":5,"position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"children":[{"type":"text","value":"What to comment","position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"key":"rbEVQIVJh8"}],"identifier":"what-to-comment","label":"What to comment","html_id":"what-to-comment","implicit":true,"key":"zMXVlKFhez"},{"type":"heading","depth":6,"position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"children":[{"type":"text","value":"Intention (aka “Director’s Commentary”)","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"key":"WG6YmXHqnv"}],"identifier":"intention-aka-directors-commentary","label":"Intention (aka “Director’s Commentary”)","html_id":"intention-aka-directors-commentary","implicit":true,"key":"H5v3dHCLdk"},{"type":"paragraph","position":{"start":{"line":360,"column":1},"end":{"line":361,"column":1}},"children":[{"type":"text","value":"Comments should help the reader understand important design choices that would not be evident from simply reading the code.\nFor example:","position":{"start":{"line":360,"column":1},"end":{"line":360,"column":1}},"key":"P1uVfD4POn"}],"key":"wn4rCkwes6"},{"type":"code","lang":"python","value":"# using a numpy array here rather than\n# a pandas DataFrame for performance reasons","position":{"start":{"line":363,"column":1},"end":{"line":366,"column":1}},"key":"d3jXaE7CUb"},{"type":"paragraph","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"strong","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"text","value":"TODO","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"Iy3McXIDs4"}],"key":"g3DqBdeoVW"},{"type":"text","value":": More examples here","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"coVTGC8Oyh"}],"key":"JFcDUGp43t"},{"type":"heading","depth":6,"position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"children":[{"type":"text","value":"Known flaws or TODO items","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"DsCF0VowOn"}],"identifier":"known-flaws-or-todo-items","label":"Known flaws or TODO items","html_id":"known-flaws-or-todo-items","implicit":true,"key":"M3hYbUThQ7"},{"type":"paragraph","position":{"start":{"line":372,"column":1},"end":{"line":374,"column":1}},"children":[{"type":"text","value":"It’s often the case that there are remaining known issues with code that the developer has not yet had the time to address.\nThese should be noted with a consistent heading (e.g. “TODO”) so that they can be easily searched for.\nFor example:","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"FTQg7UEB3w"}],"key":"h2Ck72pH8m"},{"type":"code","lang":"python","value":"# TODO: Current algorithm is very inefficient\n# - should parallelize to improve performance","position":{"start":{"line":376,"column":1},"end":{"line":379,"column":1}},"key":"qgtXuE5dni"},{"type":"heading","depth":6,"position":{"start":{"line":381,"column":1},"end":{"line":381,"column":1}},"children":[{"type":"text","value":"Comments on constant values","position":{"start":{"line":381,"column":1},"end":{"line":381,"column":1}},"key":"en31z7kAQl"}],"identifier":"comments-on-constant-values","label":"Comments on constant values","html_id":"comments-on-constant-values","implicit":true,"key":"Ccq2x1Y853"},{"type":"paragraph","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"children":[{"type":"text","value":"When including constant values, it can be useful to describe the motivation for the specific value chosen.","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"eIP22t16hC"}],"key":"jtGxQ0IbMS"},{"type":"code","lang":"python","value":"# Using 500 bootstrap replicates based on recommendation \n# from Efron & Tibshirani 1993\nn_replicates = 500","position":{"start":{"line":385,"column":1},"end":{"line":389,"column":1}},"key":"PS3MTUHNFC"},{"type":"heading","depth":3,"position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"children":[{"type":"text","value":"Avoiding “code smells” and “anti-patterns”","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"key":"e9ifzPyCIN"}],"identifier":"avoiding-code-smells-and-anti-patterns","label":"Avoiding “code smells” and “anti-patterns”","html_id":"avoiding-code-smells-and-anti-patterns","implicit":true,"key":"klWLwmCrPM"},{"type":"paragraph","position":{"start":{"line":394,"column":1},"end":{"line":398,"column":1}},"children":[{"type":"text","value":"There are two related concepts that are used to describe the appearance of potentially problematic code The “anti-pattern” is a riff on the concept of a ","position":{"start":{"line":394,"column":1},"end":{"line":394,"column":1}},"key":"LDvChRcJLF"},{"type":"emphasis","position":{"start":{"line":394,"column":1},"end":{"line":394,"column":1}},"children":[{"type":"text","value":"design pattern","position":{"start":{"line":394,"column":1},"end":{"line":394,"column":1}},"key":"rdlRt0T23n"}],"key":"NyHfhLeXbv"},{"type":"text","value":", which is a recommended solution (i.e. a “best practice”) for a common programming problem ","position":{"start":{"line":394,"column":1},"end":{"line":394,"column":1}},"key":"z6iJVStwfp"},{"type":"citeGroup","kind":"parenthetical","position":{"start":{"line":394,"column":1},"end":{"line":394,"column":1}},"children":[{"type":"cite","identifier":"gamma:1995aa","label":"Gamma:1995aa","kind":"parenthetical","position":{"start":{"line":394,"column":263},"end":{"line":394,"column":276}},"children":[{"type":"text","value":"Gamma, 1995","key":"WynCUStkgs"}],"enumerator":"2","key":"t3BIM0FoCs"}],"key":"fd8QaVqLL7"},{"type":"text","value":".\nAn anti-pattern is conversely a commonly used but bad solution (i.e. a “worst practice”) for a common programming problem.\nIn the Python world these are well known from the ","position":{"start":{"line":394,"column":1},"end":{"line":394,"column":1}},"key":"mvZAYp5Jto"},{"type":"link","url":"https://docs.quantifiedcode.com/python-anti-patterns/","position":{"start":{"line":394,"column":1},"end":{"line":394,"column":1}},"children":[{"type":"text","value":"The Little Book of Python Anti-Patterns","position":{"start":{"line":394,"column":1},"end":{"line":394,"column":1}},"key":"KdpCMuNgOv"}],"urlSource":"https://docs.quantifiedcode.com/python-anti-patterns/","key":"S4jwn5CoaV"},{"type":"text","value":", which lays out many different anti-patterns common in Python coding.\nThe second idea, that of the “code smell”, has been popularized by Martin Fowler in his well-known book *Refactoring: Improving The Design of Existing Code *","position":{"start":{"line":394,"column":1},"end":{"line":394,"column":1}},"key":"AeE9r7LKxM"},{"type":"citeGroup","kind":"parenthetical","position":{"start":{"line":394,"column":1},"end":{"line":394,"column":1}},"children":[{"type":"cite","identifier":"fowler:1999aa","label":"Fowler:1999aa","kind":"parenthetical","position":{"start":{"line":394,"column":777},"end":{"line":394,"column":791}},"children":[{"type":"text","value":"Fowler & Beck, 1999","key":"ArlozI1kzH"}],"enumerator":"3","key":"qSuf7dI6mr"}],"key":"yygZR1L4dJ"},{"type":"text","value":".\nJust as a bad smell from food can give us an intuitive sense that the good might be spoiled, code smells are intuitive reactions to code that suggest that there might be a problem that could be a target for refactoring.","position":{"start":{"line":394,"column":1},"end":{"line":394,"column":1}},"key":"pYmOQthPgF"}],"key":"NeEqZ8gAJk"},{"type":"paragraph","position":{"start":{"line":400,"column":1},"end":{"line":400,"column":1}},"children":[{"type":"text","value":"Here we outline several bad smells and anti-patterns commonly found in our experience with scientific code.","position":{"start":{"line":400,"column":1},"end":{"line":400,"column":1}},"key":"tQ8GD3P5Zb"}],"key":"oq34KE9QML"},{"type":"heading","depth":4,"position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"children":[{"type":"text","value":"Duplicated code","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"zuciUcTkjx"}],"identifier":"duplicated-code","label":"Duplicated code","html_id":"duplicated-code","implicit":true,"key":"D3ziIg1WOa"},{"type":"paragraph","position":{"start":{"line":404,"column":1},"end":{"line":405,"column":1}},"children":[{"type":"text","value":"One of the most common smells in scientific code is the use of repeated blocks of duplicated code with only minor changes.\nFor example:","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"key":"lvAno10Yoa"}],"key":"ig6mAwNnCk"},{"type":"code","lang":"python","value":"# Compute mean response time separately for each test (bad practice)\nmean_rt_1 = stroop_data['ResponseTime'].mean()\nmean_rt_2 = flanker_data['RT'].mean()\nmean_rt_3 = nback_data['RespTime'].mean()\ngrand_mean_rt = np.mean([mean_rt_1, mean_rt_2, mean_rt_3])","position":{"start":{"line":407,"column":1},"end":{"line":413,"column":1}},"key":"cslcpnUyzU"},{"type":"paragraph","position":{"start":{"line":415,"column":1},"end":{"line":420,"column":1}},"children":[{"type":"text","value":"This code might work, but it violates the commonly stated principle of “Don’t Repeat Yourself” (DRY), and is problematic for several reasons.\nFirst, any changes to the intended operation (in this case computing the mean of the ‘ResponseTime’ variable in the data frame) would require making changes on multiple lines.\nIn this example the lines are close to one another so it would be easy to see that they all need to be changed, but if they were separated by many other others then one would need to be sure to make the change in each place.\nSecond, imagine that we wanted to include an additional task in the dataset; we would need to add a new line to compute the mean for the added condition, and also would need to remember to add it to the computation of the grand mean.\nThird, an especially strong code smell is the use of numbers as part of variable names, rather than using a data structure such as a dictionary or data frame that inherently represents the data within a single iterable object.\nLet’s say that we decided to remove the flanker task from our dataset; we would then need to remember to remove ","position":{"start":{"line":415,"column":1},"end":{"line":415,"column":1}},"key":"pKAd3pKBAC"},{"type":"inlineCode","value":"mean_rt_2","position":{"start":{"line":415,"column":1},"end":{"line":415,"column":1}},"key":"YlSSqkqILp"},{"type":"text","value":" from the grand mean computation, which would require working memory if those two lines were to become separated by other code.","position":{"start":{"line":415,"column":1},"end":{"line":415,"column":1}},"key":"MwD4Vbdr6M"}],"key":"CBMFUPNrCH"},{"type":"paragraph","position":{"start":{"line":422,"column":1},"end":{"line":422,"column":1}},"children":[{"type":"text","value":"Here is a refactored version of the code that:","position":{"start":{"line":422,"column":1},"end":{"line":422,"column":1}},"key":"saTfN9WjBQ"}],"key":"NCh9BwAOxL"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":424,"column":1},"end":{"line":428,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":424,"column":1},"end":{"line":424,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"extracts the task names and associated data frame column names for the response time variable for each into a dictionary","position":{"start":{"line":424,"column":1},"end":{"line":424,"column":1}},"key":"D4kpl6W7J1"}],"key":"fFZX2la5w0"}],"key":"z3GeSg9bio"},{"type":"listItem","spread":true,"position":{"start":{"line":425,"column":1},"end":{"line":425,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"creates a function that returns the mean of a given column in the data frame.  Its naming as “get_mean_response_time” will help the reader understand that “rt” refers to “response time” in the rest of the code (which is obvious to domain experts but not necessarily to others reading the code).","position":{"start":{"line":425,"column":1},"end":{"line":425,"column":1}},"key":"F2oBHRmuxV"}],"key":"OedbzYjVj7"}],"key":"HWUuCEvzqL"},{"type":"listItem","spread":true,"position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"loops through the dictionary elements and applies the function to the relevant column, saving them to a dictionary","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"key":"RXmvLRdmCZ"}],"key":"NvHr0y9Hlg"}],"key":"j73788Rsei"},{"type":"listItem","spread":true,"position":{"start":{"line":427,"column":1},"end":{"line":428,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"computes the grand mean using the values from the dictionary created from each dataset","position":{"start":{"line":427,"column":1},"end":{"line":427,"column":1}},"key":"mOHuk9xOje"}],"key":"luaI9jBAyi"}],"key":"Oh2q9tl3Cg"}],"key":"SGwAoXlXf8"},{"type":"code","lang":"python","value":"    rt_column_names = {\n        'stroop': 'ResponseTime',\n        'flanker': 'RT',\n        'nback': 'RespTime'\n    }\n\n    def get_mean_response_time(testdata, column_name):\n        return testdata[column_name].mean()\n\n    mean_rt = {}\n    for test, column_name in rt_column_names.items():\n        mean_rt[test] = get_mean_response_time(\n            data[test],\n            column_name)\n\n    grand_mean_rt = np.mean(list(mean_rt.values()))","position":{"start":{"line":429,"column":1},"end":{"line":446,"column":1}},"key":"UBnUihwyfX"},{"type":"paragraph","position":{"start":{"line":448,"column":1},"end":{"line":449,"column":1}},"children":[{"type":"text","value":"This refactoring has more lines of code than the original, but it will be much easier to understand, to maintain, and to modify.\nAlso note the use of vertical empty space to highlight the distinct logical components of the code.","position":{"start":{"line":448,"column":1},"end":{"line":448,"column":1}},"key":"bIJtVj5Obq"}],"key":"jexEjgH6Ct"},{"type":"heading","depth":4,"position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"children":[{"type":"text","value":"Magic numbers","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"key":"nL5UTT1PVv"}],"identifier":"magic-numbers","label":"Magic numbers","html_id":"magic-numbers","implicit":true,"key":"qCQCASunVB"},{"type":"paragraph","position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"children":[{"type":"text","value":"A ","position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"key":"a91ZPW8G1U"},{"type":"emphasis","position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"children":[{"type":"text","value":"magic number","position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"key":"qkB2JfvpLq"}],"key":"VZ6EHIFiKM"},{"type":"text","value":" is a number that is included in code directly rather than via assignment to a variable For example:","position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"key":"W8KBCI9ZWh"}],"key":"NfuCSKTEaH"},{"type":"code","lang":"python","value":"def proportion_significant(data):\n    return np.mean(data > 3.09)","position":{"start":{"line":455,"column":1},"end":{"line":458,"column":1}},"key":"XY72NdHoSQ"},{"type":"paragraph","position":{"start":{"line":460,"column":1},"end":{"line":463,"column":1}},"children":[{"type":"text","value":"What does “3.09” refer to? A statistically literate reader might infer that this was meant to refer to the 99.9th percentile of the standard normal (Z) distribution, but couldn’t be certain without talking to the developer.\nAnother particular problem with floating point magic numbers is that they often are rounded (i.e. 3.09 rather than 3.090232306167813), which could lead to imprecision in the results in some contexts.\nAn additional problem with this particular function is that the value can’t be changed by the user of the function.\nIt would be better compute the value formally based on an explicit input of the probability, and then assign it to a named variable that makes clear what it means:","position":{"start":{"line":460,"column":1},"end":{"line":460,"column":1}},"key":"abfNFlMBAP"}],"key":"fH2BK0slCX"},{"type":"code","lang":"python","value":"def proportion_exceeding_threshold(data, p_threshold=.001):\n    z_cutoff = scipy.stats.norm.ppf(1 - p_threshold)\n    return np.mean(data > z_cutoff)","position":{"start":{"line":465,"column":1},"end":{"line":469,"column":1}},"key":"tRODdY3Ytr"},{"type":"heading","depth":4,"position":{"start":{"line":471,"column":1},"end":{"line":471,"column":1}},"children":[{"type":"text","value":"Long parameter lists","position":{"start":{"line":471,"column":1},"end":{"line":471,"column":1}},"key":"D60TDWHWup"}],"identifier":"long-parameter-lists","label":"Long parameter lists","html_id":"long-parameter-lists","implicit":true,"key":"WyD6Cxz6jr"},{"type":"paragraph","position":{"start":{"line":473,"column":1},"end":{"line":475,"column":1}},"children":[{"type":"text","value":"A long list of parameters in a function definition can be confusing for users.\nOne way that Python coders sometimes get around specifying long parameter lists is the use of the ","position":{"start":{"line":473,"column":1},"end":{"line":473,"column":1}},"key":"PXo8bqHxBH"},{"type":"inlineCode","value":"**kwargs","position":{"start":{"line":473,"column":1},"end":{"line":473,"column":1}},"key":"AQvufNi656"},{"type":"text","value":" argument, which allows the specification of arbitrary keyword arguments to a function, placing them within a dictionary.\nFor example:","position":{"start":{"line":473,"column":1},"end":{"line":473,"column":1}},"key":"hbPfAMdXGv"}],"key":"j6UW7aCMcY"},{"type":"code","lang":"python","value":"In [36]: def myfunc(**kwargs):\n            print(kwargs)\n\nIn [37]: myfunc(myarg=1, mybool=True)\n{'myarg': 1, 'mybool': True}","position":{"start":{"line":477,"column":1},"end":{"line":483,"column":1}},"key":"y3piQx6yca"},{"type":"paragraph","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"children":[{"type":"text","value":"This can be useful in specific cases, but in general should be avoided if possible, as it makes the code less clear and allows for potential type errors.","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"Vw8NtG1LJP"}],"key":"hxqs9RSb8p"},{"type":"paragraph","position":{"start":{"line":487,"column":1},"end":{"line":489,"column":1}},"children":[{"type":"text","value":"A useful solution when one needs to pass a large number of named parameters is to create a ","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"Q1pTOdvzSa"},{"type":"emphasis","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"children":[{"type":"text","value":"configuration object","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"Lq05s5YCgM"}],"key":"if56n6ODQy"},{"type":"text","value":" that contains all of these parameters.\nThis can be easily accomplished using ","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"t0J3JGg02x"},{"type":"emphasis","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"children":[{"type":"text","value":"dataclasses","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"FlV2ElY90y"}],"key":"InQQBB0GPV"},{"type":"text","value":" within Python, which are specialized classes meant to easily store data.\nHere is an example of a function call with a number of parameters:","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"wkiBYNGJRI"}],"key":"hkaIazDbgS"},{"type":"code","lang":"python","value":"\ndef run_llm_prompt(prompt, model='gpt4', random_seed=None, stream=True,\n                   temperature=0.7, max_tokens=256, verbose=False,\n                   system_prompt=None, max_response_length=None):\n    ...\n","position":{"start":{"line":491,"column":1},"end":{"line":498,"column":1}},"key":"Oo0vfFCUGc"},{"type":"paragraph","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"children":[{"type":"text","value":"We could instead first create a configuration class that allows us to define all of the optional parameters:","position":{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},"key":"FXVuqvzW7z"}],"key":"yV7BRbOgMV"},{"type":"paragraph","position":{"start":{"line":502,"column":1},"end":{"line":502,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":502,"column":1},"end":{"line":502,"column":1}},"children":[{"type":"text","value":"TODO","position":{"start":{"line":502,"column":1},"end":{"line":502,"column":1}},"key":"EyFCCkRRcR"}],"key":"QuwbgXRVW7"},{"type":"text","value":": DO WE ACTUALLY WANT TO USE TYPE HINTS THROUGHOUT? IF SO, WE PROBABLY NEED TO INTRODUCE THEM EARLIER","position":{"start":{"line":502,"column":1},"end":{"line":502,"column":1}},"key":"h5TC0d5e4x"}],"key":"AA0UaMqwXz"},{"type":"code","lang":"python","value":"from dataclasses import dataclass, field\nfrom typing import Optional\n\n@dataclass\nclass LLMConfig:\n    model: str = 'gpt4'\n    random_seed: Optional[int] = None\n    stream: bool = True\n    temperature: float = 0.7\n    max_tokens: int = 256\n    verbose: bool = False\n    system_prompt: Optional[str] = None\n    max_response_length: Optional[int] = None\n\ndef run_llm_prompt(prompt, config):\n    ...\n\n# we could then use it like this, first setting any optional \nconfig = LLMConfig(\n    temperature=0.8,\n)\nrun_llm_prompt(config)","position":{"start":{"line":504,"column":1},"end":{"line":527,"column":1}},"key":"oxX1KjZzVl"},{"type":"paragraph","position":{"start":{"line":529,"column":1},"end":{"line":531,"column":1}},"children":[{"type":"text","value":"There are several reasons why using a configuration object is desirable.\nOne key advantage is consistency: if the function is called multiple times in different parts of the code, using the same configuration object guarantees that the same parameters are applied everywhere. This reduces the risk of subtle bugs caused by mismatched arguments.\nAnother benefit is maintainability: adding or removing parameters becomes easier, since you only update the configuration object rather than every function call. This enforces a stronger degree of modularity and makes the codebase more resilient to change.","position":{"start":{"line":529,"column":1},"end":{"line":529,"column":1}},"key":"AJYBY8qySI"}],"key":"juw21GVn3T"},{"type":"heading","depth":4,"position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"children":[{"type":"text","value":"Wild-card imports","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"xVGZATtPer"}],"identifier":"wild-card-imports","label":"Wild-card imports","html_id":"wild-card-imports","implicit":true,"key":"n5SP6WY5E7"},{"type":"paragraph","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"children":[{"type":"text","value":"This is a Python-specific anti-pattern that is commonly seen in software written by researchers.","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"gtbxkgq5nl"}],"key":"lw1fwd5T4K"},{"type":"code","lang":"python","value":"from scipy.stats import *\nfrom numpy.random import *\n\nrandom_sample = vonmises(10, 2, size=1000)","position":{"start":{"line":538,"column":1},"end":{"line":543,"column":1}},"key":"GwArEnOW6Z"},{"type":"paragraph","position":{"start":{"line":545,"column":1},"end":{"line":547,"column":1}},"children":[{"type":"text","value":"In this example we have no idea where the vonmises() function is being specified.\nIn fact, both numpy.random and scipy.stats have an object named vonmises, so function that is called will depend on the order in which the two import functions are run.\nIt’s much better to explicitly import functions that are used:","position":{"start":{"line":545,"column":1},"end":{"line":545,"column":1}},"key":"DjIkojif2a"}],"key":"XiO4737hYa"},{"type":"code","lang":"python","value":"import scipy.stats as stats\nfrom numpy.random import vonmises\n\nrandom_sample = vonmises(10, 2, size=1000)\n# or\nrandom_sample = stats.vonmises.rvs(2, loc=10, size=1000)","position":{"start":{"line":550,"column":1},"end":{"line":557,"column":1}},"key":"bDtNbBgWu7"},{"type":"heading","depth":2,"position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"children":[{"type":"text","value":"Modularity","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"u4DPx1f4hw"}],"identifier":"modularity","label":"Modularity","html_id":"modularity","implicit":true,"key":"IsfIDM8kFH"},{"type":"paragraph","position":{"start":{"line":562,"column":1},"end":{"line":565,"column":1}},"children":[{"type":"text","value":"Another key to making a system understandable is to make it ","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"qAIz3ajNAH"},{"type":"emphasis","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"children":[{"type":"text","value":"modular","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"JDrBN1ykcM"}],"key":"scLxEpTQP9"},{"type":"text","value":", meaning that its functions can be decomposed into separate components that interact with one another only through defined interfaces.\nComplex modular systems are also usually ","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"zAoE4FGF5Z"},{"type":"emphasis","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"children":[{"type":"text","value":"hierarchical","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"oiMZNz93Zc"}],"key":"Q4MNchXi2N"},{"type":"text","value":", in the sense that they have multiple levels of organization and each component at one level can be broken down into a set of components at a lower level.\nIn a 1962 paper entitled *The Architecture of Complexity *","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"jFvUN6zWfN"},{"type":"citeGroup","kind":"parenthetical","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"children":[{"type":"cite","identifier":"simon:1962aa","label":"Simon:1962aa","kind":"parenthetical","position":{"start":{"line":562,"column":476},"end":{"line":562,"column":489}},"children":[{"type":"text","value":"Simon, 1962","key":"YKrkMPusDZ"}],"enumerator":"4","key":"V4N5x3J1fb"}],"key":"m9ojIlMeyT"},{"type":"text","value":", Herbert Simon argued that our ability to understand many different types of complex systems (physical, biological, and social) relies heavily on the ","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"H1MRQJXf0s"},{"type":"emphasis","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"children":[{"type":"text","value":"near-decomposability","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"uHzGx8Sugw"}],"key":"N3HM36by7G"},{"type":"text","value":" that arises in systems where the different modules are insulated from each other except through specific interfaces.\nThe importance of insulating different modules in computer programming was introduced in ","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"bjY4hw5NFx"},{"type":"citeGroup","kind":"parenthetical","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"children":[{"type":"cite","identifier":"parnas:1972aa","label":"Parnas:1972aa","kind":"parenthetical","partial":"year","position":{"start":{"line":562,"column":871},"end":{"line":562,"column":886}},"children":[{"type":"text","value":"1972","key":"KrtHtmBRgx"}],"enumerator":"5","key":"wgzw7MoET1"}],"key":"kpimxEXkK2"},{"type":"text","value":" by David Parnas , who pointed out that decomposing code based on the concept of “information hiding” can make code much easier to modify than a decomposition based on the logical “flowchart” of the problem being solved.","position":{"start":{"line":562,"column":1},"end":{"line":562,"column":1}},"key":"D10glgIJPX"}],"key":"rvmt6y4nce"},{"type":"paragraph","position":{"start":{"line":567,"column":1},"end":{"line":570,"column":1}},"children":[{"type":"text","value":"A common expression of the idea of modularity in software development is the ","position":{"start":{"line":567,"column":1},"end":{"line":567,"column":1}},"key":"Lg011LJVSL"},{"type":"emphasis","position":{"start":{"line":567,"column":1},"end":{"line":567,"column":1}},"children":[{"type":"text","value":"Single Responsibility Principle","position":{"start":{"line":567,"column":1},"end":{"line":567,"column":1}},"key":"vygGmh6XWx"}],"key":"pbYNKYZm9y"},{"type":"text","value":", which states that a function or class should only have one reason to change.\nThis principle is often summarized as saying that a function or class should only “do one thing”, but that’s too vague; a clearer way to state this is that a function or class should have a clear and cohesive purpose at the appropriate level of abstraction.\nLet’s look at an example to help make this clearer.\nSay that we are developing an analysis workflow for RNA-sequencing data, involving the following steps:","position":{"start":{"line":567,"column":1},"end":{"line":567,"column":1}},"key":"RXBvV4X4h8"}],"key":"pDg7whuhAF"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":572,"column":1},"end":{"line":577,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":572,"column":1},"end":{"line":572,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Read trimming and filtering","position":{"start":{"line":572,"column":1},"end":{"line":572,"column":1}},"key":"r7WeEbZB88"}],"key":"jH47soTX3H"}],"key":"TSqF0t4dqC"},{"type":"listItem","spread":true,"position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Alignment to reference genome","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"key":"uDG8dAKZYZ"}],"key":"QW3aMWplev"}],"key":"X7ApQjsKoX"},{"type":"listItem","spread":true,"position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Quantification of expression","position":{"start":{"line":574,"column":1},"end":{"line":574,"column":1}},"key":"YYnUgUwrZp"}],"key":"ziqkFrXeIZ"}],"key":"cnBwO3bXgI"},{"type":"listItem","spread":true,"position":{"start":{"line":575,"column":1},"end":{"line":575,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Normalization","position":{"start":{"line":575,"column":1},"end":{"line":575,"column":1}},"key":"LdtiIp8sMn"}],"key":"nt4KBZA0ys"}],"key":"O8bQhvHG9V"},{"type":"listItem","spread":true,"position":{"start":{"line":576,"column":1},"end":{"line":577,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Differential expression analysis","position":{"start":{"line":576,"column":1},"end":{"line":576,"column":1}},"key":"DmrkHC2Zli"}],"key":"O4hS4MzS9T"}],"key":"AG2rRRRqtD"}],"key":"h3Td5HU1Zo"},{"type":"paragraph","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"children":[{"type":"text","value":"At the highest level, we could specify a function that runs the entire workflow, taking in a raw data array and an object that contains configuration information:","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"VTd01ef8gH"}],"key":"wsXEfh7HjA"},{"type":"code","lang":"python","value":"def run_workflow(raw_data, config):\n    data = data_setup{raw_data, config}\n    data['trimfilt'] = run_trim_filt(data, config)\n    data['aligned'] = run_alignment(data, config)\n    data['quant'] = run_expression_quantification(data, config)\n    data['normalized'] = run_normalization(data, config)\n    data['diffexpress'] = run_differential_expression(data, config)\n    return data","position":{"start":{"line":580,"column":1},"end":{"line":589,"column":1}},"key":"c5d2Dz0d9a"},{"type":"paragraph","position":{"start":{"line":591,"column":1},"end":{"line":594,"column":1}},"children":[{"type":"text","value":"This function clearly performs several operations, but viewed from the appropriate level of abstraction, it does one thing: it executes the workflow.\nImportantly, the only thing that would cause this function to change is if the workflow changed; any changes within the components of the workflow would not require changes to this function.\nIn this way, the high level workflow manager is ","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"RPuYYXqzDC"},{"type":"emphasis","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"children":[{"type":"text","value":"insulated","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"bEvrsQ0WUx"}],"key":"T68nkiTl7D"},{"type":"text","value":" from the details of each of the components, interacting with them only through their outputs.\nEach of the different workflow components can also be insulated from the other components, as long as they rely only upon the arguments provided to the function.","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"Lo5sEiqPXT"}],"key":"IeatPGZ21a"},{"type":"heading","depth":3,"position":{"start":{"line":596,"column":1},"end":{"line":596,"column":1}},"children":[{"type":"text","value":"The “God object”","position":{"start":{"line":596,"column":1},"end":{"line":596,"column":1}},"key":"RKfVs5V83M"}],"identifier":"the-god-object","label":"The “God object”","html_id":"the-god-object","implicit":true,"key":"CUwKUAzTh1"},{"type":"paragraph","position":{"start":{"line":598,"column":1},"end":{"line":599,"column":1}},"children":[{"type":"text","value":"There is often a temptation when using object-oriented programming approaches to generate a single very large object that contains all relevant data and code for a particular problem.\nThese kinds of objects are sometimes referred to as “God objects” since they are meant to have a God’s-eye view of an entire project.","position":{"start":{"line":598,"column":1},"end":{"line":598,"column":1}},"key":"ZIB0t7RQWU"}],"key":"wXqkZKtWmq"},{"type":"paragraph","position":{"start":{"line":601,"column":1},"end":{"line":605,"column":1}},"children":[{"type":"text","value":"In 2019, I started developing data processing and analysis code for large project called the Neuroimaging Analysis Replication and Prediction Study (NARPS).\nWe won’t go into the details here; if you are interested, you can find more detail in a paper that we published in 2020 ","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"Nr2LDmRInC"},{"type":"citeGroup","kind":"parenthetical","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"children":[{"type":"cite","identifier":"botvinik-nezer:2020aa","label":"Botvinik-Nezer:2020aa","kind":"parenthetical","position":{"start":{"line":601,"column":279},"end":{"line":601,"column":301}},"children":[{"type":"text","value":"Botvinik-Nezer ","key":"qGBHxXLcyl"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"zkk5Md9pF0"}],"key":"TkeLr5R4ln"},{"type":"text","value":", 2020","key":"cKe0vnEZJl"}],"enumerator":"6","key":"uZZLLFWpkt"}],"key":"ghM0MkM4ks"},{"type":"text","value":", and the codebase is available at ","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"DU3eBUVtAF"},{"type":"link","url":"https://github.com/poldrack/narps","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"children":[{"type":"text","value":"https://​github​.com​/poldrack​/narps","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"kjCR0pPa3e"}],"urlSource":"https://github.com/poldrack/narps","error":true,"key":"SNO9EQOr40"},{"type":"text","value":".\nThe brief description is that 70 research groups were given the same raw brain imaging dataset and asked to analyze it and submit their results; it was these results that I was analyzing in order to determine how different analysis methods might lead to different results.\nIt had been a while since I had developed a project of scope, and I decided to use an object-oriented approach to developing the code.\nThis project ended up being one of the main reasons I became more interested in software engineering practices, but at this point I had not yet dived into the literature on good coding practices.","position":{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},"key":"VKjddeXV5i"}],"key":"Qt1tkteIcx"},{"type":"paragraph","position":{"start":{"line":607,"column":1},"end":{"line":608,"column":1}},"children":[{"type":"text","value":"I started by creating a main object, called ","position":{"start":{"line":607,"column":1},"end":{"line":607,"column":1}},"key":"jftigaeDGF"},{"type":"inlineCode","value":"Narps","position":{"start":{"line":607,"column":1},"end":{"line":607,"column":1}},"key":"rvyufR35yA"},{"type":"text","value":", which was meant to take in all of the information about the project and contain methods to perform all of the main analysis procedures.\nThis object was then called by each of a set of scripts that performed all of the main operations:","position":{"start":{"line":607,"column":1},"end":{"line":607,"column":1}},"key":"Pb3602dG1c"}],"key":"S0ixwtbSsb"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":610,"column":1},"end":{"line":616,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":610,"column":1},"end":{"line":610,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Preprocessing the images submitted by the teams","position":{"start":{"line":610,"column":1},"end":{"line":610,"column":1}},"key":"SPFvpmkzO7"}],"key":"T70gATsE4x"}],"key":"D5mZuH5CHa"},{"type":"listItem","spread":true,"position":{"start":{"line":611,"column":1},"end":{"line":611,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Preparing the metadata necessary for the analysis of the images","position":{"start":{"line":611,"column":1},"end":{"line":611,"column":1}},"key":"XpROrTzixC"}],"key":"VSYkATjTM8"}],"key":"xcLP38JrTe"},{"type":"listItem","spread":true,"position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Performing statistical analyses of the images","position":{"start":{"line":612,"column":1},"end":{"line":612,"column":1}},"key":"ZOWuC4uwM6"}],"key":"w4CVamcCfH"}],"key":"VASLk16icq"},{"type":"listItem","spread":true,"position":{"start":{"line":613,"column":1},"end":{"line":613,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Performing statistical analysis on the hypothesis testing decisions reported by the teams.","position":{"start":{"line":613,"column":1},"end":{"line":613,"column":1}},"key":"wJEdfQmLgb"}],"key":"V5WOm71dLs"}],"key":"Y5mIq0C35S"},{"type":"listItem","spread":true,"position":{"start":{"line":614,"column":1},"end":{"line":614,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Performing an image-based meta-analysis to combine results across teams","position":{"start":{"line":614,"column":1},"end":{"line":614,"column":1}},"key":"B6rVgpEumT"}],"key":"t4hSqMt7hA"}],"key":"Ogy69g1BhF"},{"type":"listItem","spread":true,"position":{"start":{"line":615,"column":1},"end":{"line":616,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Performing a coordinate-based meta-analysis using activation likelihood estimation (ALE)","position":{"start":{"line":615,"column":1},"end":{"line":615,"column":1}},"key":"G8wEj8neHw"}],"key":"nVSlQHNOes"}],"key":"o7QTzFuwQX"}],"key":"WYHlCnpziV"},{"type":"paragraph","position":{"start":{"line":617,"column":1},"end":{"line":617,"column":1}},"children":[{"type":"text","value":"In total, there were 5,619 total lines of code across all source files, with 578 of those located within the ","position":{"start":{"line":617,"column":1},"end":{"line":617,"column":1}},"key":"uUSpAcoE13"},{"type":"inlineCode","value":"Narps","position":{"start":{"line":617,"column":1},"end":{"line":617,"column":1}},"key":"riJ8GikDqM"},{"type":"text","value":" object and its 14 methods which ranged from 9 to 86 lines of code each (see the full code ","position":{"start":{"line":617,"column":1},"end":{"line":617,"column":1}},"key":"fssk3GMG4A"},{"type":"link","url":"https://github.com/poldrack/narps/blob/0a9d71a5ab435b40dcd50fea82d2961a43f0a3fc/ImageAnalyses/narps.py#L404","position":{"start":{"line":617,"column":1},"end":{"line":617,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":617,"column":1},"end":{"line":617,"column":1}},"key":"WYar7HDYOc"}],"urlSource":"https://github.com/poldrack/narps/blob/0a9d71a5ab435b40dcd50fea82d2961a43f0a3fc/ImageAnalyses/narps.py#L404","data":{"kind":"file","org":"poldrack","repo":"narps","reference":"0a9d71a5ab435b40dcd50fea82d2961a43f0a3fc","file":"ImageAnalyses/narps.py","from":404,"raw":"https://raw.githubusercontent.com/poldrack/narps/0a9d71a5ab435b40dcd50fea82d2961a43f0a3fc/ImageAnalyses/narps.py"},"internal":false,"protocol":"github","key":"ebblY8ry8q"},{"type":"text","value":"):","position":{"start":{"line":617,"column":1},"end":{"line":617,"column":1}},"key":"Qpp2NclFKf"}],"key":"jgrSqvoN26"},{"type":"code","lang":"","value":"Class: Narps [object]: \n  - check_image_values()\n  - compute_image_stats()\n  - convert_to_zscores()\n  - create_concat_images()\n  - create_mean_thresholded_images()\n  - create_rectified_images()\n  - estimate_smoothness()\n  - get_binarized_thresh_masks()\n  - get_input_dirs()\n  - get_orig_images()\n  - get_resampled_images()\n  - load_data()\n  - mk_full_mask_img()\n  - write_data()","position":{"start":{"line":619,"column":1},"end":{"line":635,"column":1}},"key":"Tn9CnrxvhK"},{"type":"paragraph","position":{"start":{"line":637,"column":1},"end":{"line":638,"column":1}},"children":[{"type":"text","value":"This falls clearly within “God object” territory.\nLet’s have a closer look at the ","position":{"start":{"line":637,"column":1},"end":{"line":637,"column":1}},"key":"GRKs22EzAe"},{"type":"inlineCode","value":"__init__","position":{"start":{"line":637,"column":1},"end":{"line":637,"column":1}},"key":"jN2exGYfBH"},{"type":"text","value":" constructor method for the ","position":{"start":{"line":637,"column":1},"end":{"line":637,"column":1}},"key":"RoB5UQyCS6"},{"type":"inlineCode","value":"Narps","position":{"start":{"line":637,"column":1},"end":{"line":637,"column":1}},"key":"gAEutdVcdz"},{"type":"text","value":" object, which sets up the object:","position":{"start":{"line":637,"column":1},"end":{"line":637,"column":1}},"key":"R0dVJScWFC"}],"key":"B2m1LNoUjG"},{"type":"code","lang":"","value":"class Narps(object):\n    \"\"\"\n    main class for NARPS analysis\n    \"\"\"\n    def __init__(self, basedir, metadata_file=None,\n                 verbose=False, overwrite=False,\n                 dataurl=None, testing=False):\n        self.basedir = basedir\n        self.dirs = NarpsDirs(basedir, dataurl=dataurl,\n                              testing=testing)\n        self.verbose = verbose\n        self.teams = {}\n        self.overwrite = overwrite\n        self.started_at = datetime.datetime.now()\n        self.testing = testing\n\n        # create the full mask image if it doesn't already exist\n        if not os.path.exists(self.dirs.full_mask_img):\n            print('making full image mask')\n            self.mk_full_mask_img(self.dirs)\n        assert os.path.exists(self.dirs.full_mask_img)\n\n        # get input dirs for orig data\n        self.image_jsons = None\n        self.input_dirs = self.get_input_dirs(self.dirs)\n\n        # check images for each team\n        self.complete_image_sets = {}\n        self.get_orig_images(self.dirs)\n        for imgtype in ['thresh', 'unthresh']:\n            log_to_file(\n                self.dirs.logfile,\n                'found %d teams with complete original %s datasets' % (\n                    len(self.complete_image_sets[imgtype]), imgtype))\n\n        # set up metadata\n        if metadata_file is None:\n            self.metadata_file = os.path.join(\n                self.dirs.dirs['orig'],\n                'analysis_pipelines_for_analysis.xlsx')\n        else:\n            self.metadata_file = metadata_file\n\n        self.metadata = get_metadata(self.metadata_file)\n\n        self.hypothesis_metadata = pandas.DataFrame(\n            columns=['teamID', 'hyp', 'n_na', 'n_zero'])\n\n        self.all_maps = {'thresh': {'resampled': None},\n                         'unthresh': {'resampled': None}}\n        self.rectified_list = []\n","position":{"start":{"line":641,"column":1},"end":{"line":694,"column":1}},"key":"BdwcsgVrkf"},{"type":"paragraph","position":{"start":{"line":696,"column":1},"end":{"line":696,"column":1}},"children":[{"type":"text","value":"There are a few problems with this constructor.","position":{"start":{"line":696,"column":1},"end":{"line":696,"column":1}},"key":"Shu8Wudrau"}],"key":"I3waGoH9yE"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":698,"column":1},"end":{"line":701,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":698,"column":1},"end":{"line":698,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The constructor has far too many responsibilities, including everything from creating instance variables to loading, processing, and validating data.  This leads to the execution of time-consuming operations any time one wishes to initialize the object.  Each of these individual steps should be broken out into individual methods or functions, which would simplify the structure (at the cost of some extra code) and would also make it easier to test each of the methods/functions independently without having to initialize the entire class.","position":{"start":{"line":698,"column":1},"end":{"line":698,"column":1}},"key":"EYQv8xa8wQ"}],"key":"sJg55Ze1vk"}],"key":"T1k6QlDDXB"},{"type":"listItem","spread":true,"position":{"start":{"line":699,"column":1},"end":{"line":699,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The constructor mixes together different levels of abstraction.  These include high-level configuration (such as setting verbosity and recording start time), low-level file operations (including loading of various files), and analytic logic (such as mask generation).  The constructor should probably focus only on high-level configuration.","position":{"start":{"line":699,"column":1},"end":{"line":699,"column":1}},"key":"LYGEv3dHB5"}],"key":"X7nNawRJ1E"}],"key":"AUs6B6X018"},{"type":"listItem","spread":true,"position":{"start":{"line":700,"column":1},"end":{"line":701,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The constructor is tightly coupled to the file system, reading and writing files directly.  This makes testing very difficult since it depends on the current state of the file system.","position":{"start":{"line":700,"column":1},"end":{"line":700,"column":1}},"key":"AlQhsQ20Bp"}],"key":"Cr9EuLQH3A"}],"key":"M4w2CZVngb"}],"key":"L6NcpwtTcR"},{"type":"paragraph","position":{"start":{"line":702,"column":1},"end":{"line":702,"column":1}},"children":[{"type":"text","value":"More generally, there are a couple of problems with the use of a single large class for this project:","position":{"start":{"line":702,"column":1},"end":{"line":702,"column":1}},"key":"I0lXCQiaTp"}],"key":"slwEQAoZsb"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":704,"column":1},"end":{"line":707,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":704,"column":1},"end":{"line":704,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It’s very difficult to test individual operations without initializing the full class.  In addition, later functions may sometimes depend on earlier functions having been performed, which introduces temporal dependences that make testing difficult.","position":{"start":{"line":704,"column":1},"end":{"line":704,"column":1}},"key":"cogqoxRtlE"}],"key":"zmAyjnVSyM"}],"key":"ShpaIp6Pv1"},{"type":"listItem","spread":true,"position":{"start":{"line":705,"column":1},"end":{"line":707,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"All of the processing operations are coupled to the state of the class (such as whether a particular method has been called or not).  This makes it difficult to cleanly decompose the code’s operations (making both understanding and testing difficult) and also difficult to reuse individual components since they are so tightly coupled.","position":{"start":{"line":705,"column":1},"end":{"line":705,"column":1}},"key":"U5aaT6R6C0"}],"key":"CysNmyQYbp"}],"key":"pDP7egbetm"}],"key":"iciSRnkKdY"},{"type":"paragraph","position":{"start":{"line":708,"column":1},"end":{"line":710,"column":1}},"children":[{"type":"text","value":"Perhaps unsurprisingly, working with this code base became increasingly unwieldy as the project went on, with many hours spent debugging problems that arose from the deep coupling of different parts of the workflow. (Remember that this was before we had AI tools to help us debug and refactor our code!) If I were going to rewrite this code today, I would instead use a set of Python ","position":{"start":{"line":708,"column":1},"end":{"line":708,"column":1}},"key":"fEFZ5wizWs"},{"type":"emphasis","position":{"start":{"line":708,"column":1},"end":{"line":708,"column":1}},"children":[{"type":"text","value":"data classes","position":{"start":{"line":708,"column":1},"end":{"line":708,"column":1}},"key":"i3nShgh4Vv"}],"key":"y3uy8LG1rY"},{"type":"text","value":" to store configuration and data separately, and move the processing operations into functions defined separately.\nI would then create a separate class to manage the execution of the full analysis workflow.\nThe use of separate functions (rather than methods) to perform the processing operations helps to separate responsibilities, and makes it easier to test the functions individually without requiring initialization of a large class.","position":{"start":{"line":708,"column":1},"end":{"line":708,"column":1}},"key":"FrobOw4Vsg"}],"key":"BfZQnkeFa0"},{"type":"heading","depth":3,"position":{"start":{"line":713,"column":1},"end":{"line":713,"column":1}},"children":[{"type":"text","value":"Global variables","position":{"start":{"line":713,"column":1},"end":{"line":713,"column":1}},"key":"sJTshOrLdW"}],"identifier":"global-variables","label":"Global variables","html_id":"global-variables","implicit":true,"key":"CbmpHKBLni"},{"type":"blockquote","position":{"start":{"line":715,"column":1},"end":{"line":716,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":715,"column":1},"end":{"line":716,"column":1}},"children":[{"type":"text","value":"Since our earliest days of writing software, we were warned of the perils of global data — how it was invented by demons from the fourth plane of hell, which is the resting place of any programmer who dares to use it.\nAnd, although we are somewhat skeptical about fire and brimstone, it’s still one of the most pungent odors we are likely to run into. (Fowler,p. 74)","position":{"start":{"line":715,"column":1},"end":{"line":715,"column":1}},"key":"COx7Bgba2R"}],"key":"Qu0we49Tzg"}],"key":"Tz1WRN9MED"},{"type":"paragraph","position":{"start":{"line":718,"column":1},"end":{"line":722,"column":1}},"children":[{"type":"text","value":"In Python, the accessibility (or ","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"key":"aw8me5XSGd"},{"type":"emphasis","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"children":[{"type":"text","value":"scope","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"key":"aV2u48Si9o"}],"key":"ZwFoUXo1MI"},{"type":"text","value":") of a variable is determined by where it is defined.\nA variable defined at the top level of a script, notebook, or module (that is, not inside any other function) has ","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"key":"UkHOPme8I9"},{"type":"emphasis","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"children":[{"type":"text","value":"global scope","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"key":"udoMjekBtG"}],"key":"zNNX9773An"},{"type":"text","value":", which means that it can be accessed from within any other functions that are defined within that same file.\nThe problem with global variables is that they break the insulation that is usually provided by functions.\nGlobal variables can in theory be modified anywhere they appear within the code, and thus can change in ways that can be very difficult to understand.\nIn this example, we use the ","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"key":"hoLQjwkg2N"},{"type":"inlineCode","value":"ic","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"key":"RgUnb3qR4q"},{"type":"text","value":" function from the ","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"key":"qTP8S20Meu"},{"type":"inlineCode","value":"icecream","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"key":"r3au203iVs"},{"type":"text","value":" library to report the value of the global variable before and after executing the function that modifies it:","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"key":"BCeiD12bJF"}],"key":"Svu4M3LLcf"},{"type":"code","lang":"python","value":"from icecream import ic\nGLOBALVAR = 1\n\ndef myfunc():\n   global GLOBALVAR\n   GLOBALVAR += 1\n\nic(GLOBALVAR)\nmyfunc()\nic(GLOBALVAR)","position":{"start":{"line":724,"column":1},"end":{"line":735,"column":1}},"key":"NAq8IC8Qqf"},{"type":"paragraph","position":{"start":{"line":737,"column":1},"end":{"line":737,"column":1}},"children":[{"type":"text","value":"If we were to use the global variable elsewhere, we couldn’t know what its value would be without knowing how many times ","position":{"start":{"line":737,"column":1},"end":{"line":737,"column":1}},"key":"fRwFxOnNl1"},{"type":"inlineCode","value":"myfunc()","position":{"start":{"line":737,"column":1},"end":{"line":737,"column":1}},"key":"uoUnGe4LJ9"},{"type":"text","value":" had been executed.","position":{"start":{"line":737,"column":1},"end":{"line":737,"column":1}},"key":"llibWXxYjc"}],"key":"KTLEBFLi4R"},{"type":"paragraph","position":{"start":{"line":739,"column":1},"end":{"line":742,"column":1}},"children":[{"type":"text","value":"In general, we want to restrict the scope of a variable to be as limited as possible, akin to a “need to know basis”.\nIn particular, one should never use global variables to share information into and/or out of a function.\nInstead, one should pass the relevant information into the function as an argument, and return the modified variable as an output.\nThis helps make testing of functions easier by preventing ","position":{"start":{"line":739,"column":1},"end":{"line":739,"column":1}},"key":"pS27FgYm0C"},{"type":"emphasis","position":{"start":{"line":739,"column":1},"end":{"line":739,"column":1}},"children":[{"type":"text","value":"side effects","position":{"start":{"line":739,"column":1},"end":{"line":739,"column":1}},"key":"Gbyd6q7JKG"}],"key":"HdoRMVtlmZ"},{"type":"text","value":" - that is, effects on the state of the system that are not mediated by the return values of the function.","position":{"start":{"line":739,"column":1},"end":{"line":739,"column":1}},"key":"DgYZWpWINU"}],"key":"MSPxuTSWur"},{"type":"heading","depth":3,"position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"children":[{"type":"text","value":"Defining constants","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"VQkFnzLZMq"}],"identifier":"defining-constants","label":"Defining constants","html_id":"defining-constants","implicit":true,"key":"HdOS7uVg5T"},{"type":"paragraph","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"children":[{"type":"text","value":"Global variables are most often used to define ","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"key":"LVBML2ct3v"},{"type":"emphasis","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"children":[{"type":"text","value":"constants","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"key":"rUd3qzZqku"}],"key":"Sc487dVe8i"},{"type":"text","value":" - that is, variables that are meant to take a single value that doesn’t change, such as ","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"key":"TUvpUlgD3E"},{"type":"emphasis","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"children":[{"type":"text","value":"pi","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"key":"pOqldOgziB"}],"key":"BnBUl6kiUj"},{"type":"text","value":" or ","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"key":"VBmzm0xCj0"},{"type":"emphasis","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"children":[{"type":"text","value":"e","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"key":"xj4aFPVXtK"}],"key":"lJXXtc15t0"},{"type":"text","value":" in mathematics and ","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"key":"WjFcO17ZY6"},{"type":"emphasis","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"children":[{"type":"text","value":"c","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"key":"Nq7OwjqjTL"}],"key":"I5U6FA1Kis"},{"type":"text","value":" (speed of light) or ","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"key":"ZnbmmE9Uyu"},{"type":"emphasis","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"children":[{"type":"text","value":"h","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"key":"xDkaNC2Qph"}],"key":"C2DHbT03qc"},{"type":"text","value":" (the Planck constant) in physics.","position":{"start":{"line":746,"column":1},"end":{"line":746,"column":1}},"key":"pNWbs0QAYU"}],"key":"UjDvHWhSgs"},{"type":"paragraph","position":{"start":{"line":748,"column":1},"end":{"line":749,"column":1}},"children":[{"type":"text","value":"A simple way to define a constant is to define it within a module and import it.\nFor example, we could create a module file called ","position":{"start":{"line":748,"column":1},"end":{"line":748,"column":1}},"key":"sNo0MQoXGR"},{"type":"inlineCode","value":"constants.py","position":{"start":{"line":748,"column":1},"end":{"line":748,"column":1}},"key":"xZ0aasWx3S"},{"type":"text","value":" and within it define a constant for the speed of light, using the common convention of defining constants using uppercase letters:","position":{"start":{"line":748,"column":1},"end":{"line":748,"column":1}},"key":"CcpFxUyZZr"}],"key":"DV7d735Lwg"},{"type":"code","lang":"","value":"# project constants\n\n# speed of light in a vacuum\nC = 299792458","position":{"start":{"line":751,"column":1},"end":{"line":756,"column":1}},"key":"KS5FnWXWNu"},{"type":"paragraph","position":{"start":{"line":758,"column":1},"end":{"line":758,"column":1}},"children":[{"type":"text","value":"We could then import this from our module within the iPython shell:","position":{"start":{"line":758,"column":1},"end":{"line":758,"column":1}},"key":"sHmiSuMkbZ"}],"key":"oFrkDxPIcl"},{"type":"code","lang":"","value":"In: from BetterCodeBetterScience.constants import C\n\nIn: C\nOut: 299792458","position":{"start":{"line":760,"column":1},"end":{"line":765,"column":1}},"key":"M7pSwoEwrx"},{"type":"heading","depth":4,"position":{"start":{"line":767,"column":1},"end":{"line":767,"column":1}},"children":[{"type":"text","value":"Creating immutable variables","position":{"start":{"line":767,"column":1},"end":{"line":767,"column":1}},"key":"ubmVUl7bgp"}],"identifier":"creating-immutable-variables","label":"Creating immutable variables","html_id":"creating-immutable-variables","implicit":true,"key":"AHiJ3emvLe"},{"type":"paragraph","position":{"start":{"line":769,"column":1},"end":{"line":770,"column":1}},"children":[{"type":"text","value":"We would generally like to define constants in such a way that their value is ","position":{"start":{"line":769,"column":1},"end":{"line":769,"column":1}},"key":"hqFNrIUEQw"},{"type":"emphasis","position":{"start":{"line":769,"column":1},"end":{"line":769,"column":1}},"children":[{"type":"text","value":"immutable","position":{"start":{"line":769,"column":1},"end":{"line":769,"column":1}},"key":"HEmSsH3vp5"}],"key":"hCIuybEVWT"},{"type":"text","value":", i.e. it is not allowed to be modified.\nUnfortunately, importing a variable from a module doesn’t prevent it from being modified:","position":{"start":{"line":769,"column":1},"end":{"line":769,"column":1}},"key":"LzMpCbLDRI"}],"key":"eMXKMLYMrZ"},{"type":"code","lang":"","value":"In: C = 43\n\nIn: C\nOut: 43","position":{"start":{"line":772,"column":1},"end":{"line":777,"column":1}},"key":"Hp9v0Atunz"},{"type":"paragraph","position":{"start":{"line":779,"column":1},"end":{"line":780,"column":1}},"children":[{"type":"text","value":"Unlike some other languages, Python doesn’t offer a simple way to define a variable as a constant in a way that prevents it from being modified, but there are several tricks we can play to create an immutable constant.\nHere we demonstrate one simple way, in which we create a class but override its ","position":{"start":{"line":779,"column":1},"end":{"line":779,"column":1}},"key":"mV3Nkc6eTz"},{"type":"inlineCode","value":"__setattr__","position":{"start":{"line":779,"column":1},"end":{"line":779,"column":1}},"key":"CPGdefklQh"},{"type":"text","value":" method to prevent the value from being changed:","position":{"start":{"line":779,"column":1},"end":{"line":779,"column":1}},"key":"DvPJxSDNgi"}],"key":"lgyapIkRvV"},{"type":"paragraph","position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"children":[{"type":"text","value":"We first add the class definition to our ","position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"key":"fRazqXh9tH"},{"type":"inlineCode","value":"constants.py","position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"key":"CESkpkQwWS"},{"type":"text","value":" file:","position":{"start":{"line":782,"column":1},"end":{"line":782,"column":1}},"key":"liAdhO4TQs"}],"key":"LB3BLNnPMh"},{"type":"code","lang":"python","value":"\nclass Constants:\n    C = 299792458\n\n    def __setattr__(self, name, value):\n        raise AttributeError(\"Constants cannot be modified\")","position":{"start":{"line":784,"column":1},"end":{"line":791,"column":1}},"key":"tlG1VLEv0F"},{"type":"paragraph","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"children":[{"type":"text","value":"Then within our iPython shell, we generate an instance of the Constants class, and see what happens if we try to change the value once it’s instantiated:","position":{"start":{"line":793,"column":1},"end":{"line":793,"column":1}},"key":"y3TQvFxdxu"}],"key":"j66wRvCyRE"},{"type":"code","lang":"","value":"In: from BetterCodeBetterScience.constants import Constants\n\nIn: constants = Constants()\n\nIn: constants.C\nOut: 299792458\n\nIn: constants.C = 42\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\nCell In[4], line 1\n----> 1 constants.C = 42\n\nFile ~/Dropbox/code/BetterCodeBetterScience/src/BetterCodeBetterScience/constants.py:11, in Constants.__setattr__(self, name, value)\n     10 def __setattr__(self, name, value):\n---> 11     raise AttributeError(\"Constants cannot be modified\")\n\nAttributeError: Constants cannot be modified\n","position":{"start":{"line":795,"column":1},"end":{"line":815,"column":1}},"key":"x748KSiVrA"},{"type":"paragraph","position":{"start":{"line":817,"column":1},"end":{"line":817,"column":1}},"children":[{"type":"text","value":"Using this method thus prevents the value of our constant from being inadvertently changed.","position":{"start":{"line":817,"column":1},"end":{"line":817,"column":1}},"key":"WNFJ6XkDfs"}],"key":"WnaCVRqpTI"},{"type":"heading","depth":2,"position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"children":[{"type":"text","value":"Code formatting tools","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"key":"mnXeZKYEXy"}],"identifier":"code-formatting-tools","label":"Code formatting tools","html_id":"code-formatting-tools","implicit":true,"key":"Vr5MEkCYDx"},{"type":"paragraph","position":{"start":{"line":822,"column":1},"end":{"line":826,"column":1}},"children":[{"type":"text","value":"Writing standards-compliant and well-formatted code requires a deep knowledge of the relevant standards, which in the context of Python is primarily contained in the ","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"fNJlUc5Hb6"},{"type":"link","url":"https://peps.python.org/pep-0008/","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"children":[{"type":"text","value":"Style Guide for Python Code","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"gTQy2OUHS3"}],"urlSource":"https://peps.python.org/pep-0008/","key":"hWSt0vQhJv"},{"type":"text","value":", also known as ","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"S9GdmFgVTV"},{"type":"emphasis","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"children":[{"type":"text","value":"PEP8","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"pxmnANaZkZ"}],"key":"H3bizYpeJS"},{"type":"text","value":".\nI’d venture a guess that very few coders have actually sat down and read PEP8.\nInstead, many of us have learned Python style implicitly by looking at others’ code, but increasingly we resort to the use of automated ","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"MC0oUmwJxO"},{"type":"emphasis","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"children":[{"type":"text","value":"static analysis","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"b6mVIeJFDA"}],"key":"xeegyAC9PP"},{"type":"text","value":" tools, which can identify potential errors and reformat code without actually executing the code.\nThese tools are commonly known as ","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"luIdlvtuSY"},{"type":"emphasis","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"children":[{"type":"text","value":"linters","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"ZcSmwF9A2U"}],"key":"OQLGHTK1Ek"},{"type":"text","value":", after the ","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"YCiJg2xFTE"},{"type":"inlineCode","value":"lint","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"OadNSSFW7b"},{"type":"text","value":" static analysis tool used in the C language.\nThere are numerous such tools for Python; for our examples we will use the ","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"Wig5xERkbo"},{"type":"inlineCode","value":"ruff","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"suhN8D5T9P"},{"type":"text","value":" formatter, which has become popular due in part to its speed.","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"tAP4p0JlK7"}],"key":"L9ZliNl7Qg"},{"type":"paragraph","position":{"start":{"line":828,"column":1},"end":{"line":829,"column":1}},"children":[{"type":"text","value":"A very useful feature of static analysis tools like ","position":{"start":{"line":828,"column":1},"end":{"line":828,"column":1}},"key":"Sh6mSWZyBe"},{"type":"inlineCode","value":"ruff","position":{"start":{"line":828,"column":1},"end":{"line":828,"column":1}},"key":"xKZsHvRgCz"},{"type":"text","value":" is that they can easily be integrated into most IDEs, so that they can flag problems in the code as it is written.\nIn addition, most modern IDEs will automatically suggest changes to improve the formatting of code.","position":{"start":{"line":828,"column":1},"end":{"line":828,"column":1}},"key":"B1pD1VfwrE"}],"key":"gXAlmXC64u"},{"type":"paragraph","position":{"start":{"line":831,"column":1},"end":{"line":832,"column":1}},"children":[{"type":"text","value":"Let’s start with writing some poorly formatted code, using the VSCode IDE.\n","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"q3GPfwNnkq"},{"type":"crossReference","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"children":[{"type":"text","value":"Figure ","key":"t7dcfwHA2D"},{"type":"text","value":"1","key":"TZPGW8HvMt"}],"identifier":"vscodeformatting-fig","label":"VSCodeFormatting-fig","kind":"figure","template":"Figure %s","enumerator":"1","resolved":true,"html_id":"vscodeformatting-fig","key":"LGWL8y2gXG"},{"type":"text","value":" shows a screenshot after adding a couple of lines of poorly formatted or anti-pattern code:","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"gDc7wmhTND"}],"key":"Sdvtu4MrSW"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/build/code_formatting-5f7533d0e3a713101d0fbc3e66a69964.png","alt":"IDE suggestions to fix poorly formatted or problematic code within VSCode.\nThe top panel shows two lines of problematic code.\nThe squiggly underlines reflect ruff’s detection of problems in the code, which are detailed in the popup window as well as the Problems panel below.\nThe IDE is also auto-suggesting a fix to the poorly formatted code on line 8.","width":"600px","align":"center","data":{"altTextIsAutoGenerated":true},"key":"rfwiBR095q","urlSource":"images/code_formatting.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":839,"column":1},"end":{"line":842,"column":1}},"children":[{"type":"captionNumber","kind":"figure","label":"VSCodeFormatting-fig","identifier":"vscodeformatting-fig","html_id":"vscodeformatting-fig","enumerator":"1","children":[{"type":"text","value":"Figure ","key":"SrMvuwRNUP"},{"type":"text","value":"1","key":"UuXc9M4zfj"},{"type":"text","value":":","key":"q8279ubXUG"}],"template":"Figure %s:","key":"jGcn3WAk9X"},{"type":"text","value":"IDE suggestions to fix poorly formatted or problematic code within VSCode.\nThe top panel shows two lines of problematic code.\nThe squiggly underlines reflect ","position":{"start":{"line":839,"column":1},"end":{"line":839,"column":1}},"key":"a7NhwfAIfm"},{"type":"inlineCode","value":"ruff","position":{"start":{"line":839,"column":1},"end":{"line":839,"column":1}},"key":"goFpoFvYZ8"},{"type":"text","value":"’s detection of problems in the code, which are detailed in the popup window as well as the ","position":{"start":{"line":839,"column":1},"end":{"line":839,"column":1}},"key":"Z0ol7V4WTO"},{"type":"emphasis","position":{"start":{"line":839,"column":1},"end":{"line":839,"column":1}},"children":[{"type":"text","value":"Problems","position":{"start":{"line":839,"column":1},"end":{"line":839,"column":1}},"key":"vsV2xtyLGa"}],"key":"BXowCBQFJ9"},{"type":"text","value":" panel below.\nThe IDE is also auto-suggesting a fix to the poorly formatted code on line 8.","position":{"start":{"line":839,"column":1},"end":{"line":839,"column":1}},"key":"T26ScsIRB0"}],"key":"ZzAGIhVuIr"}],"key":"oaDozvfyOX"}],"label":"VSCodeFormatting-fig","identifier":"vscodeformatting-fig","enumerator":"1","html_id":"vscodeformatting-fig","key":"X8nsoI29j1"},{"type":"paragraph","position":{"start":{"line":846,"column":1},"end":{"line":847,"column":1}},"children":[{"type":"text","value":"We see that ","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"key":"AhRIbnZZ2D"},{"type":"inlineCode","value":"ruff","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"key":"vwka2ArOwa"},{"type":"text","value":" detects both formatting problems (such as the lack of spaces in the code) as well as problematic code patterns (such as the use of star-imports).\nWe can also use ","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"key":"COF2Jg0dOl"},{"type":"inlineCode","value":"ruff","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"key":"qQIe5Gyhrh"},{"type":"text","value":" from the command line to detect and fix code problems:","position":{"start":{"line":846,"column":1},"end":{"line":846,"column":1}},"key":"glDDRXovRE"}],"key":"YoiZN06yif"},{"type":"code","lang":"bash","value":"❯ ruff check src/BetterCodeBetterScience/formatting_example.py\nsrc/BetterCodeBetterScience/formatting_example.py:6:1: F403 `from numpy.random import *` used; unable to detect undefined names\n  |\n4 | # Poorly formatted code for linting example\n5 |\n6 | from numpy.random import *\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^ F403\n7 |\n8 | mynum=randint(0,100)\n  |\n\nsrc/BetterCodeBetterScience/formatting_example.py:8:7: F405 `randint` may be undefined, or defined from star imports\n  |\n6 | from numpy.random import *\n7 |\n8 | mynum=randint(0,100)\n  |       ^^^^^^^ F405\n  |\n\nFound 2 errors.","position":{"start":{"line":849,"column":1},"end":{"line":870,"column":1}},"key":"r80B06TC8C"},{"type":"paragraph","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"children":[{"type":"text","value":"Most linters can also automatically fix the issues that they detect in the code. ","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"key":"MyXNkvOM7N"},{"type":"inlineCode","value":"ruff","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"key":"vRl2NROvvJ"},{"type":"text","value":" modifies the file in place, so we will first create a copy (so that our original remains intact) and then run the formatter on that copy:","position":{"start":{"line":872,"column":1},"end":{"line":872,"column":1}},"key":"Us7kjarJ4f"}],"key":"VQHMefdEn8"},{"type":"code","lang":"bash","value":"❯ cp src/BetterCodeBetterScience/formatting_example.py src/BetterCodeBetterScience/formatting_example_ruff.py\n\n❯ ruff format src/BetterCodeBetterScience/formatting_example_ruff.py\n1 file reformatted\n\n❯ diff src/BetterCodeBetterScience/formatting_example.py src/BetterCodeBetterScience/formatting_example_ruff.py\n1,3d0\n<\n<\n<\n8c5\n< mynum=randint(0,100)\n\\ No newline at end of file\n---\n> mynum = randint(0, 100)\n","position":{"start":{"line":874,"column":1},"end":{"line":891,"column":1}},"key":"o9ezfJvK8a"},{"type":"paragraph","position":{"start":{"line":893,"column":1},"end":{"line":894,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":893,"column":1},"end":{"line":893,"column":1}},"key":"UItXZx821j"},{"type":"inlineCode","value":"diff","position":{"start":{"line":893,"column":1},"end":{"line":893,"column":1}},"key":"QK83idAHTb"},{"type":"text","value":" result shows that ","position":{"start":{"line":893,"column":1},"end":{"line":893,"column":1}},"key":"LtaxvCRT6B"},{"type":"inlineCode","value":"ruff","position":{"start":{"line":893,"column":1},"end":{"line":893,"column":1}},"key":"RqjNOX2isS"},{"type":"text","value":" reformatted the code on line 8 (to add spaces in compliance with PEP8) and also removed some empty lines in the file.\nIt did not, however, change the import statement; that’s a level of modification that is beyond the power of a static analysis tool.","position":{"start":{"line":893,"column":1},"end":{"line":893,"column":1}},"key":"b7aO5JrDxN"}],"key":"Its1qsqDPQ"},{"type":"heading","depth":3,"position":{"start":{"line":897,"column":1},"end":{"line":897,"column":1}},"children":[{"type":"text","value":"Formatting code using AI agents","position":{"start":{"line":897,"column":1},"end":{"line":897,"column":1}},"key":"m7yuyqCiZh"}],"identifier":"formatting-code-using-ai-agents","label":"Formatting code using AI agents","html_id":"formatting-code-using-ai-agents","implicit":true,"key":"vGoFVQ4jUp"},{"type":"paragraph","position":{"start":{"line":899,"column":1},"end":{"line":900,"column":1}},"children":[{"type":"text","value":"Unsurprisingly, AI coding agents are also quite good at fixing formatting and styling issues in code.\n","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"EvMyGXTPZ7"},{"type":"crossReference","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"children":[{"type":"text","value":"Figure ","key":"eg5UIXICXG"},{"type":"text","value":"2","key":"nLz83HbClh"}],"identifier":"aiformatting-fig","label":"AIFormatting-fig","kind":"figure","template":"Figure %s","enumerator":"2","resolved":true,"html_id":"aiformatting-fig","key":"z2N8igz12x"},{"type":"text","value":" shows a simple example where we prompt the GitHub Copilot chat within VSCode to fix the formatting in the example code from above.","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"Giy2VjZncv"}],"key":"kheojTFUwW"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/build/code_formatting_ai-ddd36317501f72d1c1f6738a4fafa89e.png","alt":"The GitHub Copilot chat within VSCode was used to prompt the model (Claude Sonnet 4) to fix issues with the code.\nThe model generated new code and also outlined its improvements.","width":"600px","align":"center","data":{"altTextIsAutoGenerated":true},"key":"ZFAIHcdNLH","urlSource":"images/code_formatting_ai.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":907,"column":1},"end":{"line":908,"column":1}},"children":[{"type":"captionNumber","kind":"figure","label":"AIFormatting-fig","identifier":"aiformatting-fig","html_id":"aiformatting-fig","enumerator":"2","children":[{"type":"text","value":"Figure ","key":"JgGo69FA7D"},{"type":"text","value":"2","key":"uOsugAMR5e"},{"type":"text","value":":","key":"uBdHeGACXU"}],"template":"Figure %s:","key":"vEu4nbbdRz"},{"type":"text","value":"The GitHub Copilot chat within VSCode was used to prompt the model (Claude Sonnet 4) to fix issues with the code.\nThe model generated new code and also outlined its improvements.","position":{"start":{"line":907,"column":1},"end":{"line":907,"column":1}},"key":"aQKQLfcoXY"}],"key":"GyXUvuurES"}],"key":"pERhkKKsoD"}],"label":"AIFormatting-fig","identifier":"aiformatting-fig","enumerator":"2","html_id":"aiformatting-fig","key":"uA9gJq9RCc"},{"type":"paragraph","position":{"start":{"line":912,"column":1},"end":{"line":913,"column":1}},"children":[{"type":"text","value":"The agent both addressed the formatting issues as well as fixing the wildcard import, improving the variable naming, and updating the comment.\nHere is the new code generated by the model:","position":{"start":{"line":912,"column":1},"end":{"line":912,"column":1}},"key":"IFCNCJNbRt"}],"key":"n4GF3gyCJz"},{"type":"code","lang":"python","value":"# Well-formatted code following PEP8 and best practices\n\nimport numpy.random as np_random\n\nmy_num = np_random.randint(0, 100)","position":{"start":{"line":915,"column":1},"end":{"line":921,"column":1}},"key":"MOlVwwnFKF"},{"type":"paragraph","position":{"start":{"line":923,"column":1},"end":{"line":923,"column":1}},"children":[{"type":"text","value":"The model could certainly be prompted to make more extensive changes on more complex code (such as improving variable names) with a more detailed prompt.","position":{"start":{"line":923,"column":1},"end":{"line":923,"column":1}},"key":"mN4V1fRVlh"}],"key":"f7rfdJfvBc"},{"type":"heading","depth":2,"position":{"start":{"line":926,"column":1},"end":{"line":926,"column":1}},"children":[{"type":"text","value":"Defensive coding","position":{"start":{"line":926,"column":1},"end":{"line":926,"column":1}},"key":"Y1HFtQ4nsn"}],"identifier":"defensive-coding","label":"Defensive coding","html_id":"defensive-coding","implicit":true,"key":"DbU0wHhNX3"},{"type":"paragraph","position":{"start":{"line":928,"column":1},"end":{"line":930,"column":1}},"children":[{"type":"text","value":"Given that even professional programmers make errors on a regular basis, it seems almost certain that researchers writing code for their scientific projects will make their fair share of errors too. ","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"key":"OgYgxksmih"},{"type":"emphasis","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"children":[{"type":"text","value":"Defensive coding","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"key":"Yo6aZWqzlI"}],"key":"GW4koKY8xo"},{"type":"text","value":" means writing code in a way that tries to protect against errors.\nOne essential aspect of defensive coding is a thorough suite of tests for all important functions; we will dive much more deeply into this in a later chapter.\nHere we focus on robustness to ","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"key":"vCZdIkH4zP"},{"type":"emphasis","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"children":[{"type":"text","value":"runtime errors","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"key":"Glrgi3odML"}],"key":"etBLrjm5gO"},{"type":"text","value":"; that is, errors that are not necessarily due to errors in the code per se, but rather due to errors in the logic of the code or errors or invalid assumptions about the data that are being used by code.","position":{"start":{"line":928,"column":1},"end":{"line":928,"column":1}},"key":"DGw5q8hJIu"}],"key":"AIQJitYiQ5"},{"type":"paragraph","position":{"start":{"line":932,"column":1},"end":{"line":933,"column":1}},"children":[{"type":"text","value":"A central aspect of defensive coding is to detect errors and announce them in a loud way.\nFor example, in a recent code review, a researcher showed the following code:","position":{"start":{"line":932,"column":1},"end":{"line":932,"column":1}},"key":"RCGGaiIFqr"}],"key":"QUIbuVxmHX"},{"type":"code","lang":"python","value":"def get_subject_label(file):\n    \"\"\"\n    Extract the subject label from a given file path.\n\n    Parameters:\n    - file (str): The file path from which to extract the subject label.\n\n    Returns:\n    - str or None: The extracted subject label (e.g., 's001') if found, \n                   otherwise returns None and prints a message.\n    \"\"\"\n    \n    match = re.search(r'/sub-(s\\d{3})/', file)\n    \n    if match:\n        subject_label = match.group(1)\n        return subject_label\n    else:\n        return None","position":{"start":{"line":935,"column":1},"end":{"line":955,"column":1}},"key":"XieWxMaVwa"},{"type":"paragraph","position":{"start":{"line":957,"column":1},"end":{"line":960,"column":1}},"children":[{"type":"text","value":"When one of us asked the question “Should there ever be a file path that doesn’t include a subject label?”, the answer was “No”, meaning that this code allows what amounts to an error to occur without announcing its presence.\nWhen we looked at the place where this function was used in the code, there was no check for whether the output was ","position":{"start":{"line":957,"column":1},"end":{"line":957,"column":1}},"key":"SVRkmuFpgz"},{"type":"inlineCode","value":"None","position":{"start":{"line":957,"column":1},"end":{"line":957,"column":1}},"key":"ybVvkMrIcv"},{"type":"text","value":", meaning that such an error would go unnoticed until it caused an error later when ","position":{"start":{"line":957,"column":1},"end":{"line":957,"column":1}},"key":"L9v5E0ujcR"},{"type":"inlineCode","value":"subject_label","position":{"start":{"line":957,"column":1},"end":{"line":957,"column":1}},"key":"JbzOSIq5W8"},{"type":"text","value":" was assumed to be a string.\nAlso note that the docstring for this function is misleading, as it states that a message will be printed if the return value is ","position":{"start":{"line":957,"column":1},"end":{"line":957,"column":1}},"key":"vNHEz7aEgc"},{"type":"inlineCode","value":"None","position":{"start":{"line":957,"column":1},"end":{"line":957,"column":1}},"key":"OUTQah8KgI"},{"type":"text","value":", but no message is actually printed.\nIn general, printing a message is a poor way to signal the potential presence of a problem, particularly if the code has a large amount of text output in which the message might be lost.","position":{"start":{"line":957,"column":1},"end":{"line":957,"column":1}},"key":"SomN1TXpFJ"}],"key":"eMcHDFmEax"},{"type":"heading","depth":3,"position":{"start":{"line":962,"column":1},"end":{"line":962,"column":1}},"children":[{"type":"text","value":"Announcing errors loudly using exceptions","position":{"start":{"line":962,"column":1},"end":{"line":962,"column":1}},"key":"n9HsTJPB8B"}],"identifier":"announcing-errors-loudly-using-exceptions","label":"Announcing errors loudly using exceptions","html_id":"announcing-errors-loudly-using-exceptions","implicit":true,"key":"nLoWKhnFu0"},{"type":"paragraph","position":{"start":{"line":964,"column":1},"end":{"line":966,"column":1}},"children":[{"type":"text","value":"A better practice here would be to raise an ","position":{"start":{"line":964,"column":1},"end":{"line":964,"column":1}},"key":"AB8YzYtpPb"},{"type":"emphasis","position":{"start":{"line":964,"column":1},"end":{"line":964,"column":1}},"children":[{"type":"text","value":"exception","position":{"start":{"line":964,"column":1},"end":{"line":964,"column":1}},"key":"cG6CMMBVZU"}],"key":"tqQbWamsuJ"},{"type":"text","value":".\nUnlike passing ","position":{"start":{"line":964,"column":1},"end":{"line":964,"column":1}},"key":"iaIArNyBSP"},{"type":"inlineCode","value":"None","position":{"start":{"line":964,"column":1},"end":{"line":964,"column":1}},"key":"epo3RzsM6b"},{"type":"text","value":", raising an exception will cause the program to stop unless the exception is handled.\nIn the previous example, we could do the following (removing the docstring for brevity):","position":{"start":{"line":964,"column":1},"end":{"line":964,"column":1}},"key":"U3fVdZOGp6"}],"key":"t1E6qJPy53"},{"type":"code","lang":"python","value":"def get_subject_label(file: str) -> str:\n    match = re.search(r'/sub-(s\\d{3})/', file)\n    return match.group(1)","position":{"start":{"line":968,"column":1},"end":{"line":972,"column":1}},"key":"D0A8e2iOV9"},{"type":"paragraph","position":{"start":{"line":974,"column":1},"end":{"line":974,"column":1}},"children":[{"type":"text","value":"In some cases we might want the script to stop if it encounters a filename without a subject label, in which case we simply call the function:","position":{"start":{"line":974,"column":1},"end":{"line":974,"column":1}},"key":"E8dBucATPt"}],"key":"bKWXIlhoBx"},{"type":"code","lang":"python","value":"In [11]: file = '/data/sub-s001/run-1_bold.nii.gz'\n\nIn [12]: get_subject_label(file)\nOut[12]: 's001'\n\nIn [13]: file = '/data/nolabel/run-1_bold.nii.gz'\n\nIn [14]: get_subject_label(file)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\nCell In[14], line 1\n----> 1 get_subject_label(file)\n\nCell In[1], line 3, in get_subject_label(file)\n      1 def get_subject_label(file: str) -> str:\n      2     match = re.search(r'/sub-(s\\d{3})/', file)\n----> 3     return match.group(1)\n\nAttributeError: 'NoneType' object has no attribute 'group'","position":{"start":{"line":976,"column":1},"end":{"line":996,"column":1}},"key":"MCo5Y2w9YJ"},{"type":"paragraph","position":{"start":{"line":998,"column":1},"end":{"line":999,"column":1}},"children":[{"type":"text","value":"In other cases we might want to handle the exception without halting the program, in which case we can embed the function call in a ","position":{"start":{"line":998,"column":1},"end":{"line":998,"column":1}},"key":"OHbrestZQ4"},{"type":"inlineCode","value":"try/catch","position":{"start":{"line":998,"column":1},"end":{"line":998,"column":1}},"key":"Srje9k7TfW"},{"type":"text","value":" statement that tries to run the function and then handles any exceptions that might occur.\nLet’s say that we simply want to skip over any files for which there is no subject label:","position":{"start":{"line":998,"column":1},"end":{"line":998,"column":1}},"key":"PeY8ewIGnG"}],"key":"c4I0NaQHqB"},{"type":"code","lang":"python","value":"In [13]: for file in files:\n            try:\n                subject_label = get_subject_label(file)\n                print(subject_label)\n            except AttributeError:\n                print(f'no subject label, skipping: {file}')\ns001\nno subject label, skipping: /tmp/foo\n","position":{"start":{"line":1001,"column":1},"end":{"line":1011,"column":1}},"key":"t0brSM2wqs"},{"type":"paragraph","position":{"start":{"line":1013,"column":1},"end":{"line":1015,"column":1}},"children":[{"type":"text","value":"In most cases our ","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"cllmxKc96I"},{"type":"inlineCode","value":"try/catch","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"QYxR1Lv1Zr"},{"type":"text","value":" statement should catch specific errors.\nIn this case, we know that the function will return an ","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"K8mdMaZxHV"},{"type":"inlineCode","value":"AttributeError","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"YhPCMLD8wS"},{"type":"text","value":" its input is a string that doesn’t contain a subject label.\nBut what if the input is ","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"gHXQ5vy303"},{"type":"inlineCode","value":"None","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"DuJYKfONWd"},{"type":"text","value":"?","position":{"start":{"line":1013,"column":1},"end":{"line":1013,"column":1}},"key":"s2z6yurjCx"}],"key":"pj0N7eg7Nf"},{"type":"code","lang":"python","value":"\nIn [14]: file = None\n            try:\n                subject_label = get_subject_label(file)\n            except AttributeError:\n                print(f'no subject label, skipping: {file}')\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\nCell In[14], line 3\n      1 file = None\n      2 try:\n----> 3     subject_label = get_subject_label(file)\n      4 except AttributeError:\n      5     print(f'no subject label, skipping: {file}')\n\nCell In[1], line 2, in get_subject_label(file)\n      1 def get_subject_label(file: str) -> str:\n----> 2     match = re.search(r'/sub-(s\\d{3})/', file)\n      3     return match.group(1)\n...\nTypeError: expected string or bytes-like object, got 'NoneType'","position":{"start":{"line":1017,"column":1},"end":{"line":1039,"column":1}},"key":"SXf9YXWOtj"},{"type":"paragraph","position":{"start":{"line":1041,"column":1},"end":{"line":1041,"column":1}},"children":[{"type":"text","value":"Because ","position":{"start":{"line":1041,"column":1},"end":{"line":1041,"column":1}},"key":"WlS0Jjp72B"},{"type":"inlineCode","value":"None","position":{"start":{"line":1041,"column":1},"end":{"line":1041,"column":1}},"key":"xBPzFFwKDA"},{"type":"text","value":" is not a string and ","position":{"start":{"line":1041,"column":1},"end":{"line":1041,"column":1}},"key":"Jfi6fys9Sc"},{"type":"inlineCode","value":"re.search()","position":{"start":{"line":1041,"column":1},"end":{"line":1041,"column":1}},"key":"El9ijieamJ"},{"type":"text","value":" expects a string, we get a ","position":{"start":{"line":1041,"column":1},"end":{"line":1041,"column":1}},"key":"Nh56H23riq"},{"type":"inlineCode","value":"TypeError","position":{"start":{"line":1041,"column":1},"end":{"line":1041,"column":1}},"key":"YMO6IrC1JI"},{"type":"text","value":", which is not caught by the catch statement and subsequently stops the execution.","position":{"start":{"line":1041,"column":1},"end":{"line":1041,"column":1}},"key":"nWCIhsxZBd"}],"key":"JloHqiHlpl"},{"type":"heading","depth":3,"position":{"start":{"line":1043,"column":1},"end":{"line":1043,"column":1}},"children":[{"type":"text","value":"Checking assumptions using assertions","position":{"start":{"line":1043,"column":1},"end":{"line":1043,"column":1}},"key":"mYRXa7NQCx"}],"identifier":"checking-assumptions-using-assertions","label":"Checking assumptions using assertions","html_id":"checking-assumptions-using-assertions","implicit":true,"key":"Eq4IxpXnyH"},{"type":"paragraph","position":{"start":{"line":1045,"column":1},"end":{"line":1048,"column":1}},"children":[{"type":"text","value":"In 2013, a group of researchers published a paper in the journal ","position":{"start":{"line":1045,"column":1},"end":{"line":1045,"column":1}},"key":"B0JJWmtOr8"},{"type":"emphasis","position":{"start":{"line":1045,"column":1},"end":{"line":1045,"column":1}},"children":[{"type":"text","value":"PLOS One","position":{"start":{"line":1045,"column":1},"end":{"line":1045,"column":1}},"key":"zfbqLmTKnV"}],"key":"Rosl8xRzuQ"},{"type":"text","value":" reporting a relationship between belief in conspiracy theories and rejection of science ","position":{"start":{"line":1045,"column":1},"end":{"line":1045,"column":1}},"key":"C9H36hXqJf"},{"type":"citeGroup","kind":"parenthetical","position":{"start":{"line":1045,"column":1},"end":{"line":1045,"column":1}},"children":[{"type":"cite","identifier":"lewandowsky:2013aa","label":"Lewandowsky:2013aa","kind":"parenthetical","position":{"start":{"line":1045,"column":166},"end":{"line":1045,"column":185}},"children":[{"type":"text","value":"Lewandowsky ","key":"OUz9zq6gNY"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"ZQAltqaF1y"}],"key":"oH18zYgJ81"},{"type":"text","value":", 2013","key":"qPGLD7jdXM"}],"enumerator":"7","key":"B3kJcqiFzr"}],"key":"feDcqfG0Qi"},{"type":"text","value":".\nThis result was based on a panel of participants (presumably adults) who completed a survey regarding a number of topics along with reporting their age and gender.\nIn order to rule out the potential for age to confound the relationships that they identified, they reported that “Age turned out not to correlate with any of the indicator variables”.\nThey were later forced to issue a correction to the paper after a reader examined the dataset (which had been shared along with the paper, as required by the journal) and found the following: “The dataset included two notable age outliers (reported ages 5 and 32757).”","position":{"start":{"line":1045,"column":1},"end":{"line":1045,"column":1}},"key":"amB8SGVMaL"}],"key":"yFI4GSyXwP"},{"type":"paragraph","position":{"start":{"line":1050,"column":1},"end":{"line":1051,"column":1}},"children":[{"type":"text","value":"No one wants to publish research that requires later correction, and in this case this correction could have been avoided by including a single line of code.\nAssuming that the age values are stored in a column called ‘age’ within a data frame, and the range of legitimate ages is 18 to 80:","position":{"start":{"line":1050,"column":1},"end":{"line":1050,"column":1}},"key":"npZOzZZ7hu"}],"key":"lRGLAO5h9a"},{"type":"code","lang":"python","value":"assert df['age'].between(18, 80).all(), \"Error: ages out of bound\"","position":{"start":{"line":1053,"column":1},"end":{"line":1055,"column":1}},"key":"F5YkwqdOjS"},{"type":"paragraph","position":{"start":{"line":1057,"column":1},"end":{"line":1057,"column":1}},"children":[{"type":"text","value":"If all values are in bounds, then this simply passes to the next statement, but if a value is out of bounds it raises and exception:","position":{"start":{"line":1057,"column":1},"end":{"line":1057,"column":1}},"key":"OQoHLfPyjj"}],"key":"sBgoNBGqYh"},{"type":"code","lang":"python","value":"In [23]: df.loc[0, 'age'] = 32757\nIn [24]: assert df['age'].between(18, 80).all(), \"Error: Not all ages are between 18 and 80\"\n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\nCell In[24], line 1\n----> 1 assert df['age'].between(18, 80).all(), \"Error: Not all ages are between 18 and 80\"\n\nAssertionError: Error: Not all ages are between 18 and 80\n","position":{"start":{"line":1059,"column":1},"end":{"line":1069,"column":1}},"key":"IhFCgmZ7KO"},{"type":"paragraph","position":{"start":{"line":1071,"column":1},"end":{"line":1072,"column":1}},"children":[{"type":"text","value":"Any time one is working with variables that have bounded limits on acceptable values, an assertion is a good idea.\nExamples of such variables include:","position":{"start":{"line":1071,"column":1},"end":{"line":1071,"column":1}},"key":"E8hh1oG2bX"}],"key":"MDBtrKeuIH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1074,"column":1},"end":{"line":1077,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Counts (>= 0; in some cases an upper limit may also be plausible, such as a count of the number of planets in the solar system)","position":{"start":{"line":1074,"column":1},"end":{"line":1074,"column":1}},"key":"hDuNhJ7COU"}],"key":"LdwpAPkXqf"}],"key":"MulIHMmxLs"},{"type":"listItem","spread":true,"position":{"start":{"line":1075,"column":1},"end":{"line":1075,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Elapsed time (> 0)","position":{"start":{"line":1075,"column":1},"end":{"line":1075,"column":1}},"key":"qmohEdKIRR"}],"key":"TNuOiJNjj5"}],"key":"uyONGk7Xgy"},{"type":"listItem","spread":true,"position":{"start":{"line":1076,"column":1},"end":{"line":1077,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Discrete values (e.g. atomic numbers in the periodic table, or mass numbers for a particular element)","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"key":"MrMxaFW0gF"}],"key":"ZwMuyeFb17"}],"key":"RbAcIflp4w"}],"key":"qHDM1b8iUB"},{"type":"paragraph","position":{"start":{"line":1078,"column":1},"end":{"line":1078,"column":1}},"children":[{"type":"text","value":"For example:","position":{"start":{"line":1078,"column":1},"end":{"line":1078,"column":1}},"key":"eeIaIGSqMO"}],"key":"CrL4QhSILS"},{"type":"code","lang":"python","value":"## Count values should always be non-negative integers\nassert np.all(counts >= 0) and np.issubdtype(counts.dtype, np.integer), \\\n     \"Count must contain non-negative integers only\"\n\n## Measured times should be positive\nassert np.all(response_times > 0)\n\n## Discrete values\ncarbon_isotope_mass_numbers = list(range(8, 21)) + [22]\nassert mass_number in carbon_isotope_mass_numbers","position":{"start":{"line":1080,"column":1},"end":{"line":1091,"column":1}},"key":"ZAFm07tzyQ"},{"type":"heading","depth":2,"position":{"start":{"line":1094,"column":1},"end":{"line":1094,"column":1}},"children":[{"type":"text","value":"Coding portably","position":{"start":{"line":1094,"column":1},"end":{"line":1094,"column":1}},"key":"JyKJiTW22o"}],"identifier":"coding-portably","label":"Coding portably","html_id":"coding-portably","implicit":true,"key":"KyMibgST5s"},{"type":"paragraph","position":{"start":{"line":1096,"column":1},"end":{"line":1098,"column":1}},"children":[{"type":"text","value":"If you have ever tried to run other people’s research code on your own machine, you have almost certainly run into errors due to the hard-coding of machine-dependent details into the code.\nA good piece of evidence for this is the frequency with which AI coding assistants will insert paths into code that appear to be leaked from their training data or hallucinated.\nHere are a few examples where a prompt for a path was completed with what appears to be a leaked or hallucinated file path from the GPT-4o training set:","position":{"start":{"line":1096,"column":1},"end":{"line":1096,"column":1}},"key":"ieQpfpAoSU"}],"key":"EsLg6PWyRI"},{"type":"code","lang":"python","value":"image_path = '/home/brain/workingdir/data/dwi/hcp/preprocessed/response_dhollander/100206/T1w/Diffusion/100206_WM_FOD_norm.mif'\ndata_path = '/data/pt_02101/fmri_data/'\nimage_path = '/Users/kevinsitek/Downloads/pt_02101/'\nfmripath = '/home/jb07/joe_python/fmri_analysis/'","position":{"start":{"line":1100,"column":1},"end":{"line":1105,"column":1}},"key":"NB8VROEOBO"},{"type":"paragraph","position":{"start":{"line":1107,"column":1},"end":{"line":1107,"column":1}},"children":[{"type":"text","value":"Even if you don’t plan to share your code with anyone else, writing portably is a good idea because you never know when your system configuration may change.","position":{"start":{"line":1107,"column":1},"end":{"line":1107,"column":1}},"key":"jG4tWU5Ky5"}],"key":"lYhpcS3Zs5"},{"type":"paragraph","position":{"start":{"line":1109,"column":1},"end":{"line":1112,"column":1}},"children":[{"type":"text","value":"A particularly dangerous practice is the direct coding of credentials (such as login credentials or API keys) into code files.\nSeveral years ago one member of our lab had embedded credentials for the lab’s Amazon Web Services account into a piece of code, which was kept in a private Github repository.\nAt some point this repository was made public (forgetting that it contained those credentials), and cybercriminals were able to use the credentials to spend more than $8000 on the account within a couple of days before a spending alarm alerted us to the compromise.\nFortunately the money was refunded, but the episode highlights just how dangerous the leakage of credentials can be.","position":{"start":{"line":1109,"column":1},"end":{"line":1109,"column":1}},"key":"SZtHgO3SJB"}],"key":"nVoQAspJyB"},{"type":"paragraph","position":{"start":{"line":1114,"column":1},"end":{"line":1115,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"children":[{"type":"text","value":"Never","position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"key":"yaOufHji7j"}],"key":"DducHUfIVQ"},{"type":"text","value":" place any system-specific or user-specific information within code.\nInstead, that information should be specified outside of the code, for which there are two common methods.","position":{"start":{"line":1114,"column":1},"end":{"line":1114,"column":1}},"key":"sGPMvRjzAB"}],"key":"e4dtWfTTyN"},{"type":"heading","depth":3,"position":{"start":{"line":1117,"column":1},"end":{"line":1117,"column":1}},"children":[{"type":"text","value":"Environment variables","position":{"start":{"line":1117,"column":1},"end":{"line":1117,"column":1}},"key":"RUUoI7l2uL"}],"identifier":"environment-variables","label":"Environment variables","html_id":"environment-variables","implicit":true,"key":"gSLL8URfPP"},{"type":"paragraph","position":{"start":{"line":1119,"column":1},"end":{"line":1120,"column":1}},"children":[{"type":"text","value":"Environment variables are variables that exist in the environment and are readable from within the code; here we use examples from the UNIX shell.\nEnvironment variables can be set from the command line using the ","position":{"start":{"line":1119,"column":1},"end":{"line":1119,"column":1}},"key":"CyniMsRKVz"},{"type":"inlineCode","value":"export","position":{"start":{"line":1119,"column":1},"end":{"line":1119,"column":1}},"key":"eZnnZ75Ytk"},{"type":"text","value":" command:","position":{"start":{"line":1119,"column":1},"end":{"line":1119,"column":1}},"key":"etgbGHXayQ"}],"key":"YghdUrATSP"},{"type":"code","lang":"bash","value":"❯ export MY_API_KEY='5lkjdlvkni5lkj5sklc'\n❯ echo $MY_API_KEY\n5lkjdlvkni5lkj5sklc","position":{"start":{"line":1122,"column":1},"end":{"line":1126,"column":1}},"key":"NM6gB2ZfTi"},{"type":"paragraph","position":{"start":{"line":1128,"column":1},"end":{"line":1129,"column":1}},"children":[{"type":"text","value":"In addition, these environment variables can be made persistent by adding them to shell startup files (such as .bashrc for the ","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"rZTv3QxYPm"},{"type":"inlineCode","value":"bash","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"QfpxtLKQUi"},{"type":"text","value":" shell), in which case they are loaded whenever a new shell is opened.\nThe values of these environment variables can then be obtained within Python using the ","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"jJOEkl5fnE"},{"type":"inlineCode","value":"os.environ","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"ft5Pq2mZCV"},{"type":"text","value":" object:","position":{"start":{"line":1128,"column":1},"end":{"line":1128,"column":1}},"key":"SzasO1Wkst"}],"key":"B1rV7u6VTh"},{"type":"code","lang":"python","value":"In [1]: import os\nIn [2]: os.environ['MY_API_KEY']\nOut[2]: '5lkjdlvkni5lkj5sklc'","position":{"start":{"line":1131,"column":1},"end":{"line":1135,"column":1}},"key":"Y6YbJ7plaA"},{"type":"paragraph","position":{"start":{"line":1137,"column":1},"end":{"line":1138,"column":1}},"children":[{"type":"text","value":"Often we may have environment variables that are project-specific, such that we only want them loaded when working on that project.\nA good solution for this problem is to create a ","position":{"start":{"line":1137,"column":1},"end":{"line":1137,"column":1}},"key":"Y3DhbbkxCn"},{"type":"inlineCode","value":".env","position":{"start":{"line":1137,"column":1},"end":{"line":1137,"column":1}},"key":"KTysSnzcsJ"},{"type":"text","value":" file within the project and include those settings within this file.","position":{"start":{"line":1137,"column":1},"end":{"line":1137,"column":1}},"key":"wjJqZ2OUr8"}],"key":"XGmIL8SMGK"},{"type":"code","lang":"bash","value":"❯ echo \"PROJECT_KEY=934kjdflk5k5ks592kskx\" > .env\n\n❯ cat .env\n───────┬─────────────────────────────────────────────────────────────────────────\n       │ File: .env\n───────┼─────────────────────────────────────────────────────────────────────────\n   1   │ PROJECT_KEY=934kjdflk5k5ks592kskx\n───────┴─────────────────────────────────────────────────────────────────────────","position":{"start":{"line":1140,"column":1},"end":{"line":1149,"column":1}},"key":"vhdhVDNw1o"},{"type":"paragraph","position":{"start":{"line":1151,"column":1},"end":{"line":1151,"column":1}},"children":[{"type":"text","value":"Once that file exists, we can use the ","position":{"start":{"line":1151,"column":1},"end":{"line":1151,"column":1}},"key":"GcuzsBejG7"},{"type":"inlineCode","value":"python-dotenv","position":{"start":{"line":1151,"column":1},"end":{"line":1151,"column":1}},"key":"jwpNfMVvZx"},{"type":"text","value":" project to load the contents into our environment within Python:","position":{"start":{"line":1151,"column":1},"end":{"line":1151,"column":1}},"key":"nR9stY5au1"}],"key":"hxU3IFeynT"},{"type":"code","lang":"python","value":"In [1]: import dotenv\nIn [2]: dotenv.load_dotenv()\nOut[2]: True\nIn [4]: import os\nIn [5]: os.environ['PROJECT_KEY']\nOut[5]: '934kjdflk5k5ks592kskx'","position":{"start":{"line":1153,"column":1},"end":{"line":1160,"column":1}},"key":"uoJyZiEaC7"},{"type":"heading","depth":3,"position":{"start":{"line":1162,"column":1},"end":{"line":1162,"column":1}},"children":[{"type":"text","value":"Configuration files","position":{"start":{"line":1162,"column":1},"end":{"line":1162,"column":1}},"key":"AvWbK13RkI"}],"identifier":"configuration-files","label":"Configuration files","html_id":"configuration-files","implicit":true,"key":"dBD4nAN1LA"},{"type":"paragraph","position":{"start":{"line":1164,"column":1},"end":{"line":1167,"column":1}},"children":[{"type":"text","value":"In some cases one may want more flexibility in the specification of configuration settings than provided by environment variables.\nIn this case, another alternative is to use ","position":{"start":{"line":1164,"column":1},"end":{"line":1164,"column":1}},"key":"K97zPHJpJE"},{"type":"emphasis","position":{"start":{"line":1164,"column":1},"end":{"line":1164,"column":1}},"children":[{"type":"text","value":"configuration files","position":{"start":{"line":1164,"column":1},"end":{"line":1164,"column":1}},"key":"zZMvEs8kju"}],"key":"GhU6hSXgU1"},{"type":"text","value":", which are text files that allow a more structured and flexible organization of configuration variables.\nThere are many different file formats that can be used to specify configuration files; here we will focus on the ","position":{"start":{"line":1164,"column":1},"end":{"line":1164,"column":1}},"key":"JzzjrdKsRu"},{"type":"link","url":"https://yaml.org/","position":{"start":{"line":1164,"column":1},"end":{"line":1164,"column":1}},"children":[{"type":"text","value":"YAML","position":{"start":{"line":1164,"column":1},"end":{"line":1164,"column":1}},"key":"KDCM4ZEnfX"}],"urlSource":"https://yaml.org/","key":"vBpsu60mgN"},{"type":"text","value":" file format, which is highly readable and provides substantial flexibility for configuration data structures.\nHere is an example of what a YAML configuration file might look like:","position":{"start":{"line":1164,"column":1},"end":{"line":1164,"column":1}},"key":"nExFm7A5X7"}],"key":"wdQWeRAwtO"},{"type":"code","lang":"yaml","value":"---\n# Project Configuration\nproject:\n  name: \"Multi-source astronomy analysis\"\n  version: \"1.0.0\"\n  description: \"Analysis of multi-source astronomical data\"\n  lead_scientist: \"Dr. Jane Doe\"\n  team:\n    - \"John Smith\"\n    - \"Emily Brown\"\n    - \"Michael Wong\"\n\n# Input Data Sources\ndata_sources:\n  telescope_data:\n    path: \"/data/telescope/\"\n    file_pattern: \"*.fits\"\n  catalog:\n    type: \"sql\"\n    connection_string: \"postgresql://username:password@localhost:5432/star_catalog\"\n\n# Analysis Parameters\nanalysis:\n  image_processing:\n    noise_reduction:\n      algorithm: \"wavelet\"\n      threshold: 0.05\n    background_subtraction:\n      method: \"median\"\n      kernel_size: [50, 50]","position":{"start":{"line":1169,"column":1},"end":{"line":1200,"column":1}},"key":"UrU0ZPhHPd"},{"type":"paragraph","position":{"start":{"line":1202,"column":1},"end":{"line":1202,"column":1}},"children":[{"type":"text","value":"We can easily load this configuration file into Python using the ","position":{"start":{"line":1202,"column":1},"end":{"line":1202,"column":1}},"key":"tMui3iOL3J"},{"type":"inlineCode","value":"PyYAML","position":{"start":{"line":1202,"column":1},"end":{"line":1202,"column":1}},"key":"Gx1ynNyHoy"},{"type":"text","value":" module, which loads it into a dictionary:","position":{"start":{"line":1202,"column":1},"end":{"line":1202,"column":1}},"key":"niO4n3KpkL"}],"key":"nEMRuMSAak"},{"type":"code","lang":"python","value":"In [1]: import yaml\nIn [2]: config_file = 'config.yaml'\nIn [3]: with open(config_file, 'r') as f:\n           config = yaml.safe_load(f)\nIn [6]: config\nOut[6]:\n{'project': {'name': 'Multi-source astronomy analysis',\n  'version': '1.0.0',\n  'description': 'Analysis of multi-source astronomical data',\n  'lead_scientist': 'Dr. Jane Doe',\n  'team': ['John Smith', 'Emily Brown', 'Michael Wong']},\n 'data_sources': {'telescope_data': {'path': '/data/telescope/',\n   'file_pattern': '*.fits'},\n  'catalog': {'type': 'sql',\n   'connection_string': 'postgresql://username:password@localhost:5432/star_catalog'}},\n 'analysis': {'image_processing': {'noise_reduction': {'algorithm': 'wavelet',\n    'threshold': 0.05},\n   'background_subtraction': {'method': 'median', 'kernel_size': [50, 50]}}}}","position":{"start":{"line":1204,"column":1},"end":{"line":1223,"column":1}},"key":"QdxFfbsdRW"},{"type":"heading","depth":3,"position":{"start":{"line":1225,"column":1},"end":{"line":1225,"column":1}},"children":[{"type":"text","value":"Protecting private credentials","position":{"start":{"line":1225,"column":1},"end":{"line":1225,"column":1}},"key":"fzyJdaQdGh"}],"identifier":"protecting-private-credentials","label":"Protecting private credentials","html_id":"protecting-private-credentials","implicit":true,"key":"Vq6C6rw08c"},{"type":"paragraph","position":{"start":{"line":1227,"column":1},"end":{"line":1228,"column":1}},"children":[{"type":"text","value":"It is important to ensure that configuration files do not get checked into version control, since this could expose them to the world if the project is shared.\nFor this reason, one should always add any configuration files to the ","position":{"start":{"line":1227,"column":1},"end":{"line":1227,"column":1}},"key":"kJJKMgfLyh"},{"type":"inlineCode","value":".gitignore","position":{"start":{"line":1227,"column":1},"end":{"line":1227,"column":1}},"key":"jIyeZS2Q7o"},{"type":"text","value":" file, which will prevent them from being checked into the repository by accident.","position":{"start":{"line":1227,"column":1},"end":{"line":1227,"column":1}},"key":"odZCYqqKNk"}],"key":"XyJCyEejD4"},{"type":"heading","depth":2,"position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"children":[{"type":"text","value":"Managing technical debt","position":{"start":{"line":1230,"column":1},"end":{"line":1230,"column":1}},"key":"pRGM94pSlM"}],"identifier":"managing-technical-debt","label":"Managing technical debt","html_id":"managing-technical-debt","implicit":true,"key":"csfUqVrESU"},{"type":"paragraph","position":{"start":{"line":1232,"column":1},"end":{"line":1233,"column":1}},"children":[{"type":"text","value":"The Python package ecosystem provides a cornucopia of tools, such that for nearly any problem one can find a package on PyPI or code on Github that can solve the problem.\nMost coders never think twice about installing a package that solves their problem; how could it be a bad thing? While we also love the richness of the Python package ecosystem, there are reasons to think twice about relying on arbitrary packages that one finds.","position":{"start":{"line":1232,"column":1},"end":{"line":1232,"column":1}},"key":"Ss1GDam0B3"}],"key":"d3CbQ60aCe"},{"type":"paragraph","position":{"start":{"line":1235,"column":1},"end":{"line":1237,"column":1}},"children":[{"type":"text","value":"The concept of ","position":{"start":{"line":1235,"column":1},"end":{"line":1235,"column":1}},"key":"Vd8sFbfdxR"},{"type":"emphasis","position":{"start":{"line":1235,"column":1},"end":{"line":1235,"column":1}},"children":[{"type":"text","value":"technical debt","position":{"start":{"line":1235,"column":1},"end":{"line":1235,"column":1}},"key":"qeC0jnH6p2"}],"key":"t4u2Hikdip"},{"type":"text","value":" refers to work that is deferred in the short term in exchange for higher costs in the future (such as maintenance or changes).\nThe use of an existing package counts as technical debt because there is uncertainty about how well any package will be maintained in the long term.\nA package that is not actively maintained can:","position":{"start":{"line":1235,"column":1},"end":{"line":1235,"column":1}},"key":"tK8Eg0jQjc"}],"key":"kkd9orxt6q"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1239,"column":1},"end":{"line":1243,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1239,"column":1},"end":{"line":1239,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"become dysfunctional with newer Python releases","position":{"start":{"line":1239,"column":1},"end":{"line":1239,"column":1}},"key":"toNyXYOsOB"}],"key":"qDs79ZwpRr"}],"key":"bEXBt5Jd99"},{"type":"listItem","spread":true,"position":{"start":{"line":1240,"column":1},"end":{"line":1240,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"come in conflict with newer versions of other packages, e.g. relying upon a function in another package that becomes deprecated","position":{"start":{"line":1240,"column":1},"end":{"line":1240,"column":1}},"key":"cNcbfItm4A"}],"key":"ywM57h7TM4"}],"key":"pM2O7koEcW"},{"type":"listItem","spread":true,"position":{"start":{"line":1241,"column":1},"end":{"line":1241,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"introduce security risks","position":{"start":{"line":1241,"column":1},"end":{"line":1241,"column":1}},"key":"hnuHdEjRd3"}],"key":"UYpg8ReVQJ"}],"key":"RVNf3gJIlp"},{"type":"listItem","spread":true,"position":{"start":{"line":1242,"column":1},"end":{"line":1243,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"fail to address bugs or errors in the code that are discovered by users","position":{"start":{"line":1242,"column":1},"end":{"line":1242,"column":1}},"key":"S0eDxEDpsX"}],"key":"SGMI4VjPGd"}],"key":"eY5bChpA2f"}],"key":"uNuuStRkCe"},{"type":"paragraph","position":{"start":{"line":1244,"column":1},"end":{"line":1244,"column":1}},"children":[{"type":"text","value":"At the same time, there are very good reasons for using well-maintained packages:","position":{"start":{"line":1244,"column":1},"end":{"line":1244,"column":1}},"key":"cIcDA4m2rG"}],"key":"VYbrq3zHSS"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1246,"column":1},"end":{"line":1249,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1246,"column":1},"end":{"line":1246,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Linus’ law (“given enough eyeballs, all bugs are shallow”) ","position":{"start":{"line":1246,"column":1},"end":{"line":1246,"column":1}},"key":"UqVHqhdpq5"},{"type":"citeGroup","kind":"parenthetical","position":{"start":{"line":1246,"column":1},"end":{"line":1246,"column":1}},"children":[{"type":"cite","identifier":"raymond:1999aa","label":"Raymond:1999aa","kind":"parenthetical","position":{"start":{"line":1246,"column":61},"end":{"line":1246,"column":76}},"children":[{"type":"text","value":"Raymond, 1999","key":"mrRCDLZTle"}],"enumerator":"8","key":"YQIDs0xT4f"}],"key":"CkXxF1HZQK"},{"type":"text","value":" suggests that highly used software is less likely to retain bugs","position":{"start":{"line":1246,"column":1},"end":{"line":1246,"column":1}},"key":"jHN1sxmLMd"}],"key":"pYLBzr0qrt"}],"key":"Y4JCSQhLNn"},{"type":"listItem","spread":true,"position":{"start":{"line":1247,"column":1},"end":{"line":1247,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A well-maintained package is likely to be well-tested","position":{"start":{"line":1247,"column":1},"end":{"line":1247,"column":1}},"key":"U5wpJGNOk5"}],"key":"JKaJ2EN1Ss"}],"key":"rfhHKh3y6P"},{"type":"listItem","spread":true,"position":{"start":{"line":1248,"column":1},"end":{"line":1249,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Using a well-maintained package can save a great deal of time compared to writing one’s own implementation","position":{"start":{"line":1248,"column":1},"end":{"line":1248,"column":1}},"key":"KtZzLqfqvY"}],"key":"fcOQ41ThOC"}],"key":"iWs5gpI16g"}],"key":"AUfWMwFUeW"},{"type":"paragraph","position":{"start":{"line":1250,"column":1},"end":{"line":1254,"column":1}},"children":[{"type":"text","value":"While we don’t want to suggest that one shouldn’t use any old package from PyPI that happens to solve an important problem, we think it’s important to keep in mind the fact that when we come to rely on a package, we are taking on technical debt and assuming some degree of risk.\nThe level of concern about this will vary depending upon the expected reuse of the code: If you expect to reuse the code in the future, then you should pay more attention to how well the code is maintained.\nTo see what an example of a well-maintained package look like, visit the Github repository for the ","position":{"start":{"line":1250,"column":1},"end":{"line":1250,"column":1}},"key":"j8lmPGufd0"},{"type":"link","url":"https://github.com/scikit-learn/scikit-learn","position":{"start":{"line":1250,"column":1},"end":{"line":1250,"column":1}},"children":[{"type":"text","value":"Scikit-learn project","position":{"start":{"line":1250,"column":1},"end":{"line":1250,"column":1}},"key":"bpyVJOGkPj"}],"urlSource":"https://github.com/scikit-learn/scikit-learn","error":true,"key":"LApbZoWbBZ"},{"type":"text","value":".\nThis is a long-lived project with more than 2000 contributors and a consistent history of commits over many years.\nMost projects will never reach this level of maturity, but we can use this as a template for what to look for in a well-maintained project:","position":{"start":{"line":1250,"column":1},"end":{"line":1250,"column":1}},"key":"GjRKnPOTWX"}],"key":"UzBod2VOYC"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1256,"column":1},"end":{"line":1260,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1256,"column":1},"end":{"line":1256,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Multiple active contributors (not just a single developer)","position":{"start":{"line":1256,"column":1},"end":{"line":1256,"column":1}},"key":"TU86VW1EBB"}],"key":"LRAdy1OxI1"}],"key":"gELnJ9kClo"},{"type":"listItem","spread":true,"position":{"start":{"line":1257,"column":1},"end":{"line":1257,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Automated testing with a high degree of code coverage","position":{"start":{"line":1257,"column":1},"end":{"line":1257,"column":1}},"key":"UesiXuKaM5"}],"key":"vPb1wbB3Zx"}],"key":"eK9cLwglwB"},{"type":"listItem","spread":true,"position":{"start":{"line":1258,"column":1},"end":{"line":1258,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Testing across multiple python versions, including recent ones","position":{"start":{"line":1258,"column":1},"end":{"line":1258,"column":1}},"key":"XUOcketgUn"}],"key":"wGYERvKuAJ"}],"key":"FpEregtPxs"},{"type":"listItem","spread":true,"position":{"start":{"line":1259,"column":1},"end":{"line":1260,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"An active issues page, with developers responding to issues relatively quickly","position":{"start":{"line":1259,"column":1},"end":{"line":1259,"column":1}},"key":"kTsiPJO0O3"}],"key":"h2lF22dtdg"}],"key":"W4pCQuSGQ1"}],"key":"fp8qR0Klsr"},{"type":"paragraph","position":{"start":{"line":1261,"column":1},"end":{"line":1261,"column":1}},"children":[{"type":"text","value":"You may well decide that the code from a project that doesn’t meet these standards is still useful enough to rely upon, but you should make that decision only after thinking through what would happen if the project was no longer maintained in the future.  Considering and managing dependency risk is an essential aspect of building good software.","position":{"start":{"line":1261,"column":1},"end":{"line":1261,"column":1}},"key":"Xmi0su4c3g"}],"key":"pvHhao1tGV"}],"key":"gzfuQeR5EB"}],"key":"hfkpSikfXw"},"references":{"cite":{"order":["Poldrack:2023aa","Gamma:1995aa","Fowler:1999aa","Simon:1962aa","Parnas:1972aa","Botvinik-Nezer:2020aa","Lewandowsky:2013aa","Raymond:1999aa"],"data":{"Poldrack:2023aa":{"label":"Poldrack:2023aa","enumerator":"1","html":"Poldrack, R. A., Lu, T., & Beguš, G. (2023). <i>AI-assisted coding: Experiments with GPT-4</i>. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://arxiv.org/abs/2304.13187\">https://arxiv.org/abs/2304.13187</a>","url":"https://arxiv.org/abs/2304.13187"},"Gamma:1995aa":{"label":"Gamma:1995aa","enumerator":"2","html":"Gamma, E. (1995). <i>Design patterns: elements of reusable object-oriented software</i>. Addison-Wesley."},"Fowler:1999aa":{"label":"Fowler:1999aa","enumerator":"3","html":"Fowler, M., & Beck, K. (1999). <i>Refactoring: improving the design of existing code</i>. Addison-Wesley."},"Simon:1962aa":{"label":"Simon:1962aa","enumerator":"4","html":"Simon, H. A. (1962). The Architecture of Complexity. <i>Proceedings of the American Philosophical Society</i>, <i>106</i>(6), 467–482."},"Parnas:1972aa":{"label":"Parnas:1972aa","enumerator":"5","doi":"10.1145/361598.361623","html":"Parnas, D. L. (1972). On the criteria to be used in decomposing systems into modules. <i>Commun. ACM</i>, <i>15</i>(12), 1053–1058. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1145/361598.361623\">10.1145/361598.361623</a>","url":"https://doi.org/10.1145/361598.361623"},"Botvinik-Nezer:2020aa":{"label":"Botvinik-Nezer:2020aa","enumerator":"6","doi":"10.1038/s41586-020-2314-9","html":"Botvinik-Nezer, R., Holzmeister, F., Camerer, C. F., Dreber, A., Huber, J., Johannesson, M., Kirchler, M., Iwanir, R., Mumford, J. A., Adcock, R. A., Avesani, P., Baczkowski, B. M., Bajracharya, A., Bakst, L., Ball, S., Barilari, M., Bault, N., Beaton, D., Beitner, J., … Schonberg, T. (2020). Variability in the analysis of a single neuroimaging dataset by many teams. <i>Nature</i>, <i>582</i>(7810), 84–88. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1038/s41586-020-2314-9\">10.1038/s41586-020-2314-9</a>","url":"https://doi.org/10.1038/s41586-020-2314-9"},"Lewandowsky:2013aa":{"label":"Lewandowsky:2013aa","enumerator":"7","doi":"10.1371/journal.pone.0075637","html":"Lewandowsky, S., Gignac, G. E., & Oberauer, K. (2013). The role of conspiracist ideation and worldviews in predicting rejection of science. <i>PLoS One</i>, <i>8</i>(10), e75637. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1371/journal.pone.0075637\">10.1371/journal.pone.0075637</a>","url":"https://doi.org/10.1371/journal.pone.0075637"},"Raymond:1999aa":{"label":"Raymond:1999aa","enumerator":"8","html":"Raymond, E. S. (1999). <i>The cathedral & the bazaar: musings on Linux and open source by an accidental revolutionary</i> (1st ed). O’Reilly. <a target=\"_blank\" rel=\"noreferrer\" href=\"http://www.loc.gov/catdir/enhancements/fy0915/99045768-b.html\">http://www.loc.gov/catdir/enhancements/fy0915/99045768-b.html</a>","url":"http://www.loc.gov/catdir/enhancements/fy0915/99045768-b.html"}}}},"footer":{"navigation":{"prev":{"title":"Essential tools and techniques","url":"/essential-tools-and-techniques","group":"Better Code, Better Science"},"next":{"title":"Software testing","url":"/testing","group":"Better Code, Better Science"}}},"domain":"http://localhost:3000"}