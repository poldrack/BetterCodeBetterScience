

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Essential tools and techniques &#8212; Better Code, Better Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'essential_tools_and_techniques';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Principles of software engineering" href="software_engineering.html" />
    <link rel="prev" title="Introduction" href="introduction.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="frontmatter.html">
  
  
  
  
  
  
    <p class="title logo__title">Better Code, Better Science</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="frontmatter.html">
                    Better Code, Better Science
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Essential tools and techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="software_engineering.html">Principles of software engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Software testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/poldrack/BetterCodeBetterScience" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/poldrack/BetterCodeBetterScience/issues/new?title=Issue%20on%20page%20%2Fessential_tools_and_techniques.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/essential_tools_and_techniques.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Essential tools and techniques</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-tools-and-why-we-use-them">The tools and why we use them</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-python">Why Python?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#version-control">Version control</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-version-control-works">How version control works</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#version-control-as-a-lab-notebook">Version control as a lab notebook</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#version-control-best-practices">Version control best practices</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#use-a-consistent-standard-format-for-commit-messages">Use a consistent standard format for commit messages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#explain-intent-rather-than-code">Explain intent rather than code</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-single-commit-should-reflect-solution-of-a-particular-problem">A single commit should reflect solution of a particular problem</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#avoid-blanket-add-commit-operations">Avoid blanket add/commit operations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#version-control-as-developer-productivity-tool">Version control as developer productivity tool</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#falling-back-on-previous-commits">Falling back on previous commits</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-branches">Using branches</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#collaborative-development-using-github">Collaborative development using GitHub</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#virtual-environments">Virtual environments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-management-using-uv">Environment management using <em>uv</em></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#locking-dependencies-in-uv">Locking dependencies in uv</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-management-using-conda">Environment management using <em>conda</em></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#large-language-models">Large language models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-brief-history-of-neural-networks">A brief history of neural networks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-llms-are-built-and-trained">How LLMs are built and trained</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#open-source-language-models">“Open Source” language models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-context-learning-and-llm-prompting">In-context learning and LLM prompting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#randomness-in-llms">Randomness in LLMs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducibilty-challenges-of-llms">Reproducibilty challenges of LLMs</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="essential-tools-and-techniques">
<h1>Essential tools and techniques<a class="headerlink" href="#essential-tools-and-techniques" title="Permalink to this heading">#</a></h1>
<section id="the-tools-and-why-we-use-them">
<h2>The tools and why we use them<a class="headerlink" href="#the-tools-and-why-we-use-them" title="Permalink to this heading">#</a></h2>
<p>We hope that the principles and strategies outlined in this book will transcend any particular software platform or programming language, but for the purposes of explication we will focus on a particular language (Python) and a particular set of tools for software development/engineering and AI coding assistance.
Here we briefly outline our motivation for these particular tools.</p>
<section id="why-python">
<h3>Why Python?<a class="headerlink" href="#why-python" title="Permalink to this heading">#</a></h3>
<p>For the coding examples in this book we will use the Python programming language.
We have chosen Python first and foremost because it is a language that we know well, as well as being one of the most popular languages today in science.
Python is a relatively high level programming language, which means that it can be understandable (if written correctly) even by someone with relatively little experience.
It also free and open source, which means that anyone with a computer can download it and run it at no cost.
In addition, Python is a language that has exceptionally good support from AI coding assistants such as GitHub Copilot, which has been trained on a huge corpus of Python code (along with code from many other languages as well).
Python also has a large and growing ecosystem of packages and tools that make it possible to solve many different problems easily.
If you are interested in working on machine learning or AI, the tools in Python are especially good.</p>
<p>Across many different domains of science there are specialized Python packages to solve domain-specific problems: Examples include <a class="reference external" href="https://www.astropy.org/">astropy</a> (astronomy), <a class="reference external" href="https://geopandas.org/en/stable/getting_started/introduction.html">geopandas</a> (geospatial sciences), <a class="reference external" href="https://quantecon.org/">quantecon</a> (economics), <a class="reference external" href="https://sunpy.org/">sunpy</a> (solar physics), and <a class="reference external" href="https://www.psychopy.org/">psychopy</a>, just to name a few.
We should note that different scientific communities have often converged on particular high-level languages.
The above are some examples of Python packages, but in some fields the ecosystem is much more elaborated in R, Julia, Perl or Matlab.
We hope that most of the lessons in this book will be relevant to these other languages as well.</p>
<p>If you don’t already know Python, then we suggest that you try to follow along with the examples anyway; our aim is to write them in a way that anyone with a general knowledge of programming should be able to read and understand them.
In some cases we may use programming constructs that are specific to Python; if you are coming from another language and you see something you don’t understand, then we would recommend asking an AI assistant to explain it to you, since current AI tools are very good at explaining the intent of Python code! As we discuss in Chapter XXX, learning a new programming language is a great way to expand your programming skills, and Python is currently a great language to learn.</p>
</section>
</section>
<section id="version-control">
<h2>Version control<a class="headerlink" href="#version-control" title="Permalink to this heading">#</a></h2>
<p>Scientists in many fields have traditionally kept a <em>lab notebook</em> to record their experimentation.
This is still the case in domains such as biology where the work often involves manual experimentation at a lab bench.
Many such labs have moved to using electronic lab notebooks, making it much easier to search and find relevant information.
However, an increasing amount of scientific work is now computational, and for this work it would seem somewhat inefficient to record information about the software development process separately from the code that is being written.
There is in fact a tool that can provide the computational researcher with an integrated way to record the history their work, known as <em>version control.</em> While there are many tools that can be used to perform version control, <a class="reference external" href="https://git-scm.com/">git</a> has become by far the most prevalent within the scientific computing ecosystem, largely due to the popularity of the <a class="reference external" href="http://github.com">GitHub</a> web site that enables the hosting and sharing of git repositories.</p>
<p>In this section we will assume that the researcher has a basic knowledge of the <code class="docutils literal notranslate"><span class="pre">git</span></code> software tool; for researchers looking to learn <code class="docutils literal notranslate"><span class="pre">git</span></code>, there are numerous resources online, which we will not duplicate; see the suggested resources at the end of this chapter.
Here we will focus on the ways in which version control tools like <code class="docutils literal notranslate"><span class="pre">git</span></code> can serve as important tools to improve scientific coding.
While there are numerous graphical user interfaces (GUIs) for git (including those offered by various IDEs), we will focus on its use via the command line interface (CLI).
Every researcher should have a basic knowledge of the <code class="docutils literal notranslate"><span class="pre">git</span></code> CLI, since this is a ubiquitous interface available across all OSes and environments.
The CLI is sometimes the only interface that is available to the researcher, e.g. in a remote session on an HPC system or in the cloud.
Moreover, the CLI provides an immediate exposure to available commands (run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">--help</span></code>) and options for each command (run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">COMMAND</span> <span class="pre">--help</span></code>), allowing users to discover a command or option that might not (yet) be exposed by any particular GUI tool.</p>
<section id="how-version-control-works">
<h3>How version control works<a class="headerlink" href="#how-version-control-works" title="Permalink to this heading">#</a></h3>
<p>The goal of a version control system is to provide an annotated history of all changes that occur to the tracked files.
Here we will provide a brief overview of the conceptual structure of version control, using the <code class="docutils literal notranslate"><span class="pre">git</span></code> system as our example.</p>
<p>The general workflow for version control using <code class="docutils literal notranslate"><span class="pre">git</span></code> is as follows:</p>
<ul class="simple">
<li><p>Initial check-in: A file is added to the database.</p></li>
<li><p>The file is <em>modified</em> by the user, but the changes are not added to the database.</p></li>
<li><p>The file is <em>added</em> to the staging area, which tracks the changes in the file and marks the new version to be added to the database.</p></li>
<li><p>The file is <em>committed</em>, which stores it in the base along with a <em>commit message</em> that describes the changes.</p></li>
</ul>
<p><strong>TODO</strong>: Provide visualizations for git/github concepts?</p>
<p>Here is an example using <code class="docutils literal notranslate"><span class="pre">git</span></code>.
We will create a test directory (outside of our current git repository) and initialize it as a git repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/tmp
&gt;<span class="w"> </span>mkdir<span class="w"> </span>git-test
&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>git-test
&gt;<span class="w"> </span>git<span class="w"> </span>init
&gt;<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;test file&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>test_file.txt
❯<span class="w"> </span>git<span class="w"> </span>status
On<span class="w"> </span>branch<span class="w"> </span>main

No<span class="w"> </span>commits<span class="w"> </span>yet

Untracked<span class="w"> </span>files:
<span class="w">  </span><span class="o">(</span>use<span class="w"> </span><span class="s2">&quot;git add &lt;file&gt;...&quot;</span><span class="w"> </span>to<span class="w"> </span>include<span class="w"> </span><span class="k">in</span><span class="w"> </span>what<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>committed<span class="o">)</span>
<span class="w">	</span>test_file.txt

nothing<span class="w"> </span>added<span class="w"> </span>to<span class="w"> </span>commit<span class="w"> </span>but<span class="w"> </span>untracked<span class="w"> </span>files<span class="w"> </span>present<span class="w"> </span><span class="o">(</span>use<span class="w"> </span><span class="s2">&quot;git add&quot;</span><span class="w"> </span>to<span class="w"> </span>track<span class="o">)</span>
</pre></div>
</div>
<p>So far our new file is not being tracked, but we can add it to the database:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>git<span class="w"> </span>add<span class="w"> </span>test_file.txt
❯<span class="w"> </span>git<span class="w"> </span>status
On<span class="w"> </span>branch<span class="w"> </span>main

No<span class="w"> </span>commits<span class="w"> </span>yet

Changes<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>committed:
<span class="w">  </span><span class="o">(</span>use<span class="w"> </span><span class="s2">&quot;git rm --cached &lt;file&gt;...&quot;</span><span class="w"> </span>to<span class="w"> </span>unstage<span class="o">)</span>
<span class="w">	</span>new<span class="w"> </span>file:<span class="w">   </span>test_file.txt
</pre></div>
</div>
<p>It’s now in the staging area, but hasn’t yet been committed to the database, as we can see if we print the log:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>git<span class="w"> </span>log
fatal:<span class="w"> </span>your<span class="w"> </span>current<span class="w"> </span>branch<span class="w"> </span><span class="s1">&#39;main&#39;</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>have<span class="w"> </span>any<span class="w"> </span>commits<span class="w"> </span>yet
</pre></div>
</div>
<p>We can commit the items in the staging area (in this case, just our single added file) to the database and provide a message that labels the commit:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="s2">&quot;initial add&quot;</span>
<span class="o">[</span>main<span class="w"> </span><span class="o">(</span>root-commit<span class="o">)</span><span class="w"> </span>752ca80<span class="o">]</span><span class="w"> </span>initial<span class="w"> </span>add
<span class="w"> </span><span class="m">1</span><span class="w"> </span>file<span class="w"> </span>changed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>insertion<span class="o">(</span>+<span class="o">)</span>
<span class="w"> </span>create<span class="w"> </span>mode<span class="w"> </span><span class="m">100644</span><span class="w"> </span>test_file.txt
❯<span class="w"> </span>git<span class="w"> </span>status
On<span class="w"> </span>branch<span class="w"> </span>main
nothing<span class="w"> </span>to<span class="w"> </span>commit,<span class="w"> </span>working<span class="w"> </span>tree<span class="w"> </span>clean
</pre></div>
</div>
<p>Now that all changes have been committed, we are “clean”, meaning that the files in the directory match exactly to those in the database.
We can see the commit in the git log:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>git<span class="w"> </span>log
commit<span class="w"> </span>752ca809cd662f846434dcb2c81f3000db640b4e<span class="w"> </span><span class="o">(</span>HEAD<span class="w"> </span>-&gt;<span class="w"> </span>main<span class="o">)</span>
Author:<span class="w"> </span>Russell<span class="w"> </span>Poldrack<span class="w"> </span>&lt;poldrack@gmail.com&gt;
Date:<span class="w">   </span>Mon<span class="w"> </span>Feb<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">07</span>:42:35<span class="w"> </span><span class="m">2025</span><span class="w"> </span>-0800

<span class="w">    </span>initial<span class="w"> </span>add
</pre></div>
</div>
<p>The long string (starting with “752”) is the <em>hash</em> for this commit.
This is a value (generated by a cryptographic algorithm called SHA-1) that uniquely represents all of the changes that were made in this commit.
For example, if we had used a different commit message then the hash would be different.
The commit hash is the way that we refer to commits - for example, if we wanted to change the state of our repository back to an earlier commit we would use the hash of that earlier commit.
We usually don’t need to use the entire hash; the first ~8 letters are usually sufficient.</p>
<p>The most important role for version control is to track changes in a file, along with notes about those changes.
That is, it can serve as a digital version of a lab notebook! Let’s make a change to the file to see this in action:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;another line&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>test_file.txt<span class="w"> </span><span class="c1"># add another line of text</span>
&gt;<span class="w"> </span>git<span class="w"> </span>diff<span class="w"> </span>test_file.txt
diff<span class="w"> </span>--git<span class="w"> </span>a/test_file.txt<span class="w"> </span>b/test_file.txt
index<span class="w"> </span>16b14f5..0db3737<span class="w"> </span><span class="m">100644</span>
---<span class="w"> </span>a/test_file.txt
+++<span class="w"> </span>b/test_file.txt
@@<span class="w"> </span>-1<span class="w"> </span>+1,2<span class="w"> </span>@@
<span class="w"> </span><span class="nb">test</span><span class="w"> </span>file
+another<span class="w"> </span>line
</pre></div>
</div>
<p>This provides us with a (somewhat cryptic) description of the changes to the file; the line starting with a “+” denotes the content that was added (in the console this would also be color-coded in green).
We can then add and commit the file and then view the new commit in the log:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>git<span class="w"> </span>add<span class="w"> </span>test_file.txt
❯<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="s2">&quot;added a second line&quot;</span>
<span class="o">[</span>main<span class="w"> </span>5e8c41a<span class="o">]</span><span class="w"> </span>added<span class="w"> </span>a<span class="w"> </span>second<span class="w"> </span>line
<span class="w"> </span><span class="m">1</span><span class="w"> </span>file<span class="w"> </span>changed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>insertion<span class="o">(</span>+<span class="o">)</span>
❯<span class="w"> </span>git<span class="w"> </span>log

commit<span class="w"> </span>5e8c41a075b2ab2d954d59cab6530d924c5e3e6a<span class="w"> </span><span class="o">(</span>HEAD<span class="w"> </span>-&gt;<span class="w"> </span>main<span class="o">)</span>
Author:<span class="w"> </span>Russell<span class="w"> </span>Poldrack<span class="w"> </span>&lt;poldrack@gmail.com&gt;
Date:<span class="w">   </span>Mon<span class="w"> </span>Feb<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">07</span>:56:09<span class="w"> </span><span class="m">2025</span><span class="w"> </span>-0800

<span class="w">    </span>added<span class="w"> </span>a<span class="w"> </span>second<span class="w"> </span>line

commit<span class="w"> </span>752ca809cd662f846434dcb2c81f3000db640b4e
Author:<span class="w"> </span>Russell<span class="w"> </span>Poldrack<span class="w"> </span>&lt;poldrack@gmail.com&gt;
Date:<span class="w">   </span>Mon<span class="w"> </span>Feb<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">07</span>:42:35<span class="w"> </span><span class="m">2025</span><span class="w"> </span>-0800

<span class="w">    </span>initial<span class="w"> </span>add
</pre></div>
</div>
<p>Now we can see our latest commit at the top of the list.
If we were to push our repository to GitHub, then we could also see a much more user-friendly graphical view of commit history and the changes that occurred in each commit.
Most IDEs also have an interface to work directly with <code class="docutils literal notranslate"><span class="pre">git</span></code>; for example, within VSCode there is a <em>Source Control</em> panel that would allow one to do everything that we did above using the command line.</p>
</section>
<section id="version-control-as-a-lab-notebook">
<h3>Version control as a lab notebook<a class="headerlink" href="#version-control-as-a-lab-notebook" title="Permalink to this heading">#</a></h3>
<p>It is essential for a researcher to keep track of their work as it proceeds, and traditionally this has been done using a written lab notebook.
This has several drawbacks; it’s impossible to search easily, and for researchers with terrible handwriting (like author RP) it can often be impossible to later decipher what the notes actually mean.</p>
<figure class="align-default" id="labnotebook-fig">
<a class="reference internal image-reference" href="_images/lab_notebook_scan.png"><img alt="Scan of a page from Russ's lab notebook circa 2000." src="_images/lab_notebook_scan.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">Scan of a page from Russ’s lab notebook circa 2000.</span><a class="headerlink" href="#labnotebook-fig" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="version-control-best-practices">
<h3>Version control best practices<a class="headerlink" href="#version-control-best-practices" title="Permalink to this heading">#</a></h3>
<p>Version control systems like <code class="docutils literal notranslate"><span class="pre">git</span></code> can serve as an outstanding alternative to a written lab notebook for the computational researcher, but only if it used well.
Here are a few best practices for ensuring good record-keeping:</p>
<section id="use-a-consistent-standard-format-for-commit-messages">
<h4>Use a consistent standard format for commit messages<a class="headerlink" href="#use-a-consistent-standard-format-for-commit-messages" title="Permalink to this heading">#</a></h4>
<p>Using a particular format consistently will make it much easier to understand and search your history later on.
Here is one simple format that one might use for commit messages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">summary</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">optional</span> <span class="n">longer</span> <span class="n">description</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The <em>type</em> tag describes the type of change, which could include tags like <em>feature</em>, <em>bugfix</em>, <em>refactor</em>, <em>doc</em>, <em>test</em>, and <em>cleanup</em>.</p>
<p>The <em>summary</em> should include a brief summary (usually less than 72 characters) that summarizes what was done.
You should avoid using generic or vague summaries such as “update” or “fix bug”.</p>
<p>By <code class="docutils literal notranslate"><span class="pre">git</span></code> convention, commit messages should be written in imperative mood, as if one is giving a command.
For example, the message might say “add test for infinite edge case” rather than “added test for infinite edge case”.</p>
<p>Here is a example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">refactor</span><span class="p">:</span> <span class="n">Make</span> <span class="n">crossvalidation</span> <span class="n">function</span> <span class="n">cleaner</span>

<span class="n">The</span> <span class="n">previous</span> <span class="n">function</span> <span class="n">was</span> <span class="n">written</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">way</span> <span class="n">that</span> <span class="n">was</span> <span class="ow">not</span> <span class="n">clean</span><span class="p">,</span> <span class="n">using</span> <span class="n">badly</span> <span class="n">named</span> <span class="n">variables</span> <span class="ow">and</span> <span class="n">confusing</span> <span class="n">programming</span> <span class="n">constructs</span><span class="o">.</span>  <span class="n">The</span> <span class="n">new</span> <span class="n">code</span> <span class="n">fixes</span> <span class="n">these</span> <span class="n">issues</span> <span class="k">while</span> <span class="n">still</span> <span class="n">passing</span> <span class="nb">all</span> <span class="n">tests</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="explain-intent-rather-than-code">
<h4>Explain intent rather than code<a class="headerlink" href="#explain-intent-rather-than-code" title="Permalink to this heading">#</a></h4>
<p>A good commit message should explain what problem was being solved and why the change was necessary, rather than detailing the specific code changes.
The code changes are already evident from the change log, so the message should focus instead on details that are not evident from looking at the code itself.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">feature</span><span class="p">:</span> <span class="n">Enable</span> <span class="n">use</span> <span class="n">of</span> <span class="n">multiple</span> <span class="n">APIs</span>

<span class="n">Previously</span> <span class="n">the</span> <span class="n">function</span> <span class="n">only</span> <span class="n">worked</span> <span class="k">with</span> <span class="n">the</span> <span class="n">OpenAI</span> <span class="n">API</span><span class="o">.</span>  <span class="n">This</span> <span class="n">change</span> <span class="n">generalizes</span> <span class="n">it</span> <span class="n">to</span> <span class="n">allow</span> <span class="nb">any</span> <span class="n">endpoint</span> <span class="n">that</span> <span class="n">follows</span> <span class="n">the</span> <span class="n">OpenAI</span> <span class="n">API</span> <span class="n">conventions</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="a-single-commit-should-reflect-solution-of-a-particular-problem">
<h4>A single commit should reflect solution of a particular problem<a class="headerlink" href="#a-single-commit-should-reflect-solution-of-a-particular-problem" title="Permalink to this heading">#</a></h4>
<p>One of the tricky aspects of learning to use version control is learning when to commit.
One rule of thumb is that a commit should reflect a group of changes that solve a particular problem.
For example, say that we have modified three source files to add the multiple API functionality listed above.
We could on the one hand add and commit the changes from each file separately, leading to three separate commits.
This is too granular; if we later decide that we want to roll back those changes (which could be difficult depending on commit messages and our memory), we have to identify the three separate commits and then roll back each one separately.
At the other extreme, it’s not uncommon for users to check in all of the work that was done in a day, with a commit message like “all work from Tuesday”.
If one were to later decide that part of the work from that day needed to be rolled back, it would require a lot of extra work to isolate just those changes.
The sweet spot for committing is to commit changes that represent a functional bundle, or that solve a particular problem.
Thinking about the commit message can be helpful in considering when to commit; if it’s difficult to give a concise functional description to the specific set of changes being committed, then the commit may be either too narrow or too broad.</p>
</section>
<section id="avoid-blanket-add-commit-operations">
<h4>Avoid blanket add/commit operations<a class="headerlink" href="#avoid-blanket-add-commit-operations" title="Permalink to this heading">#</a></h4>
<p>Another common <code class="docutils literal notranslate"><span class="pre">git</span></code> “anti-pattern” (i.e. a commonly used but bad solution to a common problem) is to simply add all files using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">.</span></code> (which adds all files in the current directory, including those that have not been added) or <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">-A</span></code> (which does the similar thing recursively for the entire directory tree).
This kind of “blanket add/commit” is problematic for at least two reasons.
First, there are often files that we don’t want to add to version control, such as files containing credentials or files with details about the local system configuration.
While we would usually want to add these files to our <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file (which prevents them from being added), it’s best practice to explicitly add files that we are working on.
A second reason to avoid blanket add/commit is that if we are working on more than one problem at a time, the resulting commit will bundle together files that address different problems and thus prevent writing a clean commit message as well as prevent a clean reversion of that code later.
It would also require knowing exactly which files have been added in order to create an accurate commit message.
The only time that we can imagine a blanket add/commit being reasonable is when one is initially creating a repository using a large number of files.</p>
<p>A better practice is to explicitly name all files being added, which forces one to think about exactly what problem the commit is solving.
If one is certain that they know exactly which code files have been changed, then a useful alternative can be to only add modified files (using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">-u</span></code>), which can save a bit of time if there are numerous files being added.
However, it’s important to make sure that the commit message always faithfully reflects the totality of the changes.</p>
</section>
</section>
<section id="version-control-as-developer-productivity-tool">
<h3>Version control as developer productivity tool<a class="headerlink" href="#version-control-as-developer-productivity-tool" title="Permalink to this heading">#</a></h3>
<p>So far we have discussed version control primarily as a way to record the history of software development.
But an arguably even more powerful aspect of version control is the way that it enables developer productivity by allowing one to try our new changes and easily revert to a previous version.
It’s useful to first examine how this might be done without version control.
Suppose a developer has a codebase and wants to try out a major change, such as changing the database backend used in the project.
They would usually save a copy of all of the source files (perhaps with a timestamped label), and then start working on the problem.
If at some point they wish to completely abandon the new project, they can always go back to the copy of the original.
But what if they want to abandon the latest part (e.g. a specific database) without necessarily abandoning the rest of the work that it took to get there? Unless they are saving copies at every step (which quickly becomes a bookkeeping nightmare), this will be very challenging to pull off.
On the other hand, with a solid version control workflow these problems are trivial to solve, because these systems are built exactly in order to solve this bookkeeping problem.</p>
<section id="falling-back-on-previous-commits">
<h4>Falling back on previous commits<a class="headerlink" href="#falling-back-on-previous-commits" title="Permalink to this heading">#</a></h4>
<p>We will start first with a simple example that only involves the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch of the repository; if you don’t know what a “branch” is, this would be a good time to seek out your favorite <code class="docutils literal notranslate"><span class="pre">git</span></code> resource and learn about that concept.
Later we will suggest that working directly in the main branch is not optimal, but it’s common for many research projects with a single developer so we will start there, fitting with our mantra that we should never let the perfect be the enemy of the good.</p>
<p>Let’s say that we wish to try changing out the database backend for our project, which will require changes to several of the source files.
Starting with a clean working tree (i.e. no uncommitted changes or untracked files not included in <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code>), we would first create a new tag so that we can easily find the last commit in case we decide that we want to revert back to it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>tag<span class="w"> </span>v0.2-pre-db-change
</pre></div>
</div>
<p>We then start developing on the new code, committing as usual.
Let’s say that we make a few commits on the new code, but then go down a road that we decide to abandon.
It’s easy to get back to the last commit simply by typing <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">reset</span> <span class="pre">--hard</span> <span class="pre">HEAD</span></code>, which takes the code back to the state it was in at the last commit (known as “HEAD”).
In the case that we decide to abandon the entire project and want to go back to the state of the code when we started (which is denoted by the tag we created), we simply need to find the hash for that commit and then check out that version of the repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>git<span class="w"> </span>show<span class="w"> </span>v0.2-pre-db-change
commit<span class="w"> </span>5e8c41a075b2ab2d954d59cab6530d924c5e3e6a<span class="w"> </span><span class="o">(</span>HEAD<span class="w"> </span>-&gt;<span class="w"> </span>main,<span class="w"> </span>tag:<span class="w"> </span>v0.2-pre-db-change,<span class="w"> </span>tag:<span class="w"> </span>v0.2<span class="o">)</span>
&gt;<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>5e8c41a07<span class="w"> </span>.
&gt;<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="s2">&quot;&quot;&quot;</span>
<span class="s2">cleanup: Revert attempted database backend switch</span>

<span class="s2">We tried to replace the database backend but realized after some</span>
<span class="s2">development that this would not solve our problem, so we are reverting</span>
<span class="s2">back to the original code.&quot;&quot;&quot;</span>

On<span class="w"> </span>branch<span class="w"> </span>main
nothing<span class="w"> </span>to<span class="w"> </span>commit,<span class="w"> </span>working<span class="w"> </span>tree<span class="w"> </span>clean
</pre></div>
</div>
<p>A look at the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span></code> will now show that the HEAD matches the hash for the tagged commit.</p>
</section>
<section id="using-branches">
<h4>Using branches<a class="headerlink" href="#using-branches" title="Permalink to this heading">#</a></h4>
<p>All <code class="docutils literal notranslate"><span class="pre">git</span></code> repositories start with a single default branch, usually called “main” (or sometimes the previous convention, “master”).
While it’s possible to develop completely within the main branch of a repository, we generally prefer to use <em>development branches</em>, which can be thought of as different versions of the repository.
In our preferred workflow, whenever we want to modify code we first create and then check out a new branch, in which we will do that work.
One great benefit of this is that if the main branch was working when we created the development branch, it will remain in a working state even as we make our changes in the new branch.
This provides much greater freedom to try out changes with no concern about breaking existing code, and also allows development to proceed without interfering with production code.</p>
<p>It’s important to name branches in way that makes clear what their purpose is.
It is customary to use a prefix that states the general purpose of the branch; common prefixes including “feature/” (for new features), “bugfix/” (for bug fixes), “release/” (for a new package release), “docs/” (for documentation changes), and “test/” (for testing-related changes).
The prefix should be followed by a description of the purpose of the branch.
For example, for our example above we might use “feature/swap-db-backend”.</p>
<p>We can create a new branch and check it out (making it the current branch) using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>git<span class="w"> </span>branch
*<span class="w"> </span>main
❯<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>feature/swap-db-backend
Switched<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>branch<span class="w"> </span><span class="s1">&#39;feature/swap-db-backend&#39;</span>
&gt;<span class="w"> </span>git<span class="w"> </span>branch
*<span class="w"> </span>feature/swap-db-backend
<span class="w">  </span>main
</pre></div>
</div>
<p>We can now go about our development work, committing as usual to the branch.
If we were to later decide to abandon the new branch, we simply check out the main branch, and we are right back where we left off before creating the new branch.
We could either delete the feature branch (to keep the repository clean), or keep it around in case we wish to go back later and look at it again.</p>
</section>
</section>
<section id="collaborative-development-using-github">
<h3>Collaborative development using GitHub<a class="headerlink" href="#collaborative-development-using-github" title="Permalink to this heading">#</a></h3>
<p>While git is very useful for the individual developer, it becomes even more powerful when used for collaborative development amongst a group of developers.
For <code class="docutils literal notranslate"><span class="pre">git</span></code> users this is enabled by the popular <a class="reference external" href="http://github.com">GitHub</a> web platform for version control.
We will assume a basic familiarity with the use of GitHub: see the Suggested Resources at the end of the chapter for resources to learn how to use GitHub.</p>
<p>Collaborative development requires choosing a workflow that the team will adhere to; a commonly used workflow for GitHub users is the <a class="reference external" href="https://docs.github.com/en/get-started/using-github/github-flow">GitHub flow</a>, which goes as follows.
Let’s say that we have two developers on our team, and one of them wants to attempt the database backend project that we described above.
The process would be:</p>
<ol class="arabic simple">
<li><p>The developer creates a branch within the repo, giving it a a clear and expressive name such as “feature/swap-db-backend”. They develop their code within this branch.</p></li>
<li><p>If the user doesn’t have write access to the repo, they first create a <em>fork</em> of the repo, which copies it to their own account and thus allows write access.</p></li>
<li><p>Once the feature is complete, they commit and push all of their changes to the repository on GitHub.</p></li>
<li><p>They then create a <em>pull request</em>, which requests that the code in their branch be merged into the main branch of the primary repository.</p></li>
<li><p>Another developer on the team reviews the pull request, and provides comments suggesting changes to the code.</p></li>
<li><p>Once the reviewer’s comments are addressed, the code from the branch is merged into the main branch, so that the changes are now incorporated there.</p></li>
<li><p>After merging, the branch is deleted to keep the repository clean.</p></li>
</ol>
<p>This type of collaborative development process powers many of the large open source projects that are commonly used today, but can be equally transformative for small groups such as a individual research lab.</p>
</section>
</section>
<section id="virtual-environments">
<h2>Virtual environments<a class="headerlink" href="#virtual-environments" title="Permalink to this heading">#</a></h2>
<p>When developing software, it is essential to have a way to manage the many dependencies and software versions that are necessary, particularly for a language like Python that has a broad landscape of packages.
This problem is generally solved using <em>virtual environments</em>, which provide a way to isolate a specific set of software dependencies necessary for a project.</p>
<p>This is important for several reasons.
First, it allows different projects to use different versions of specific packages without interfering with one another.
One often finds the need to install an older version of a particular dependency, or an older version of Python, in order to use a specific tool.
Without virtual environments, managing different dependencies across projects can become impossible.
If one project requires Python ≤3.9 while another needs Python ≥3.12, conflicts arise that virtual environments can easily resolve.
Second, because the virtual environment specifies the exact version of each dependency and allows these to be exported, it is possible for other users on different machines to exactly recreate the package environment required by the author (assuming that those package versions are available on the users’s operating system).
This can greatly enhance the reproducibility of computational analyses across systems, and can also ease the implementation of software across multiple machines (e.g. when one wants to move code from a local machine into the cloud).
On shared computing systems (such as academic computing clusters), virtual environments let users install their own packages without needing admin access.</p>
<p>A virtual environment is at its heart simply a directory structure that contains a specified set of executables and software dependencies.
When the virtual environment is <em>activated</em> using a special command, these directories are added to the system paths, allowing them to be accessed just like any software installed centrally on the system.
They can be easily removed from the path by deactivating the environment.</p>
<p>There are numerous tools within the Python ecosystem for package management and virtual environments, to the degree that some have called it an <a class="reference external" href="https://dublog.net/blog/so-many-python-package-managers/">“inexcusable pain in the ass”</a>.
We will focus on two solutions here (uv and conda), realizing that things will change over time and these recommendations will likely need to be updated (living textbooks FTW!).</p>
<section id="environment-management-using-uv">
<h3>Environment management using <em>uv</em><a class="headerlink" href="#environment-management-using-uv" title="Permalink to this heading">#</a></h3>
<p><a class="reference external" href="https://docs.astral.sh/uv/">uv</a> is a relatively new package management tool that has quickly gained momentum in the Python community, in large part because of its speed (10-100x faster than older tools) and its efficient use of disk space.
To start, we simply initialize a new project, marking it as a package so that it will create the appropriate code structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>uv<span class="w"> </span>init<span class="w"> </span>--package<span class="w"> </span>uv_example
Initialized<span class="w"> </span>project<span class="w"> </span><span class="sb">`</span>uv-example<span class="sb">`</span><span class="w"> </span>at<span class="w"> </span><span class="sb">`</span>/private/tmp/uvtest/uv_example<span class="sb">`</span>
❯<span class="w"> </span>tree<span class="w"> </span>uv_example
uv_example
├──<span class="w"> </span>pyproject.toml
├──<span class="w"> </span>README.md
└──<span class="w"> </span>src
<span class="w">    </span>└──<span class="w"> </span>uv_example
<span class="w">        </span>└──<span class="w"> </span>__init__.py
</pre></div>
</div>
<p>We can then create a new virtual environment using the command <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">venv</span></code>.
This is stored within the directory <code class="docutils literal notranslate"><span class="pre">.venv</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>uv_example
❯<span class="w"> </span>uv<span class="w"> </span>venv
Using<span class="w"> </span>CPython<span class="w"> </span><span class="m">3</span>.13.1
Creating<span class="w"> </span>virtual<span class="w"> </span>environment<span class="w"> </span>at:<span class="w"> </span>.venv
Activate<span class="w"> </span>with:<span class="w"> </span><span class="nb">source</span><span class="w"> </span>.venv/bin/activate
❯<span class="w"> </span>tree<span class="w"> </span>.venv
.venv
├──<span class="w"> </span>bin
│<span class="w">   </span>├──<span class="w"> </span>activate
│<span class="w">   </span>├──<span class="w"> </span>activate.bat
│<span class="w">   </span>├──<span class="w"> </span>activate.csh
│<span class="w">   </span>├──<span class="w"> </span>activate.fish
│<span class="w">   </span>├──<span class="w"> </span>activate.nu
│<span class="w">   </span>├──<span class="w"> </span>activate.ps1
│<span class="w">   </span>├──<span class="w"> </span>activate_this.py
│<span class="w">   </span>├──<span class="w"> </span>deactivate.bat
│<span class="w">   </span>├──<span class="w"> </span>pydoc.bat
│<span class="w">   </span>├──<span class="w"> </span>python<span class="w"> </span>-&gt;<span class="w"> </span>/Users/poldrack/.local/share/uv/python/cpython-3.13.1-macos-aarch64-none/bin/python3.13
│<span class="w">   </span>├──<span class="w"> </span>python3<span class="w"> </span>-&gt;<span class="w"> </span>python
│<span class="w">   </span>└──<span class="w"> </span>python3.13<span class="w"> </span>-&gt;<span class="w"> </span>python
├──<span class="w"> </span>CACHEDIR.TAG
├──<span class="w"> </span>lib
│<span class="w">   </span>└──<span class="w"> </span>python3.13
│<span class="w">       </span>└──<span class="w"> </span>site-packages
│<span class="w">           </span>├──<span class="w"> </span>_virtualenv.pth
│<span class="w">           </span>└──<span class="w"> </span>_virtualenv.py
└──<span class="w"> </span>pyvenv.cfg
</pre></div>
</div>
<p>One thing to note here is that the <code class="docutils literal notranslate"><span class="pre">python</span></code> executable is actually a symbolic link to a version that is in a central location (under <code class="docutils literal notranslate"><span class="pre">.local/share/uv</span></code>).
This means that we can create numerous virtual environments, but there will only be one copy of that particular version of Python, saving space on disk.</p>
<p>We can activate the environment by running its activation script, after which we see that the system path will point to the virtual environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>which<span class="w"> </span>python
python<span class="w"> </span>not<span class="w"> </span>found
❯<span class="w"> </span><span class="nb">source</span><span class="w"> </span>.venv/bin/activate
❯<span class="w"> </span>which<span class="w"> </span>python
python<span class="w"> </span>is<span class="w"> </span>/private/tmp/uvtest/uv_example/.venv/bin/python
</pre></div>
</div>
<p>If we wish to add dependencies, we can simply do this using <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">add</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>uv<span class="w"> </span>add<span class="w"> </span>numpy
Resolved<span class="w"> </span><span class="m">2</span><span class="w"> </span>packages<span class="w"> </span><span class="k">in</span><span class="w"> </span>394ms
<span class="w">   </span>Built<span class="w"> </span>uv-example<span class="w"> </span>@<span class="w"> </span>file:///private/tmp/uvtest/uv_example
Prepared<span class="w"> </span><span class="m">2</span><span class="w"> </span>packages<span class="w"> </span><span class="k">in</span><span class="w"> </span>431ms
Installed<span class="w"> </span><span class="m">2</span><span class="w"> </span>packages<span class="w"> </span><span class="k">in</span><span class="w"> </span>8ms
<span class="w"> </span>+<span class="w"> </span><span class="nv">numpy</span><span class="o">==</span><span class="m">2</span>.2.3
<span class="w"> </span>+<span class="w"> </span>uv-example<span class="o">==</span><span class="m">0</span>.1.0<span class="w"> </span><span class="o">(</span>from<span class="w"> </span>file:///private/tmp/uvtest/uv_example<span class="o">)</span>
</pre></div>
</div>
<p>Here again, if we load this module within Python we will see that it is located within the virtual environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>python
Python<span class="w"> </span><span class="m">3</span>.13.1<span class="w"> </span><span class="o">(</span>main,<span class="w"> </span>Dec<span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">2024</span>,<span class="w"> </span><span class="m">14</span>:22:59<span class="o">)</span><span class="w"> </span><span class="o">[</span>Clang<span class="w"> </span><span class="m">18</span>.1.8<span class="w"> </span><span class="o">]</span><span class="w"> </span>on<span class="w"> </span>darwin
Type<span class="w"> </span><span class="s2">&quot;help&quot;</span>,<span class="w"> </span><span class="s2">&quot;copyright&quot;</span>,<span class="w"> </span><span class="s2">&quot;credits&quot;</span><span class="w"> </span>or<span class="w"> </span><span class="s2">&quot;license&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>information.
&gt;&gt;&gt;<span class="w"> </span>import<span class="w"> </span>numpy
&gt;&gt;&gt;<span class="w"> </span>print<span class="o">(</span>numpy.__file__<span class="o">)</span>
/private/tmp/uvtest/uv_example/.venv/lib/python3.13/site-packages/numpy/__init__.py
</pre></div>
</div>
<p>The details regarding the package are stored within a file called “pyproject.toml” in the main project directory.
Looking inside this file we can see that it contains details about the packages that have been added, including the specific version:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>❯ more pyproject.toml
[project]
name = &quot;uv-example&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
authors = [
    { name = &quot;Russell Poldrack&quot;, email = &quot;poldrack@gmail.com&quot; }
]
requires-python = &quot;&gt;=3.13&quot;
dependencies = [
    &quot;numpy&gt;=2.2.3&quot;,
]

[project.scripts]
uv-example = &quot;uv_example:main&quot;

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;
</pre></div>
</div>
<p>This file allows one to specify many other details about a Python package.
It not only stores dependencies but also metadata about the project, making it useful for packaging and distribution, and learning more about its features is important for anyone looking to develop Python packages.</p>
<section id="locking-dependencies-in-uv">
<h4>Locking dependencies in uv<a class="headerlink" href="#locking-dependencies-in-uv" title="Permalink to this heading">#</a></h4>
<p>Computational reproducibility requires that we be able to exactly recreate an environment, including the specific versions of all packages.
If you look at the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file you will see that it doesn’t specify exact versions for Python or the dependencies; instead, it specifies a lower bound; i.e. “numpy&gt;=<strong>DECIMAL_0</strong>.3” means that the numpy version should be at least <strong>DECIMAL_0</strong>.3, but could be higher if a newer version became available.
This is often fine, but for purposes of reproducibility we often wish to record the exact package versions that were used for a particular analysis.
This is commonly done using a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file, and <code class="docutils literal notranslate"><span class="pre">uv</span></code> allows exporting the current environment to such a file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❯<span class="w"> </span>uv<span class="w"> </span>pip<span class="w"> </span>compile<span class="w"> </span>pyproject.toml<span class="w"> </span>-o<span class="w"> </span>requirements.txt
Resolved<span class="w"> </span><span class="m">1</span><span class="w"> </span>package<span class="w"> </span><span class="k">in</span><span class="w"> </span>78ms
<span class="c1"># This file was autogenerated by uv via the following command:</span>
<span class="c1">#    uv pip compile pyproject.toml</span>
<span class="nv">numpy</span><span class="o">==</span><span class="m">2</span>.2.3
<span class="w">    </span><span class="c1"># via uv-example (pyproject.toml)</span>
</pre></div>
</div>
<p>This brief overview only scratches the surface of the many features within <code class="docutils literal notranslate"><span class="pre">uv</span></code>, which we recommend you explore in detail via the project documentation.</p>
</section>
</section>
<section id="environment-management-using-conda">
<h3>Environment management using <em>conda</em><a class="headerlink" href="#environment-management-using-conda" title="Permalink to this heading">#</a></h3>
<p>Another popular tool for managing virtual environments is <code class="docutils literal notranslate"><span class="pre">conda</span></code>.
It has much of the same functionality as uv and has been around much longer, but we have largely moved away from it for most projects for several reasons: <code class="docutils literal notranslate"><span class="pre">uv</span></code> is relatively more efficient when it comes to disk space and it is often faster than conda, especially as environments start to have many packages installed.
In addition, there are sometimes conflicts between conda’s native package management and the <code class="docutils literal notranslate"><span class="pre">pip</span></code> package management system.
When using conda it’s usually necessary to use <code class="docutils literal notranslate"><span class="pre">pip</span></code> to install some packages that aren’t available within the conda library, but this can result in conflicts between the two package management systems.</p>
<p>There is one important way in which <code class="docutils literal notranslate"><span class="pre">conda</span></code> differs from <code class="docutils literal notranslate"><span class="pre">uv</span></code>.
In fact, I switched to <code class="docutils literal notranslate"><span class="pre">uv</span></code> in 2024 after being a long-time user of <code class="docutils literal notranslate"><span class="pre">conda</span></code>, but I still use <code class="docutils literal notranslate"><span class="pre">conda</span></code> for some projects.
The crucial feature of <code class="docutils literal notranslate"><span class="pre">conda</span></code> that has kept us using it for a limited set of projects is its ability to manage non-Python software elements alongside Python packages.
We have found on a couple of occasions that some Python packages have dependencies that rely upon non-Python software components.
Specifically, in cases where Python packages required a specific component (the LLVM compiler), we were unable to easily get the specific required version of that component working on our Mac using <code class="docutils literal notranslate"><span class="pre">uv</span></code>, whereas <code class="docutils literal notranslate"><span class="pre">conda</span></code> simply installs the required component and works out of the box.
The speed and efficiency of <code class="docutils literal notranslate"><span class="pre">uv</span></code> generally outshine <code class="docutils literal notranslate"><span class="pre">conda</span></code> in our experience, but in some cases <code class="docutils literal notranslate"><span class="pre">conda</span></code> may help solve tricky non-Python dependency issues.</p>
<p><strong>TODO</strong>: Add section on Pixi?</p>
</section>
</section>
<section id="large-language-models">
<h2>Large language models<a class="headerlink" href="#large-language-models" title="Permalink to this heading">#</a></h2>
<figure class="align-default" id="gpt4haiku-fig">
<a class="reference internal image-reference" href="_images/gpt4_haiku.png"><img alt="Haiku generated by GPT-4" src="_images/gpt4_haiku.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Haiku generated by GPT-4 from the prompt: “Please generate a haiku that reflects on the experience of writing a book about coding for science using AI.”</span><a class="headerlink" href="#gpt4haiku-fig" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Large language models (LLMs) power tools like ChatGPT, enabling them to generate human-like text responses.
Understanding how these models function can help users make better use of AI coding assistants.
This section provides a brief introduction to LLMs, focusing on their structure, capabilities, and limitations.</p>
<section id="a-brief-history-of-neural-networks">
<h3>A brief history of neural networks<a class="headerlink" href="#a-brief-history-of-neural-networks" title="Permalink to this heading">#</a></h3>
<p>LLMs are a type of <em>artificial neural network</em>, which are computer models composed of a huge number of computing units that are loosely patterned after neurons in the brain.
Artificial neural networks were first developed in the 1940s, only to be abandoned by AI researchers after the early versions were shown to have major limitations in the kinds of problems they could solve.
There was a renaissance of neural network research in the 1980’s and 1990’s arising primarily from researchers in cognitive science, but interest again waned as the field of <em>machine learning</em> developed tools that were able to solve many of the same problems in a computationally simpler manner.
It was not until the late 2000’s that the latest wave of interest in neural networks came about, building on the development of methods that allowed researchers to effectively train neural networks with many layers, known as <em>deep neural networks</em> (hence the common term <em>deep learning</em>).
These methods, together with the realization that graphical processing units (GPUs) could be used to train these models much more quickly and the development of large datasets for model training, led to early advances in the mid 2010’s, particularly in the domain of image recognition.</p>
</section>
<section id="how-llms-are-built-and-trained">
<h3>How LLMs are built and trained<a class="headerlink" href="#how-llms-are-built-and-trained" title="Permalink to this heading">#</a></h3>
<p>The LLMs that are most prominent today, such as GPT-4, Claude, and Google Gemini, are based on a specific neural network architecture known as a <em>transformer</em>, which was first introduced in 2017<span id="id1">[<a class="reference internal" href="bibliography.html#id11" title="Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N. Gomez, Lukasz Kaiser, and Illia Polosukhin. Attention is all you need. 2017. URL: https://arxiv.org/abs/1706.03762, arXiv:1706.03762.">Vaswani <em>et al.</em>, 2017</a>]</span>.
Transformers were developed in order to effectively learn how to map one sequence to another sequence, such as in the case of translating from a sentence in one language to a sentence in another.
However, large transformers trained on massive datasets have since shown themselves to be able to adapt to many different types of problems that they were never explicitly trained to perform.
For this reason, these models (along with other kinds of large pre-trained models) have been referred to as <em>foundation models</em> <span id="id2">[<a class="reference internal" href="bibliography.html#id10" title="Rishi Bommasani, Drew A. Hudson, Ehsan Adeli, Russ Altman, Simran Arora, Sydney von Arx, Michael S. Bernstein, Jeannette Bohg, Antoine Bosselut, Emma Brunskill, Erik Brynjolfsson, Shyamal Buch, Dallas Card, Rodrigo Castellon, Niladri Chatterji, Annie Chen, Kathleen Creel, Jared Quincy Davis, Dora Demszky, Chris Donahue, Moussa Doumbouya, Esin Durmus, Stefano Ermon, John Etchemendy, Kawin Ethayarajh, Li Fei-Fei, Chelsea Finn, Trevor Gale, Lauren Gillespie, Karan Goel, Noah Goodman, Shelby Grossman, Neel Guha, Tatsunori Hashimoto, Peter Henderson, John Hewitt, Daniel E. Ho, Jenny Hong, Kyle Hsu, Jing Huang, Thomas Icard, Saahil Jain, Dan Jurafsky, Pratyusha Kalluri, Siddharth Karamcheti, Geoff Keeling, Fereshte Khani, Omar Khattab, Pang Wei Koh, Mark Krass, Ranjay Krishna, Rohith Kuditipudi, Ananya Kumar, Faisal Ladhak, Mina Lee, Tony Lee, Jure Leskovec, Isabelle Levent, Xiang Lisa Li, Xuechen Li, Tengyu Ma, Ali Malik, Christopher D. Manning, Suvir Mirchandani, Eric Mitchell, Zanele Munyikwa, Suraj Nair, Avanika Narayan, Deepak Narayanan, Ben Newman, Allen Nie, Juan Carlos Niebles, Hamed Nilforoshan, Julian Nyarko, Giray Ogut, Laurel Orr, Isabel Papadimitriou, Joon Sung Park, Chris Piech, Eva Portelance, Christopher Potts, Aditi Raghunathan, Rob Reich, Hongyu Ren, Frieda Rong, Yusuf Roohani, Camilo Ruiz, Jack Ryan, Christopher Ré, Dorsa Sadigh, Shiori Sagawa, Keshav Santhanam, Andy Shih, Krishnan Srinivasan, Alex Tamkin, Rohan Taori, Armin W. Thomas, Florian Tramèr, Rose E. Wang, William Wang, Bohan Wu, Jiajun Wu, Yuhuai Wu, Sang Michael Xie, Michihiro Yasunaga, Jiaxuan You, Matei Zaharia, Michael Zhang, Tianyi Zhang, Xikun Zhang, Yuhui Zhang, Lucia Zheng, Kaitlyn Zhou, and Percy Liang. On the opportunities and risks of foundation models. 2022. URL: https://arxiv.org/abs/2108.07258, arXiv:2108.07258.">Bommasani <em>et al.</em>, 2022</a>]</span>.</p>
<p>One important feature of foundation models is that they are generally trained in a “self-supervised” way, which means that we don’t explicitly have to tell the model how it should respond for any particular input.
This enables training on very large datasets, since the data don’t need to be explicitly labeled.
In the case of GPT-4 and other similar models, they are simply given large sequences of text and trained to accurately predict the next <em>token</em> (which could refer to words, parts of words, or other elements).
Note that the models themselves don’t actually see text; instead, the text is <em>tokenized</em> to convert it into numbers before it is input to the model, and the output of the model is then decoded to convert from numerical tokens back to language.
LLMs like GPT-4 are trained on massive amounts of text, numbering in the trillions of tokens.
The model is trained to become increasingly better at predicting the next token by changing the <em>weights</em> (the strength of connections between the different units) in the model in a way that tries to incrementally correct its errors, which after many hours of training across many GPUs results in a model that can perform the prediction task well.</p>
<p>After this training, the model has a lot of knowledge but is often not very well behaved, so model-builders generally do some form of <em>fine-tuning</em> after initial training of the model, primarily to train it to perform in a way that is more amenable to being a helpful chatbot.</p>
</section>
<section id="open-source-language-models">
<h3>“Open Source” language models<a class="headerlink" href="#open-source-language-models" title="Permalink to this heading">#</a></h3>
<p>The large commercial models such as GPT-4, Claude, and Gemini are truly “black boxes” in the sense that we have no access to how they work internally or how they were trained.
However, in the last few years an ecosystem of “open source” language models has burgeoned, allowing researchers to run powerful pre-trained models on their own computing hardware and providing some degree of insight into the function of the model.
It’s important to point out that the label “open source” is in many cases a misnomer, since it’s relatively rare for the authors of these models to give full access to all of the code and data that went into training the model.
Many of them are better described as “open weight” models (a term we will use throughout this book), since the model weights and code necessary to perform inference are made openly available even if the training code and data are not.
Despite these limitations, the availability of these open-ish models has given researchers the opportunity to work more closely with these models and see into their inner workings.
They also allow users to perform further fine-tuning to augment model performance in particular domains.</p>
<div class="pst-scrollable-table-container"><table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Feature</p></th>
<th class="head"><p>Open-Weight LLMs</p></th>
<th class="head"><p>True Open-Source LLMs</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Model weights available?</p></td>
<td><p>✅ Yes</p></td>
<td><p>✅ Yes</p></td>
</tr>
<tr class="row-odd"><td><p>Training data available?</p></td>
<td><p>❌ No</p></td>
<td><p>✅ Yes</p></td>
</tr>
<tr class="row-even"><td><p>Training code available?</p></td>
<td><p>❌ No</p></td>
<td><p>✅ Yes</p></td>
</tr>
<tr class="row-odd"><td><p>Can be fine-tuned?</p></td>
<td><p>✅ Yes</p></td>
<td><p>✅ Yes</p></td>
</tr>
</tbody>
</table>
</div>
<p>Running large open source models with tens of billions of parameters (such as the well known Llama modelsreleased by Meta) can require significant GPU resources, but many of these models are also released in smaller versions that can be run with reasonable speed on a laptop with a GPU; for the examples in this book, all of the examples are run on a Macbook Pro M3 Max laptop.
Users wishing to run the larger open-weight models can access them via service providers who provide API access to these models for a fee.
We will discuss working with APIs in Chapter XXX.</p>
<p>As an example of what we can do with open weight language models, suppose that we want to compare the output of models before and after instruction tuning.
While we can’t access versions of commercial models such as GPT-4 prior to instruction tuning, there are a large number of open weight models for which both versions are available.
We will show results from the Qwen1.5-0.5B model, which is very small and thus runs relatively quickly even on a laptop.</p>
<p>To see the difference that this fine-tuning makes, we can give the same prompt to a model with and without instruction tuning: “What is the best way to relax after a long day of Python coding?”</p>
<p>Here is the result from the model without instruction tuning:</p>
<p>“Going for a walk or having a drink with friends is a great way to relax after a long day of Python coding.
system
You are a helpful assistant.
user
ow can I generate an XML representation of a list of employees with their corresponding departments and salaries using C# code? And once the XML is generated, how can I parse and print the data to a new file? Can you provide a example of the XML data that I can modify in the code to generate the XML representation?
Here’s an example of the XML data that I can modify to generate the XML representation: … [continues with XML output]”</p>
<p>It’s not a very helpful response, and it’s also followed by a bunch of content that is irrelevant to the prompt.
By comparison, the instruction-tuned version of the same model gives a much better response:</p>
<p>“Relaxing after a long day of Python coding can be a great way to recharge and refocus.
Here are some tips that might help you relax:
1. Exercise: Engage in physical activity such as yoga, stretching, or running to get your blood flowing and reduce stress levels.
2. Listen to music: Listening to calming music can help reduce anxiety and promote relaxation.
3. Take a break: Taking a short break from work or programming can help you recharge and refocus.
4. Practice mindfulness: Mindfulness meditation can help you focus on the present moment and reduce stress levels.
5. Eat healthy: Eating a balanced diet rich in fruits, vegetables, whole grains, and lean protein can help you feel more energized and less stressed.
6. Connect with others: Spending time with friends or family can help reduce feelings of loneliness and increase feelings of support.
7. Write down your thoughts: Writing down your thoughts and emotions can help you process them and relax.
Remember, it’s important to take care of yourself both physically and mentally before returning to work.
By taking these steps, you can help ensure that you can return to work feeling refreshed and ready to tackle any challenges that come your way.”</p>
</section>
<section id="in-context-learning-and-llm-prompting">
<h3>In-context learning and LLM prompting<a class="headerlink" href="#in-context-learning-and-llm-prompting" title="Permalink to this heading">#</a></h3>
<p>Once the training of the model is complete, its weights are fixed and the model itself does not change unless additional training or fine-tuning is applied.
Given this, how is it that these models can exhibit such a wide range of behaviors, and how can they adapt to the details of a particular chat session? It turns out that the model is “learning” from all of the interactions that occur within a specific chat session, but this learning does not occur through modifications of the model’s weights.
Instead, it occurs as the model builds up a store of information within its <em>context window</em>, which you can think of as the model’s “working memory”, similar to the way that we can hold a phone number in our mind but lose it as soon as we stop rehearsing it.
The model’s response at any point in time is conditioned upon all of the content that has occurred up to that point in the chat session, up to the limit of its context window (which is now large enough for most models to hold a substantial amount of text).
In this way, the model can “learn” without requiring any lasting changes in its structure.</p>
<p>Understanding in-context learning is important for LLM power-users because it relates directly to the effectiveness of different prompting strategies.
In particular, it suggests that an effective prompt should help build up enough relevant information in the context window that other relevant information is likely to be retrieved.
We will return later in the book to the utility of prompting strategies.</p>
</section>
<section id="randomness-in-llms">
<h3>Randomness in LLMs<a class="headerlink" href="#randomness-in-llms" title="Permalink to this heading">#</a></h3>
<p>When an output is generated from an LLM, it doesn’t uniquely specify a particular token to be output next.
Instead, it outputs a set of values that are transformed into probabilities over tokens, and the next token is then chosen based on those probabilities.
As an example, we can run the same prompt five times (‘Output a random vegetable.’) on a small LLM (Qwen-2.5-0.5B-Chat), removing any extraneous text generated by the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Sure</span><span class="p">,</span> <span class="n">here</span><span class="s1">&#39;s a random vegetable: Green beans</span>
<span class="n">Sure</span><span class="p">,</span> <span class="n">here</span><span class="s1">&#39;s a random vegetable: Tomato</span>
<span class="n">Sure</span><span class="p">,</span> <span class="n">here</span><span class="s1">&#39;s a random vegetable: broccoli!</span>
<span class="n">Sure</span><span class="p">,</span> <span class="n">here</span><span class="s1">&#39;s a random vegetable: Spinach.</span>
<span class="n">Sure</span><span class="p">,</span> <span class="n">here</span><span class="s1">&#39;s a random vegetable: Veggie: Broccoli</span>
</pre></div>
</div>
<p>In this case we ran each prompt with a different <em>random seed</em>, which is a value that allows one to reproducibly generate a set of random numbers.
Open source models, as well as some commercial models, allow specifying the random seed when submitting a prompt, usually requiring use of the API.</p>
<p>When choosing amongst the possible responses based on their probabilities, one could simply always output the token with the highest probability, which is known as “greedy” selection.
However, LLMs often introduce some variability in output (via a <em>softmax</em> operator).
This procedure has a parameter known as <em>temperature</em> that allows one to scale the degree of randomness, from deterministic (greedy) responding when temperature = 0 to greater randomness at temperature increases.
These systems often default to a small degree of randomness (with temperature in the range of 0.7) to allow some exploration without enabling surprising or bizarre responses.</p>
</section>
<section id="reproducibilty-challenges-of-llms">
<h3>Reproducibilty challenges of LLMs<a class="headerlink" href="#reproducibilty-challenges-of-llms" title="Permalink to this heading">#</a></h3>
<p>The randomness of large language models is particularly important for researchers using them in contexts where reproducibilty is important.
Research performed using commercial/closed large language models should be considered irreproducible in principle; even if one records the system fingerprint (uniquely specifying which model was run) and sets the random seed, there is no guarantee that these models will remain available.
As an example, OpenAI has <a class="reference external" href="https://platform.openai.com/docs/deprecations">deprecated a number of models</a>, including the widely used <code class="docutils literal notranslate"><span class="pre">text-davinci-002</span></code> model, meaning that they are no longer available to users.
Research performed on open weight models is in theory reproducible if the random seed is specified along with the specific model version used.
However, in many cases it is also important to ensure that any results obtained using LLMs are robust to the specific random seed chosen.
One should <em>never</em> cherry pick scientific results by trying different random seeds and only reporting the results that are most consistent with the hypothesis being tested; we refer to this as “seed-hacking”, on analogy to the commonly used term “p-hacking”.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="introduction.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="software_engineering.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Principles of software engineering</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-tools-and-why-we-use-them">The tools and why we use them</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-python">Why Python?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#version-control">Version control</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-version-control-works">How version control works</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#version-control-as-a-lab-notebook">Version control as a lab notebook</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#version-control-best-practices">Version control best practices</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#use-a-consistent-standard-format-for-commit-messages">Use a consistent standard format for commit messages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#explain-intent-rather-than-code">Explain intent rather than code</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-single-commit-should-reflect-solution-of-a-particular-problem">A single commit should reflect solution of a particular problem</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#avoid-blanket-add-commit-operations">Avoid blanket add/commit operations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#version-control-as-developer-productivity-tool">Version control as developer productivity tool</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#falling-back-on-previous-commits">Falling back on previous commits</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-branches">Using branches</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#collaborative-development-using-github">Collaborative development using GitHub</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#virtual-environments">Virtual environments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-management-using-uv">Environment management using <em>uv</em></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#locking-dependencies-in-uv">Locking dependencies in uv</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-management-using-conda">Environment management using <em>conda</em></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#large-language-models">Large language models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-brief-history-of-neural-networks">A brief history of neural networks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-llms-are-built-and-trained">How LLMs are built and trained</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#open-source-language-models">“Open Source” language models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-context-learning-and-llm-prompting">In-context learning and LLM prompting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#randomness-in-llms">Randomness in LLMs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducibilty-challenges-of-llms">Reproducibilty challenges of LLMs</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Russell Poldrack et al.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>